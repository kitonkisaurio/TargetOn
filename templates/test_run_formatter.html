<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prueba Formateo RUN</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png" />
    <link rel="icon" href="/static/favicon.ico" />

    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
      }
      .test-case {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .test-case h3 {
        margin-top: 0;
        color: #333;
      }
      input[type="text"] {
        padding: 10px;
        font-size: 16px;
        width: 200px;
        margin: 5px;
      }
      .run-valid {
        color: #16a34a !important;
        border-color: #16a34a !important;
      }
      .run-invalid {
        color: #dc2626 !important;
        border-color: #dc2626 !important;
      }
      .run-neutral {
        color: #374151 !important;
        border-color: #d1d5db !important;
      }
      .result {
        margin-top: 10px;
        font-family: monospace;
        background: #f5f5f5;
        padding: 10px;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Prueba de Formateo RUN</h1>
    <p>
      Ingresa diferentes formatos de RUN para probar el formateo autom√°tico.
    </p>

    <div class="test-case">
      <h3>Caso 1: RUN Normal</h3>
      <label
        >RUN:
        <input type="text" id="run1" name="run" placeholder="Ej: 100001411"
      /></label>
      <div class="result" id="result1">Resultado aparecer√° aqu√≠...</div>
    </div>

    <div class="test-case">
      <h3>Caso 2: RUN con gui√≥n al inicio</h3>
      <label
        >RUN:
        <input type="text" id="run2" name="run" placeholder="Ej: 1-00001411"
      /></label>
      <div class="result" id="result2">Resultado aparecer√° aqu√≠...</div>
    </div>

    <div class="test-case">
      <h3>Caso 3: RUN ya formateado</h3>
      <label
        >RUN:
        <input type="text" id="run3" name="run" placeholder="Ej: 10.000.141-1"
      /></label>
      <div class="result" id="result3">Resultado aparecer√° aqu√≠...</div>
    </div>

    <div class="test-case">
      <h3>Caso 4: RUN corto</h3>
      <label
        >RUN:
        <input type="text" id="run4" name="run" placeholder="Ej: 83711868"
      /></label>
      <div class="result" id="result4">Resultado aparecer√° aqu√≠...</div>
    </div>

    <div class="test-case">
      <h3>Casos de prueba predefinidos</h3>
      <button onclick="probarCasos()">üöÄ Probar casos autom√°ticamente</button>
      <div id="auto-results"></div>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    <script src="{{ url_for('static', filename='js/run-formatter.js') }}"></script>

    <script>
      // Agregar eventos manuales para mostrar resultados
      document.querySelectorAll('input[name="run"]').forEach((input, index) => {
        const resultDiv = document.getElementById(`result${index + 1}`);

        input.addEventListener("input", function () {
          const formatted =
            window.EciceRUNFormatter?.formatear(this.value) || this.value;
          const isValid =
            window.EciceRUNFormatter?.validar(this.value) || false;
          const clean =
            window.EciceRUNFormatter?.obtenerLimpio(this.value) || "";

          resultDiv.innerHTML = `
                    <strong>Valor original:</strong> "${this.value}"<br>
                    <strong>Formateado:</strong> "${formatted}"<br>
                    <strong>Limpio:</strong> "${clean}"<br>
                    <strong>V√°lido:</strong> ${isValid ? "‚úÖ S√≠" : "‚ùå No"}
                `;
        });
      });

      function probarCasos() {
        const casos = [
          "100001411",
          "1-00001411",
          "10.000.141-1",
          "10000141-1",
          "83711868",
          "8.371.186-8",
          "181816034",
          "18.181.603-4",
        ];

        let resultados = "<h4>Resultados autom√°ticos:</h4>";

        casos.forEach((caso) => {
          const formatted = window.EciceRUNFormatter?.formatear(caso) || caso;
          const isValid = window.EciceRUNFormatter?.validar(caso) || false;
          const clean = window.EciceRUNFormatter?.obtenerLimpio(caso) || "";

          resultados += `
                    <div style="margin: 10px 0; padding: 10px; background: ${isValid ? "#e8f5e8" : "#ffeaea"}; border-radius: 4px;">
                        <strong>${caso}</strong> ‚Üí <strong>${formatted}</strong> 
                        (limpio: ${clean}) 
                        ${isValid ? "‚úÖ" : "‚ùå"}
                    </div>
                `;
        });

        document.getElementById("auto-results").innerHTML = resultados;
      }

      // Mostrar informaci√≥n sobre el formateador cargado
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(() => {
          if (window.EciceRUNFormatter) {
            console.log("‚úÖ Formateador RUN cargado correctamente");
            console.log(
              "Funciones disponibles:",
              Object.keys(window.EciceRUNFormatter),
            );
          } else {
            console.warn("‚ö†Ô∏è Formateador RUN no encontrado");
          }
        }, 100);
      });
    </script>
  </body>
</html>
