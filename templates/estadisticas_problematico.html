<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Estadísticas - ECICEP</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png" />
    <link rel="icon" href="/static/favicon.ico" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      /* Importar Google Fonts - Inter para tipografía moderna */
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

      :root {
        --bg: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        --card-bg: #ffffff;
        --table-header-primary: linear-gradient(
          135deg,
          #3b82f6 0%,
          #1d4ed8 100%
        );
        --table-header-secondary: linear-gradient(
          135deg,
          #059669 0%,
          #047857 100%
        );
        --table-row-hover: rgba(59, 130, 246, 0.08);
        --table-row-even: #f8fafc;
        --table-border: #e2e8f0;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md:
          0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg:
          0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      body {
        background: var(--bg);
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          sans-serif;
        color: var(--text-primary);
        line-height: 1.6;
      }

      /* Cards mejoradas con diseño moderno */
      .card {
        background: var(--card-bg);
        border: 1px solid var(--table-border);
        border-radius: 12px;
        box-shadow: var(--shadow-lg);
        overflow: hidden;
      }

      .card-title {
        color: var(--text-primary);
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 0;
      }

      /* Encabezados de páginas mejorados */
      h2 {
        color: var(--text-primary);
        font-weight: 700;
        font-size: 1.75rem;
      }

      /* Botones mejorados */
      .btn {
        font-weight: 500;
        border-radius: 8px;
      }

      /* Tablas modernas y elegantes */
      .table {
        font-family: "Inter", sans-serif;
        font-size: 0.875rem;
        border-collapse: separate;
        border-spacing: 0;
        border-radius: 8px;
        overflow: hidden;
        background: var(--card-bg);
        box-shadow: var(--shadow-sm);
      }

      /* Encabezados de tabla con gradientes */
      .table thead th {
        background: var(--table-header-primary);
        color: white;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.05em;
        padding: 1rem 0.75rem;
        border: none;
        text-align: center;
        vertical-align: middle;
        position: relative;
      }

      .table thead th:first-child {
        border-top-left-radius: 8px;
      }

      .table thead th:last-child {
        border-top-right-radius: 8px;
      }

      /* Filas de datos con diseño limpio */
      .table tbody td {
        padding: 0.875rem 0.75rem;
        border-top: 1px solid var(--table-border);
        border-bottom: 1px solid var(--table-border);
        color: var(--text-primary);
        font-weight: 400;
        text-align: center;
        vertical-align: middle;
      }

      .table tbody tr:nth-child(even) {
        background-color: var(--table-row-even);
      }

      .table tbody tr:hover {
        background-color: var(--table-row-hover) !important;
      }

      /* Bordes modernos para tablas */
      .table-bordered > :not(caption) > * > * {
        border-width: 1px;
        border-color: var(--table-border);
      }

      /* Sombrear filas de títulos de sección con gradiente */
      .table-section-header > td {
        background: var(--table-header-secondary) !important;
        color: white !important;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 0.025em;
      }

      /* Separación visual para TOTAL mejorada */
      #tabla-pscv-metas .sep-total,
      #tabla-seccion-a .sep-total {
        border-left: 3px solid #ef4444 !important;
        background-color: rgba(239, 68, 68, 0.05) !important;
        font-weight: 600;
      }

      /* Separación visual para Pueblos Originarios y Migrantes */
      #tabla-pscv-metas .sep-po,
      #tabla-pscv-metas .sep-mig {
        border-left: 3px solid #8b5cf6 !important;
        background-color: rgba(139, 92, 246, 0.05) !important;
      }

      /* Contenedor de scroll mejorado */
      .table-sticky-wrap {
        max-height: 70vh;
        overflow: auto;
        border-radius: 8px;
        border: 1px solid var(--table-border);
        box-shadow: var(--shadow-md);
      }

      /* Altura base estimada para filas de encabezado */
      .table.table-sm {
        --th-h: 2.5rem;
      }

      /* Encabezados sticky mejorados */
      .table-sticky thead th {
        position: sticky;
        top: 0;
        z-index: 10;
        background: var(--table-header-primary);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      /* Ajuste para encabezados de 3 filas */
      #tabla-pscv-metas.table-sticky thead tr:nth-child(1) th,
      #tabla-seccion-a.table-sticky thead tr:nth-child(1) th {
        top: 0;
        z-index: 12;
      }
      #tabla-pscv-metas.table-sticky thead tr:nth-child(2) th,
      #tabla-seccion-a.table-sticky thead tr:nth-child(2) th {
        top: var(--th-h, 2.5rem);
        z-index: 11;
      }
      #tabla-pscv-metas.table-sticky thead tr:nth-child(3) th,
      #tabla-seccion-a.table-sticky thead tr:nth-child(3) th {
        top: calc(var(--th-h, 2.5rem) * 2);
        z-index: 10;
      }

      /* Columnas fijas mejoradas */
      .table-sticky td.sticky-col,
      .table-sticky th.sticky-col {
        position: sticky;
        left: 0;
        z-index: 15;
        background: var(--card-bg);
        box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1);
      }

      .table-sticky thead th.sticky-col {
        z-index: 20;
        background: var(--table-header-primary);
      }

      /* Separador visual para la columna fija */
      .sticky-col-shadow {
        box-shadow: 4px 0 8px rgba(0, 0, 0, 0.12);
        border-right: 2px solid rgba(59, 130, 246, 0.3) !important;
      }

      /* Columna CONCEPTO mejorada */
      .concept-col {
        width: auto;
        min-width: 300px;
        max-width: 550px;
        white-space: normal;
        word-break: break-word;
        font-weight: 500;
        color: var(--text-primary);
      }

      /* Responsive mejoras */
      @media (max-width: 768px) {
        .table {
          font-size: 0.8rem;
        }

        .table thead th {
          padding: 0.75rem 0.5rem;
          font-size: 0.7rem;
        }

        .table tbody td {
          padding: 0.75rem 0.5rem;
        }

        .concept-col {
          min-width: 250px;
          max-width: 400px;
        }
      }

      /* Animaciones sutiles - REMOVIDAS */
      .card {
        /* Sin animaciones */
      }

      /* Números destacados */
      .table tbody td:not(.concept-col) {
        font-variant-numeric: tabular-nums;
        font-weight: 500;
      }

      /* Estados de carga mejorados */
      .small.text-muted {
        color: var(--text-secondary) !important;
        font-style: italic;
        font-weight: 400;
      }

      /* Estilos para tooltip de diagnósticos */
      .diagnosticos-tooltip {
        cursor: help;
        text-decoration: underline dotted;
        text-decoration-color: var(--text-secondary);
        text-underline-offset: 3px;
        position: relative;
      }

      .diagnosticos-tooltip:hover {
        color: #3b82f6;
        text-decoration-color: #3b82f6;
      }

      /* Mejorar el tooltip nativo del navegador */
      .diagnosticos-tooltip[title] {
        white-space: pre-line;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid py-4">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <a
            class="btn btn-outline-secondary btn-sm"
            href="{{ url_for('index') }}"
            >← Volver al Buscador</a
          >
          <h2 class="mt-2 mb-0">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              style="
                width: 1.2rem;
                height: 1.2rem;
                vertical-align: -0.12em;
                margin-right: 8px;
                color: #6e6e6e;
              "
              fill="currentColor"
              aria-hidden="true"
            >
              <title>Estadísticas</title>
              <path
                d="M3 3h3v18H3V3zm6 6h3v12H9V9zm6-4h3v16h-3V5zm6 8h3v8h-3v-8z"
              />
            </svg>
            Estadísticas de Usuarios
          </h2>
        </div>
        <a
          class="btn btn-outline-secondary btn-sm"
          href="{{ url_for('logout') }}"
          >Cerrar sesión</a
        >
      </div>

      <!-- Filtros de ventana de tiempo + Panel de Parámetros REM‑P -->
      <div class="card mb-3">
        <div class="card-body">
          <div class="row g-3 align-items-end">
            <div class="col-12 col-md-3">
              <label class="form-label fw-semibold small" for="fecha_desde"
                >Fecha inicio</label
              >
              <input
                id="fecha_desde"
                type="date"
                class="form-control form-control-sm"
              />
            </div>
            <div class="col-12 col-md-3">
              <label class="form-label fw-semibold small" for="fecha_hasta"
                >Fecha término</label
              >
              <input
                id="fecha_hasta"
                type="date"
                class="form-control form-control-sm"
              />
            </div>
            <div class="col-12 col-md-3">
              <label class="form-label fw-semibold small" for="sectores_select"
                >Sector</label
              >
              <select id="sectores_select" class="form-select form-select-sm">
                <option value="">Todos los sectores</option>
                {% for s in sectores %}
                <option value="{{ s.id }}">{{ s.nombre }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-12 col-md-6 d-flex gap-2 flex-wrap">
              <button
                id="btn-aplicar-filtros"
                type="button"
                class="btn btn-primary btn-sm"
              >
                Aplicar filtros
              </button>
              <button
                id="btn-extraer-datos"
                type="button"
                class="btn btn-success btn-sm"
              >
                Extraer datos
              </button>
              <button
                id="btn-limpiar"
                type="button"
                class="btn btn-outline-secondary btn-sm"
              >
                Limpiar
              </button>
              <button
                id="btn-exportar-excel"
                type="button"
                class="btn btn-outline-primary btn-sm"
              >
                Exportar Excel
              </button>
              <a
                href="/usuarios_compensados"
                class="btn btn-outline-success btn-sm"
              >
                <i class="bi bi-check-circle me-1"></i>Compensación Vigente
              </a>
              <a
                href="/usuarios_pscv_completo"
                class="btn btn-outline-danger btn-sm"
              >
                <i class="bi bi-heart-pulse me-1"></i>PSCV Completo
              </a>
            </div>
          </div>
          <hr class="my-3" />
          <div id="params-panel-host"></div>
        </div>
      </div>

      <!-- SECCIÓN A: PROGRAMA SALUD CARDIOVASCULAR (PSCV) -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
              SECCIÓN A: PROGRAMA SALUD CARDIOVASCULAR (PSCV)
            </h5>
            <small class="badge bg-success">REM-P 2025</small>
          </div>

          <!-- Tabla REM-P Sección A: Programa PSCV -->
          <div
            class="table-responsive table-sticky-wrap mt-3"
            style="overflow-x: auto"
          >
            <table
              class="table table-sm table-striped table-bordered align-middle table-sticky"
              id="tabla-seccion-a-pscv"
              data-export-name="Sección A - PSCV"
            >
              <!-- ENCABEZADOS -->
              <thead class="table-dark sticky-top" id="seccion-a-pscv-head">
                <!-- Fila 1: Grupos principales -->
                <tr>
                  <th rowspan="3" class="concepto-col text-center align-middle">
                    CONCEPTO
                  </th>
                  <th colspan="3" class="text-center align-middle">TOTAL</th>
                  <th colspan="30" class="text-center">RANGO ETARIO Y SEXO</th>
                  <th rowspan="2" class="text-center align-middle">
                    Pueblos<br />Originarios
                  </th>
                  <th rowspan="2" class="text-center align-middle">
                    Migrantes
                  </th>
                </tr>
                <!-- Fila 2: Bandas etarias -->
                <tr>
                  <th class="text-center">Ambos Sexos</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th colspan="2" class="text-center">15 A 19 AÑOS</th>
                  <th colspan="2" class="text-center">20 A 24 AÑOS</th>
                  <th colspan="2" class="text-center">25 A 29 AÑOS</th>
                  <th colspan="2" class="text-center">30 A 34 AÑOS</th>
                  <th colspan="2" class="text-center">35 A 39 AÑOS</th>
                  <th colspan="2" class="text-center">40 A 44 AÑOS</th>
                  <th colspan="2" class="text-center">45 A 49 AÑOS</th>
                  <th colspan="2" class="text-center">50 A 54 AÑOS</th>
                  <th colspan="2" class="text-center">55 A 59 AÑOS</th>
                  <th colspan="2" class="text-center">60 A 64 AÑOS</th>
                  <th colspan="2" class="text-center">65 A 69 AÑOS</th>
                  <th colspan="2" class="text-center">70 A 74 AÑOS</th>
                  <th colspan="2" class="text-center">75 A 79 AÑOS</th>
                  <th colspan="2" class="text-center">80 Y MÁS AÑOS</th>
                </tr>
                <!-- Fila 3: Hombres/Mujeres -->
                <tr>
                  <!-- Celdas vacías para TOTAL (ya definidas en fila anterior) -->
                  <th style="visibility: hidden"></th>
                  <th style="visibility: hidden"></th>
                  <th style="visibility: hidden"></th>
                  <!-- Bandas etarias: Hombres/Mujeres -->
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <th class="text-center">Hombres</th>
                  <th class="text-center">Mujeres</th>
                  <!-- Celdas vacías para Pueblos Originarios y Migrantes (ya definidas en fila 1) -->
                  <th style="visibility: hidden"></th>
                  <th style="visibility: hidden"></th>
                </tr>
              </thead>

              <tbody id="seccion-a-pscv-body">
                <!-- NÚMERO DE PERSONAS EN PSCV -->
                <tr>
                  <td class="concepto-col">NÚMERO DE PERSONAS EN PSCV</td>
                  <td class="celda-activa" id="pscv-total">0</td>
                  <td class="celda-activa" id="pscv-total-h">0</td>
                  <td class="celda-activa" id="pscv-total-m">0</td>
                  <!-- 15-19 años -->
                  <td class="celda-activa" id="pscv-15-19-h">0</td>
                  <td class="celda-activa" id="pscv-15-19-m">0</td>
                  <!-- 20-24 años -->
                  <td class="celda-activa" id="pscv-20-24-h">0</td>
                  <td class="celda-activa" id="pscv-20-24-m">0</td>
                  <!-- 25-29 años -->
                  <td class="celda-activa" id="pscv-25-29-h">0</td>
                  <td class="celda-activa" id="pscv-25-29-m">0</td>
                  <!-- 30-34 años -->
                  <td class="celda-activa" id="pscv-30-34-h">0</td>
                  <td class="celda-activa" id="pscv-30-34-m">0</td>
                  <!-- 35-39 años -->
                  <td class="celda-activa" id="pscv-35-39-h">0</td>
                  <td class="celda-activa" id="pscv-35-39-m">0</td>
                  <!-- 40-44 años -->
                  <td class="celda-activa" id="pscv-40-44-h">0</td>
                  <td class="celda-activa" id="pscv-40-44-m">0</td>
                  <!-- 45-49 años -->
                  <td class="celda-activa" id="pscv-45-49-h">0</td>
                  <td class="celda-activa" id="pscv-45-49-m">0</td>
                  <!-- 50-54 años -->
                  <td class="celda-activa" id="pscv-50-54-h">0</td>
                  <td class="celda-activa" id="pscv-50-54-m">0</td>
                  <!-- 55-59 años -->
                  <td class="celda-activa" id="pscv-55-59-h">0</td>
                  <td class="celda-activa" id="pscv-55-59-m">0</td>
                  <!-- 60-64 años -->
                  <td class="celda-activa" id="pscv-60-64-h">0</td>
                  <td class="celda-activa" id="pscv-60-64-m">0</td>
                  <!-- 65-69 años -->
                  <td class="celda-activa" id="pscv-65-69-h">0</td>
                  <td class="celda-activa" id="pscv-65-69-m">0</td>
                  <!-- 70-74 años -->
                  <td class="celda-activa" id="pscv-70-74-h">0</td>
                  <td class="celda-activa" id="pscv-70-74-m">0</td>
                  <!-- 75-79 años -->
                  <td class="celda-activa" id="pscv-75-79-h">0</td>
                  <td class="celda-activa" id="pscv-75-79-m">0</td>
                  <!-- 80+ años -->
                  <td class="celda-activa" id="pscv-80-mas-h">0</td>
                  <td class="celda-activa" id="pscv-80-mas-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-activa" id="pscv-po-h">0</td>
                  <!-- Migrantes -->
                  <td class="celda-activa" id="pscv-mig-h">0</td>
                </tr>

                <!-- CLASIFICACIÓN DEL RIESGO CARDIOVASCULAR -->
                <tr class="table-secondary">
                  <td class="concepto-col" rowspan="3">
                    <strong>Clasificación del Riesgo Cardiovascular</strong>
                  </td>
                  <td class="concepto-subcol">Bajo</td>
                  <td class="celda-activa" id="riesgo-bajo-total">0</td>
                  <td class="celda-activa" id="riesgo-bajo-total-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-total-m">0</td>
                  <!-- 15-19 años -->
                  <td class="celda-activa" id="riesgo-bajo-15-19-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-15-19-m">0</td>
                  <!-- 20-24 años -->
                  <td class="celda-activa" id="riesgo-bajo-20-24-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-20-24-m">0</td>
                  <!-- 25-29 años -->
                  <td class="celda-activa" id="riesgo-bajo-25-29-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-25-29-m">0</td>
                  <!-- 30-34 años -->
                  <td class="celda-activa" id="riesgo-bajo-30-34-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-30-34-m">0</td>
                  <!-- 35-39 años -->
                  <td class="celda-activa" id="riesgo-bajo-35-39-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-35-39-m">0</td>
                  <!-- 40-44 años -->
                  <td class="celda-activa" id="riesgo-bajo-40-44-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-40-44-m">0</td>
                  <!-- 45-49 años -->
                  <td class="celda-activa" id="riesgo-bajo-45-49-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-45-49-m">0</td>
                  <!-- 50-54 años -->
                  <td class="celda-activa" id="riesgo-bajo-50-54-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-50-54-m">0</td>
                  <!-- 55-59 años -->
                  <td class="celda-activa" id="riesgo-bajo-55-59-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-55-59-m">0</td>
                  <!-- 60-64 años -->
                  <td class="celda-activa" id="riesgo-bajo-60-64-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-60-64-m">0</td>
                  <!-- 65-69 años -->
                  <td class="celda-activa" id="riesgo-bajo-65-69-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-65-69-m">0</td>
                  <!-- 70-74 años -->
                  <td class="celda-activa" id="riesgo-bajo-70-74-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-70-74-m">0</td>
                  <!-- 75-79 años -->
                  <td class="celda-activa" id="riesgo-bajo-75-79-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-75-79-m">0</td>
                  <!-- 80+ años -->
                  <td class="celda-activa" id="riesgo-bajo-80-mas-h">0</td>
                  <td class="celda-activa" id="riesgo-bajo-80-mas-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-activa" id="riesgo-bajo-po">0</td>
                  <!-- Migrantes -->
                  <td class="celda-activa" id="riesgo-bajo-mig">0</td>
                </tr>
                <tr>
                  <td class="concepto-subcol">Moderado</td>
                  <td class="celda-activa" id="riesgo-mod-total">0</td>
                  <td class="celda-activa" id="riesgo-mod-total-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-total-m">0</td>
                  <!-- Todas las celdas de riesgo moderado por banda etaria -->
                  <td class="celda-activa" id="riesgo-mod-15-19-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-15-19-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-20-24-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-20-24-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-25-29-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-25-29-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-30-34-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-30-34-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-35-39-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-35-39-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-40-44-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-40-44-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-45-49-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-45-49-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-50-54-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-50-54-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-55-59-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-55-59-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-60-64-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-60-64-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-65-69-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-65-69-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-70-74-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-70-74-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-75-79-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-75-79-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-80-mas-h">0</td>
                  <td class="celda-activa" id="riesgo-mod-80-mas-m">0</td>
                  <td class="celda-activa" id="riesgo-mod-po">0</td>
                  <td class="celda-activa" id="riesgo-mod-mig">0</td>
                </tr>
                <tr>
                  <td class="concepto-subcol">Alto</td>
                  <td class="celda-activa" id="riesgo-alto-total">0</td>
                  <td class="celda-activa" id="riesgo-alto-total-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-total-m">0</td>
                  <!-- Todas las celdas de riesgo alto por banda etaria -->
                  <td class="celda-activa" id="riesgo-alto-15-19-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-15-19-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-20-24-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-20-24-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-25-29-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-25-29-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-30-34-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-30-34-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-35-39-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-35-39-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-40-44-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-40-44-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-45-49-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-45-49-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-50-54-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-50-54-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-55-59-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-55-59-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-60-64-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-60-64-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-65-69-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-65-69-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-70-74-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-70-74-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-75-79-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-75-79-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-80-mas-h">0</td>
                  <td class="celda-activa" id="riesgo-alto-80-mas-m">0</td>
                  <td class="celda-activa" id="riesgo-alto-po">0</td>
                  <td class="celda-activa" id="riesgo-alto-mig">0</td>
                </tr>

                <!-- PERSONAS BAJO CONTROL SEGÚN PATOLOGÍA Y FACTORES DE RIESGO -->
                <tr class="table-warning">
                  <td class="concepto-col" rowspan="8">
                    <strong
                      >Personas bajo control según patología y factores de
                      riesgo (existencia)</strong
                    >
                  </td>
                  <td class="concepto-subcol">Hipertensión Arterial</td>
                  <td class="celda-activa" id="hta-total">0</td>
                  <td class="celda-activa" id="hta-total-h">0</td>
                  <td class="celda-activa" id="hta-total-m">0</td>
                  <!-- Todas las celdas de HTA por banda etaria -->
                  <td class="celda-activa" id="hta-15-19-h">0</td>
                  <td class="celda-activa" id="hta-15-19-m">0</td>
                  <td class="celda-activa" id="hta-20-24-h">0</td>
                  <td class="celda-activa" id="hta-20-24-m">0</td>
                  <td class="celda-activa" id="hta-25-29-h">0</td>
                  <td class="celda-activa" id="hta-25-29-m">0</td>
                  <td class="celda-activa" id="hta-30-34-h">0</td>
                  <td class="celda-activa" id="hta-30-34-m">0</td>
                  <td class="celda-activa" id="hta-35-39-h">0</td>
                  <td class="celda-activa" id="hta-35-39-m">0</td>
                  <td class="celda-activa" id="hta-40-44-h">0</td>
                  <td class="celda-activa" id="hta-40-44-m">0</td>
                  <td class="celda-activa" id="hta-45-49-h">0</td>
                  <td class="celda-activa" id="hta-45-49-m">0</td>
                  <td class="celda-activa" id="hta-50-54-h">0</td>
                  <td class="celda-activa" id="hta-50-54-m">0</td>
                  <td class="celda-activa" id="hta-55-59-h">0</td>
                  <td class="celda-activa" id="hta-55-59-m">0</td>
                  <td class="celda-activa" id="hta-60-64-h">0</td>
                  <td class="celda-activa" id="hta-60-64-m">0</td>
                  <td class="celda-activa" id="hta-65-69-h">0</td>
                  <td class="celda-activa" id="hta-65-69-m">0</td>
                  <td class="celda-activa" id="hta-70-74-h">0</td>
                  <td class="celda-activa" id="hta-70-74-m">0</td>
                  <td class="celda-activa" id="hta-75-79-h">0</td>
                  <td class="celda-activa" id="hta-75-79-m">0</td>
                  <td class="celda-activa" id="hta-80-mas-h">0</td>
                  <td class="celda-activa" id="hta-80-mas-m">0</td>
                  <td class="celda-activa" id="hta-po">0</td>
                  <td class="celda-activa" id="hta-mig">0</td>
                </tr>
                <tr>
                  <td class="concepto-subcol">Diabetes Mellitus tipo 2</td>
                  <td class="celda-activa" id="dm2-total">0</td>
                  <td class="celda-activa" id="dm2-total-h">0</td>
                  <td class="celda-activa" id="dm2-total-m">0</td>
                  <!-- Todas las celdas de DM2 por banda etaria -->
                  <td class="celda-activa" id="dm2-15-19-h">0</td>
                  <td class="celda-activa" id="dm2-15-19-m">0</td>
                  <td class="celda-activa" id="dm2-20-24-h">0</td>
                  <td class="celda-activa" id="dm2-20-24-m">0</td>
                  <td class="celda-activa" id="dm2-25-29-h">0</td>
                  <td class="celda-activa" id="dm2-25-29-m">0</td>
                  <td class="celda-activa" id="dm2-30-34-h">0</td>
                  <td class="celda-activa" id="dm2-30-34-m">0</td>
                  <td class="celda-activa" id="dm2-35-39-h">0</td>
                  <td class="celda-activa" id="dm2-35-39-m">0</td>
                  <td class="celda-activa" id="dm2-40-44-h">0</td>
                  <td class="celda-activa" id="dm2-40-44-m">0</td>
                  <td class="celda-activa" id="dm2-45-49-h">0</td>
                  <td class="celda-activa" id="dm2-45-49-m">0</td>
                  <td class="celda-activa" id="dm2-50-54-h">0</td>
                  <td class="celda-activa" id="dm2-50-54-m">0</td>
                  <td class="celda-activa" id="dm2-55-59-h">0</td>
                  <td class="celda-activa" id="dm2-55-59-m">0</td>
                  <td class="celda-activa" id="dm2-60-64-h">0</td>
                  <td class="celda-activa" id="dm2-60-64-m">0</td>
                  <td class="celda-activa" id="dm2-65-69-h">0</td>
                  <td class="celda-activa" id="dm2-65-69-m">0</td>
                  <td class="celda-activa" id="dm2-70-74-h">0</td>
                  <td class="celda-activa" id="dm2-70-74-m">0</td>
                  <td class="celda-activa" id="dm2-75-79-h">0</td>
                  <td class="celda-activa" id="dm2-75-79-m">0</td>
                  <td class="celda-activa" id="dm2-80-mas-h">0</td>
                  <td class="celda-activa" id="dm2-80-mas-m">0</td>
                  <td class="celda-activa" id="dm2-po">0</td>
                  <td class="celda-activa" id="dm2-mig">0</td>
                </tr>
                <tr>
                  <td class="concepto-subcol">Dislipidemia</td>
                  <td class="celda-activa" id="dislip-total">0</td>
                  <td class="celda-activa" id="dislip-total-h">0</td>
                  <td class="celda-activa" id="dislip-total-m">0</td>
                  <!-- Todas las celdas de dislipidemia por banda etaria -->
                  <td class="celda-activa" id="dislip-15-19-h">0</td>
                  <td class="celda-activa" id="dislip-15-19-m">0</td>
                  <td class="celda-activa" id="dislip-20-24-h">0</td>
                  <td class="celda-activa" id="dislip-20-24-m">0</td>
                  <td class="celda-activa" id="dislip-25-29-h">0</td>
                  <td class="celda-activa" id="dislip-25-29-m">0</td>
                  <td class="celda-activa" id="dislip-30-34-h">0</td>
                  <td class="celda-activa" id="dislip-30-34-m">0</td>
                  <td class="celda-activa" id="dislip-35-39-h">0</td>
                  <td class="celda-activa" id="dislip-35-39-m">0</td>
                  <td class="celda-activa" id="dislip-40-44-h">0</td>
                  <td class="celda-activa" id="dislip-40-44-m">0</td>
                  <td class="celda-activa" id="dislip-45-49-h">0</td>
                  <td class="celda-activa" id="dislip-45-49-m">0</td>
                  <td class="celda-activa" id="dislip-50-54-h">0</td>
                  <td class="celda-activa" id="dislip-50-54-m">0</td>
                  <td class="celda-activa" id="dislip-55-59-h">0</td>
                  <td class="celda-activa" id="dislip-55-59-m">0</td>
                  <td class="celda-activa" id="dislip-60-64-h">0</td>
                  <td class="celda-activa" id="dislip-60-64-m">0</td>
                  <td class="celda-activa" id="dislip-65-69-h">0</td>
                  <td class="celda-activa" id="dislip-65-69-m">0</td>
                  <td class="celda-activa" id="dislip-70-74-h">0</td>
                  <td class="celda-activa" id="dislip-70-74-m">0</td>
                  <td class="celda-activa" id="dislip-75-79-h">0</td>
                  <td class="celda-activa" id="dislip-75-79-m">0</td>
                  <td class="celda-activa" id="dislip-80-mas-h">0</td>
                  <td class="celda-activa" id="dislip-80-mas-m">0</td>
                  <td class="celda-activa" id="dislip-po">0</td>
                  <td class="celda-activa" id="dislip-mig">0</td>
                </tr>
                <tr>
                  <td class="concepto-subcol">Tabaquismo ≥ 55 años</td>
                  <!-- Tabaquismo solo para ≥55 años -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-activa" id="tabaq-55-59-h">0</td>
                  <td class="celda-activa" id="tabaq-55-59-m">0</td>
                  <td class="celda-activa" id="tabaq-60-64-h">0</td>
                  <td class="celda-activa" id="tabaq-60-64-m">0</td>
                  <td class="celda-activa" id="tabaq-65-69-h">0</td>
                  <td class="celda-activa" id="tabaq-65-69-m">0</td>
                  <td class="celda-activa" id="tabaq-70-74-h">0</td>
                  <td class="celda-activa" id="tabaq-70-74-m">0</td>
                  <td class="celda-activa" id="tabaq-75-79-h">0</td>
                  <td class="celda-activa" id="tabaq-75-79-m">0</td>
                  <td class="celda-activa" id="tabaq-80-mas-h">0</td>
                  <td class="celda-activa" id="tabaq-80-mas-m">0</td>
                  <td class="celda-activa" id="tabaq-po">0</td>
                  <td class="celda-activa" id="tabaq-mig">0</td>
                </tr>
                <tr>
                  <td class="concepto-subcol">
                    Antecedentes de Infarto Agudo al Miocardio (IAM)
                  </td>
                  <td class="celda-activa" id="iam-ant-total">0</td>
                  <td class="celda-activa" id="iam-ant-total-h">0</td>
                  <td class="celda-activa" id="iam-ant-total-m">0</td>
                  <!-- Todas las celdas de IAM por banda etaria -->
                  <td class="celda-activa" id="iam-ant-15-19-h">0</td>
                  <td class="celda-activa" id="iam-ant-15-19-m">0</td>
                  <td class="celda-activa" id="iam-ant-20-24-h">0</td>
                  <td class="celda-activa" id="iam-ant-20-24-m">0</td>
                  <td class="celda-activa" id="iam-ant-25-29-h">0</td>
                  <td class="celda-activa" id="iam-ant-25-29-m">0</td>
                  <td class="celda-activa" id="iam-ant-30-34-h">0</td>
                  <td class="celda-activa" id="iam-ant-30-34-m">0</td>
                  <td class="celda-activa" id="iam-ant-35-39-h">0</td>
                  <td class="celda-activa" id="iam-ant-35-39-m">0</td>
                  <td class="celda-activa" id="iam-ant-40-44-h">0</td>
                  <td class="celda-activa" id="iam-ant-40-44-m">0</td>
                  <td class="celda-activa" id="iam-ant-45-49-h">0</td>
                  <td class="celda-activa" id="iam-ant-45-49-m">0</td>
                  <td class="celda-activa" id="iam-ant-50-54-h">0</td>
                  <td class="celda-activa" id="iam-ant-50-54-m">0</td>
                  <td class="celda-activa" id="iam-ant-55-59-h">0</td>
                  <td class="celda-activa" id="iam-ant-55-59-m">0</td>
                  <td class="celda-activa" id="iam-ant-60-64-h">0</td>
                  <td class="celda-activa" id="iam-ant-60-64-m">0</td>
                  <td class="celda-activa" id="iam-ant-65-69-h">0</td>
                  <td class="celda-activa" id="iam-ant-65-69-m">0</td>
                  <td class="celda-activa" id="iam-ant-70-74-h">0</td>
                  <td class="celda-activa" id="iam-ant-70-74-m">0</td>
                  <td class="celda-activa" id="iam-ant-75-79-h">0</td>
                  <td class="celda-activa" id="iam-ant-75-79-m">0</td>
                  <td class="celda-activa" id="iam-ant-80-mas-h">0</td>
                  <td class="celda-activa" id="iam-ant-80-mas-m">0</td>
                  <td class="celda-activa" id="iam-ant-po">0</td>
                  <td class="celda-activa" id="iam-ant-mig">0</td>
                </tr>
                <tr>
                  <td class="concepto-subcol">
                    Antecedentes de Ataque Cerebro Vascular (ACV)
                  </td>
                  <td class="celda-activa" id="acv-ant-total">0</td>
                  <td class="celda-activa" id="acv-ant-total-h">0</td>
                  <td class="celda-activa" id="acv-ant-total-m">0</td>
                  <!-- Todas las celdas de ACV por banda etaria -->
                  <td class="celda-activa" id="acv-ant-15-19-h">0</td>
                  <td class="celda-activa" id="acv-ant-15-19-m">0</td>
                  <td class="celda-activa" id="acv-ant-20-24-h">0</td>
                  <td class="celda-activa" id="acv-ant-20-24-m">0</td>
                  <td class="celda-activa" id="acv-ant-25-29-h">0</td>
                  <td class="celda-activa" id="acv-ant-25-29-m">0</td>
                  <td class="celda-activa" id="acv-ant-30-34-h">0</td>
                  <td class="celda-activa" id="acv-ant-30-34-m">0</td>
                  <td class="celda-activa" id="acv-ant-35-39-h">0</td>
                  <td class="celda-activa" id="acv-ant-35-39-m">0</td>
                  <td class="celda-activa" id="acv-ant-40-44-h">0</td>
                  <td class="celda-activa" id="acv-ant-40-44-m">0</td>
                  <td class="celda-activa" id="acv-ant-45-49-h">0</td>
                  <td class="celda-activa" id="acv-ant-45-49-m">0</td>
                  <td class="celda-activa" id="acv-ant-50-54-h">0</td>
                  <td class="celda-activa" id="acv-ant-50-54-m">0</td>
                  <td class="celda-activa" id="acv-ant-55-59-h">0</td>
                  <td class="celda-activa" id="acv-ant-55-59-m">0</td>
                  <td class="celda-activa" id="acv-ant-60-64-h">0</td>
                  <td class="celda-activa" id="acv-ant-60-64-m">0</td>
                  <td class="celda-activa" id="acv-ant-65-69-h">0</td>
                  <td class="celda-activa" id="acv-ant-65-69-m">0</td>
                  <td class="celda-activa" id="acv-ant-70-74-h">0</td>
                  <td class="celda-activa" id="acv-ant-70-74-m">0</td>
                  <td class="celda-activa" id="acv-ant-75-79-h">0</td>
                  <td class="celda-activa" id="acv-ant-75-79-m">0</td>
                  <td class="celda-activa" id="acv-ant-80-mas-h">0</td>
                  <td class="celda-activa" id="acv-ant-80-mas-m">0</td>
                  <td class="celda-activa" id="acv-ant-po">0</td>
                  <td class="celda-activa" id="acv-ant-mig">0</td>
                </tr>
                <tr>
                  <td class="concepto-subcol">
                    Antecedentes de otras Enfermedades Cardiovasculares ECV
                    (excepto IAM y ACV)
                  </td>
                  <td class="celda-activa" id="ecv-ant-total">0</td>
                  <td class="celda-activa" id="ecv-ant-total-h">0</td>
                  <td class="celda-activa" id="ecv-ant-total-m">0</td>
                  <!-- Todas las celdas de ECV por banda etaria -->
                  <td class="celda-activa" id="ecv-ant-15-19-h">0</td>
                  <td class="celda-activa" id="ecv-ant-15-19-m">0</td>
                  <td class="celda-activa" id="ecv-ant-20-24-h">0</td>
                  <td class="celda-activa" id="ecv-ant-20-24-m">0</td>
                  <td class="celda-activa" id="ecv-ant-25-29-h">0</td>
                  <td class="celda-activa" id="ecv-ant-25-29-m">0</td>
                  <td class="celda-activa" id="ecv-ant-30-34-h">0</td>
                  <td class="celda-activa" id="ecv-ant-30-34-m">0</td>
                  <td class="celda-activa" id="ecv-ant-35-39-h">0</td>
                  <td class="celda-activa" id="ecv-ant-35-39-m">0</td>
                  <td class="celda-activa" id="ecv-ant-40-44-h">0</td>
                  <td class="celda-activa" id="ecv-ant-40-44-m">0</td>
                  <td class="celda-activa" id="ecv-ant-45-49-h">0</td>
                  <td class="celda-activa" id="ecv-ant-45-49-m">0</td>
                  <td class="celda-activa" id="ecv-ant-50-54-h">0</td>
                  <td class="celda-activa" id="ecv-ant-50-54-m">0</td>
                  <td class="celda-activa" id="ecv-ant-55-59-h">0</td>
                  <td class="celda-activa" id="ecv-ant-55-59-m">0</td>
                  <td class="celda-activa" id="ecv-ant-60-64-h">0</td>
                  <td class="celda-activa" id="ecv-ant-60-64-m">0</td>
                  <td class="celda-activa" id="ecv-ant-65-69-h">0</td>
                  <td class="celda-activa" id="ecv-ant-65-69-m">0</td>
                  <td class="celda-activa" id="ecv-ant-70-74-h">0</td>
                  <td class="celda-activa" id="ecv-ant-70-74-m">0</td>
                  <td class="celda-activa" id="ecv-ant-75-79-h">0</td>
                  <td class="celda-activa" id="ecv-ant-75-79-m">0</td>
                  <td class="celda-activa" id="ecv-ant-80-mas-h">0</td>
                  <td class="celda-activa" id="ecv-ant-80-mas-m">0</td>
                  <td class="celda-activa" id="ecv-ant-po">0</td>
                  <td class="celda-activa" id="ecv-ant-mig">0</td>
                </tr>
                <tr>
                  <td class="concepto-subcol">
                    Enfermedad renal crónica (etapas 1 a 5)
                  </td>
                  <td class="celda-activa" id="erc-total">0</td>
                  <td class="celda-activa" id="erc-total-h">0</td>
                  <td class="celda-activa" id="erc-total-m">0</td>
                  <!-- Todas las celdas de ERC por banda etaria -->
                  <td class="celda-activa" id="erc-15-19-h">0</td>
                  <td class="celda-activa" id="erc-15-19-m">0</td>
                  <td class="celda-activa" id="erc-20-24-h">0</td>
                  <td class="celda-activa" id="erc-20-24-m">0</td>
                  <td class="celda-activa" id="erc-25-29-h">0</td>
                  <td class="celda-activa" id="erc-25-29-m">0</td>
                  <td class="celda-activa" id="erc-30-34-h">0</td>
                  <td class="celda-activa" id="erc-30-34-m">0</td>
                  <td class="celda-activa" id="erc-35-39-h">0</td>
                  <td class="celda-activa" id="erc-35-39-m">0</td>
                  <td class="celda-activa" id="erc-40-44-h">0</td>
                  <td class="celda-activa" id="erc-40-44-m">0</td>
                  <td class="celda-activa" id="erc-45-49-h">0</td>
                  <td class="celda-activa" id="erc-45-49-m">0</td>
                  <td class="celda-activa" id="erc-50-54-h">0</td>
                  <td class="celda-activa" id="erc-50-54-m">0</td>
                  <td class="celda-activa" id="erc-55-59-h">0</td>
                  <td class="celda-activa" id="erc-55-59-m">0</td>
                  <td class="celda-activa" id="erc-60-64-h">0</td>
                  <td class="celda-activa" id="erc-60-64-m">0</td>
                  <td class="celda-activa" id="erc-65-69-h">0</td>
                  <td class="celda-activa" id="erc-65-69-m">0</td>
                  <td class="celda-activa" id="erc-70-74-h">0</td>
                  <td class="celda-activa" id="erc-70-74-m">0</td>
                  <td class="celda-activa" id="erc-75-79-h">0</td>
                  <td class="celda-activa" id="erc-75-79-m">0</td>
                  <td class="celda-activa" id="erc-80-mas-h">0</td>
                  <td class="celda-activa" id="erc-80-mas-m">0</td>
                  <td class="celda-activa" id="erc-po">0</td>
                  <td class="celda-activa" id="erc-mig">0</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div id="seccion-a-status" class="small text-muted mt-2">
            Iniciando carga...
          </div>
        </div>
      </div>

      <!-- Sección B: Metas de Compensación -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">SECCIÓN B: METAS DE COMPENSACIÓN</h5>
            <small class="badge bg-primary"
              >Datos con Bandas Etarias REM-P</small
            >
          </div>

          <!-- Resumen de totales -->
          <div class="row mt-3 mb-3">
            <div class="col-md-3">
              <div class="card bg-light border-0">
                <div class="card-body text-center py-2">
                  <h6 class="text-primary mb-1">PA &lt; 140/90</h6>
                  <h4 class="text-primary mb-0" id="total-pa-140">0</h4>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card bg-light border-0">
                <div class="card-body text-center py-2">
                  <h6 class="text-success mb-1">PA &lt; 150/90</h6>
                  <h4 class="text-success mb-0" id="total-pa-150">0</h4>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card bg-light border-0">
                <div class="card-body text-center py-2">
                  <h6 class="text-info mb-1">HbA1c &lt; 7%</h6>
                  <h4 class="text-info mb-0" id="total-hba1c-7">0</h4>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card bg-light border-0">
                <div class="card-body text-center py-2">
                  <h6 class="text-warning mb-1">HbA1c &lt; 8%</h6>
                  <h4 class="text-warning mb-0" id="total-hba1c-8">0</h4>
                </div>
              </div>
            </div>
          </div>

          <!-- Tabla REM-P Sección B: Metas de Compensación -->
          <div class="table-responsive mt-3">
            <style>
              .celda-bloqueada {
                background-color: #e9ecef !important;
                color: #6c757d !important;
                text-align: center;
                vertical-align: middle;
              }
              .celda-activa {
                background-color: white !important;
                text-align: center;
                vertical-align: middle;
              }
              #tabla-remp-metas th {
                text-align: center;
                vertical-align: middle;
                font-weight: bold;
                font-size: 0.8rem;
                background-color: #495057;
                color: white;
                border: 1px solid #dee2e6;
              }
              #tabla-remp-metas td {
                border: 1px solid #dee2e6;
                font-size: 0.85rem;
              }
              .concepto-col {
                width: 350px;
                text-align: left;
                font-weight: 500;
                background-color: #f8f9fa;
              }
            </style>

            <table class="table table-sm table-bordered" id="tabla-remp-metas">
              <thead>
                <tr>
                  <th rowspan="3" class="concepto-col">CONCEPTO</th>
                  <th colspan="3">TOTAL</th>
                  <th colspan="28">RANGO ETARIO Y SEXO</th>
                  <th colspan="2">Pueblos Originarios</th>
                  <th colspan="2">Migrantes</th>
                </tr>
                <tr>
                  <th rowspan="2">Ambos sexos</th>
                  <th rowspan="2">Hombres</th>
                  <th rowspan="2">Mujeres</th>
                  <th colspan="2">15 a 19 años</th>
                  <th colspan="2">20 a 24 años</th>
                  <th colspan="2">25 a 29 años</th>
                  <th colspan="2">30 a 34 años</th>
                  <th colspan="2">35 a 39 años</th>
                  <th colspan="2">40 a 44 años</th>
                  <th colspan="2">45 a 49 años</th>
                  <th colspan="2">50 a 54 años</th>
                  <th colspan="2">55 a 59 años</th>
                  <th colspan="2">60 a 64 años</th>
                  <th colspan="2">65 a 69 años</th>
                  <th colspan="2">70 a 74 años</th>
                  <th colspan="2">75 a 79 años</th>
                  <th colspan="2">80 y más años</th>
                  <th rowspan="2">Hombres</th>
                  <th rowspan="2">Mujeres</th>
                  <th rowspan="2">Hombres</th>
                  <th rowspan="2">Mujeres</th>
                </tr>
                <tr>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                  <th>Hombres</th>
                  <th>Mujeres</th>
                </tr>
              </thead>
              <tbody id="remp-metas-body">
                <!-- Personas Bajo Control por Hipertensión -->
                <tr>
                  <td
                    class="concepto-col fw-bold bg-info text-white"
                    colspan="35"
                  >
                    Personas Bajo Control por Hipertensión
                  </td>
                </tr>
                <tr>
                  <td class="concepto-col">PA &lt; 140/90 mmHg</td>
                  <td class="celda-activa" id="pa140-total">0</td>
                  <td class="celda-activa" id="pa140-h">0</td>
                  <td class="celda-activa" id="pa140-m">0</td>
                  <!-- 15-19 años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-15-19-h">0</td>
                  <td class="celda-activa" id="pa140-15-19-m">0</td>
                  <!-- 20-24 años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-20-24-h">0</td>
                  <td class="celda-activa" id="pa140-20-24-m">0</td>
                  <!-- 25-29 años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-25-29-h">0</td>
                  <td class="celda-activa" id="pa140-25-29-m">0</td>
                  <!-- 30-34 años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-30-34-h">0</td>
                  <td class="celda-activa" id="pa140-30-34-m">0</td>
                  <!-- 35-39 años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-35-39-h">0</td>
                  <td class="celda-activa" id="pa140-35-39-m">0</td>
                  <!-- 40-44 años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-40-44-h">0</td>
                  <td class="celda-activa" id="pa140-40-44-m">0</td>
                  <!-- 45-49 años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-45-49-h">0</td>
                  <td class="celda-activa" id="pa140-45-49-m">0</td>
                  <!-- 50-54 años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-50-54-h">0</td>
                  <td class="celda-activa" id="pa140-50-54-m">0</td>
                  <!-- 55-59 años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-55-59-h">0</td>
                  <td class="celda-activa" id="pa140-55-59-m">0</td>
                  <!-- 60-64 años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-60-64-h">0</td>
                  <td class="celda-activa" id="pa140-60-64-m">0</td>
                  <!-- 65-69 años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-65-69-h">0</td>
                  <td class="celda-activa" id="pa140-65-69-m">0</td>
                  <!-- 70-74 años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-70-74-h">0</td>
                  <td class="celda-activa" id="pa140-70-74-m">0</td>
                  <!-- 75-79 años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-75-79-h">0</td>
                  <td class="celda-activa" id="pa140-75-79-m">0</td>
                  <!-- 80+ años: ACTIVAS -->
                  <td class="celda-activa" id="pa140-80-mas-h">0</td>
                  <td class="celda-activa" id="pa140-80-mas-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>
                <tr>
                  <td class="concepto-col">PA &lt; 150/90 mmHg</td>
                  <td class="celda-activa" id="pa150-total">0</td>
                  <td class="celda-activa" id="pa150-h">0</td>
                  <td class="celda-activa" id="pa150-m">0</td>
                  <!-- 15-19 a 79 años: BLOQUEADAS para PA 150/90 (solo ≥80 años) -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 80+ años: ACTIVAS para PA 150/90 -->
                  <td class="celda-activa" id="pa150-80-mas-h">0</td>
                  <td class="celda-activa" id="pa150-80-mas-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>

                <!-- Personas Bajo Control por Diabetes Mellitus -->
                <tr>
                  <td
                    class="concepto-col fw-bold bg-warning text-dark"
                    colspan="35"
                  >
                    Personas Bajo Control por Diabetes Mellitus
                  </td>
                </tr>
                <tr>
                  <td class="concepto-col">HbA1C&lt;7%</td>
                  <td class="celda-activa" id="hba1c7-total">0</td>
                  <td class="celda-activa" id="hba1c7-h">0</td>
                  <td class="celda-activa" id="hba1c7-m">0</td>
                  <!-- 15-19 años: ACTIVAS -->
                  <td class="celda-activa" id="hba1c7-15-19-h">0</td>
                  <td class="celda-activa" id="hba1c7-15-19-m">0</td>
                  <!-- 20-24 años: ACTIVAS -->
                  <td class="celda-activa" id="hba1c7-20-24-h">0</td>
                  <td class="celda-activa" id="hba1c7-20-24-m">0</td>
                  <!-- 15-19 a 64 años: ACTIVAS para HbA1c<7% -->
                  <td class="celda-activa" id="hba1c7-25-29-h">0</td>
                  <td class="celda-activa" id="hba1c7-25-29-m">0</td>
                  <td class="celda-activa" id="hba1c7-30-34-h">0</td>
                  <td class="celda-activa" id="hba1c7-30-34-m">0</td>
                  <td class="celda-activa" id="hba1c7-35-39-h">0</td>
                  <td class="celda-activa" id="hba1c7-35-39-m">0</td>
                  <td class="celda-activa" id="hba1c7-40-44-h">0</td>
                  <td class="celda-activa" id="hba1c7-40-44-m">0</td>
                  <td class="celda-activa" id="hba1c7-45-49-h">0</td>
                  <td class="celda-activa" id="hba1c7-45-49-m">0</td>
                  <td class="celda-activa" id="hba1c7-50-54-h">0</td>
                  <td class="celda-activa" id="hba1c7-50-54-m">0</td>
                  <td class="celda-activa" id="hba1c7-55-59-h">0</td>
                  <td class="celda-activa" id="hba1c7-55-59-m">0</td>
                  <td class="celda-activa" id="hba1c7-60-64-h">0</td>
                  <td class="celda-activa" id="hba1c7-60-64-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>
                <tr>
                  <td class="concepto-col">HbA1C&lt;8%</td>
                  <td class="celda-activa" id="hba1c8-total">0</td>
                  <td class="celda-activa" id="hba1c8-h">0</td>
                  <td class="celda-activa" id="hba1c8-m">0</td>
                  <!-- 15-19 a 60-64 años: BLOQUEADAS para HbA1c<8% (solo ≥80 años) -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>

                <!-- Personas con RCV alto -->
                <tr>
                  <td
                    class="concepto-col fw-bold bg-danger text-white"
                    colspan="35"
                  >
                    Personas con RCV alto
                  </td>
                </tr>
                <tr>
                  <td class="concepto-col">Colesterol LDL &lt; 70 mg/dL</td>
                  <td class="celda-activa" id="ldl70-total">0</td>
                  <td class="celda-activa" id="ldl70-h">0</td>
                  <td class="celda-activa" id="ldl70-m">0</td>
                  <!-- 15-19 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 20-24 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 25-29 a 60-64 años: ACTIVAS -->
                  <td class="celda-activa" id="ldl70-25-29-h">0</td>
                  <td class="celda-activa" id="ldl70-25-29-m">0</td>
                  <td class="celda-activa" id="ldl70-30-34-h">0</td>
                  <td class="celda-activa" id="ldl70-30-34-m">0</td>
                  <td class="celda-activa" id="ldl70-35-39-h">0</td>
                  <td class="celda-activa" id="ldl70-35-39-m">0</td>
                  <td class="celda-activa" id="ldl70-40-44-h">0</td>
                  <td class="celda-activa" id="ldl70-40-44-m">0</td>
                  <td class="celda-activa" id="ldl70-45-49-h">0</td>
                  <td class="celda-activa" id="ldl70-45-49-m">0</td>
                  <td class="celda-activa" id="ldl70-50-54-h">0</td>
                  <td class="celda-activa" id="ldl70-50-54-m">0</td>
                  <td class="celda-activa" id="ldl70-55-59-h">0</td>
                  <td class="celda-activa" id="ldl70-55-59-m">0</td>
                  <td class="celda-activa" id="ldl70-60-64-h">0</td>
                  <td class="celda-activa" id="ldl70-60-64-m">0</td>
                  <!-- 65-69 años: ACTIVAS -->
                  <td class="celda-activa" id="ldl70-65-69-h">0</td>
                  <td class="celda-activa" id="ldl70-65-69-m">0</td>
                  <!-- 70-74 años: ACTIVAS -->
                  <td class="celda-activa" id="ldl70-70-74-h">0</td>
                  <td class="celda-activa" id="ldl70-70-74-m">0</td>
                  <!-- 75-79 años: ACTIVAS -->
                  <td class="celda-activa" id="ldl70-75-79-h">0</td>
                  <td class="celda-activa" id="ldl70-75-79-m">0</td>
                  <!-- 80+ años: ACTIVAS -->
                  <td class="celda-activa" id="ldl70-80-mas-h">0</td>
                  <td class="celda-activa" id="ldl70-80-mas-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>

                <!-- Personas bajo control con antecedentes enfermedad cardiovascular (ECV), excepto IAM y ACV -->
                <tr>
                  <td
                    class="concepto-col fw-bold bg-secondary text-white"
                    colspan="27"
                  >
                    Personas bajo control con antecedentes enfermedad
                    cardiovascular (ECV), excepto IAM y ACV
                  </td>
                </tr>
                <tr>
                  <td class="concepto-col">
                    En tratamiento con Antiagregantes plaquetarios
                  </td>
                  <td class="celda-activa" id="ecv-antiag-total">0</td>
                  <td class="celda-activa" id="ecv-antiag-h">0</td>
                  <td class="celda-activa" id="ecv-antiag-m">0</td>
                  <!-- 15-19 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 20-24 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 25-29 a 60-64 años: ACTIVAS -->
                  <td class="celda-activa" id="ecv-antiag-25-29-h">0</td>
                  <td class="celda-activa" id="ecv-antiag-25-29-m">0</td>
                  <td class="celda-activa" id="ecv-antiag-30-34-h">0</td>
                  <td class="celda-activa" id="ecv-antiag-30-34-m">0</td>
                  <td class="celda-activa" id="ecv-antiag-35-39-h">0</td>
                  <td class="celda-activa" id="ecv-antiag-35-39-m">0</td>
                  <td class="celda-activa" id="ecv-antiag-40-44-h">0</td>
                  <td class="celda-activa" id="ecv-antiag-40-44-m">0</td>
                  <td class="celda-activa" id="ecv-antiag-45-49-h">0</td>
                  <td class="celda-activa" id="ecv-antiag-45-49-m">0</td>
                  <td class="celda-activa" id="ecv-antiag-50-54-h">0</td>
                  <td class="celda-activa" id="ecv-antiag-50-54-m">0</td>
                  <td class="celda-activa" id="ecv-antiag-55-59-h">0</td>
                  <td class="celda-activa" id="ecv-antiag-55-59-m">0</td>
                  <td class="celda-activa" id="ecv-antiag-60-64-h">0</td>
                  <td class="celda-activa" id="ecv-antiag-60-64-m">0</td>
                  <!-- 65-69 años: ACTIVAS -->
                  <td class="celda-activa" id="ecv-antiag-65-69-h">0</td>
                  <td class="celda-activa" id="ecv-antiag-65-69-m">0</td>
                  <!-- 70-74 años: ACTIVAS -->
                  <td class="celda-activa" id="ecv-antiag-70-74-h">0</td>
                  <td class="celda-activa" id="ecv-antiag-70-74-m">0</td>
                  <!-- 75-79 años: ACTIVAS -->
                  <td class="celda-activa" id="ecv-antiag-75-79-h">0</td>
                  <td class="celda-activa" id="ecv-antiag-75-79-m">0</td>
                  <!-- 80+ años: ACTIVAS -->
                  <td class="celda-activa" id="ecv-antiag-80-mas-h">0</td>
                  <td class="celda-activa" id="ecv-antiag-80-mas-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>
                <tr>
                  <td class="concepto-col">En tratamiento con Estatina</td>
                  <td class="celda-activa" id="ecv-estatina-total">0</td>
                  <td class="celda-activa" id="ecv-estatina-h">0</td>
                  <td class="celda-activa" id="ecv-estatina-m">0</td>
                  <!-- 15-19 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 20-24 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 25-29 a 60-64 años: ACTIVAS -->
                  <td class="celda-activa" id="ecv-estatina-25-29-h">0</td>
                  <td class="celda-activa" id="ecv-estatina-25-29-m">0</td>
                  <td class="celda-activa" id="ecv-estatina-30-34-h">0</td>
                  <td class="celda-activa" id="ecv-estatina-30-34-m">0</td>
                  <td class="celda-activa" id="ecv-estatina-35-39-h">0</td>
                  <td class="celda-activa" id="ecv-estatina-35-39-m">0</td>
                  <td class="celda-activa" id="ecv-estatina-40-44-h">0</td>
                  <td class="celda-activa" id="ecv-estatina-40-44-m">0</td>
                  <td class="celda-activa" id="ecv-estatina-45-49-h">0</td>
                  <td class="celda-activa" id="ecv-estatina-45-49-m">0</td>
                  <td class="celda-activa" id="ecv-estatina-50-54-h">0</td>
                  <td class="celda-activa" id="ecv-estatina-50-54-m">0</td>
                  <td class="celda-activa" id="ecv-estatina-55-59-h">0</td>
                  <td class="celda-activa" id="ecv-estatina-55-59-m">0</td>
                  <td class="celda-activa" id="ecv-estatina-60-64-h">0</td>
                  <td class="celda-activa" id="ecv-estatina-60-64-m">0</td>
                  <!-- 65-69 años: ACTIVAS -->
                  <td class="celda-activa" id="ecv-estatina-65-69-h">0</td>
                  <td class="celda-activa" id="ecv-estatina-65-69-m">0</td>
                  <!-- 70-74 años: ACTIVAS -->
                  <td class="celda-activa" id="ecv-estatina-70-74-h">0</td>
                  <td class="celda-activa" id="ecv-estatina-70-74-m">0</td>
                  <!-- 75-79 años: ACTIVAS -->
                  <td class="celda-activa" id="ecv-estatina-75-79-h">0</td>
                  <td class="celda-activa" id="ecv-estatina-75-79-m">0</td>
                  <!-- 80+ años: ACTIVAS -->
                  <td class="celda-activa" id="ecv-estatina-80-mas-h">0</td>
                  <td class="celda-activa" id="ecv-estatina-80-mas-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>
                <tr>
                  <td class="concepto-col">Fumador actual</td>
                  <td class="celda-activa" id="ecv-fumador-total">0</td>
                  <td class="celda-activa" id="ecv-fumador-h">0</td>
                  <td class="celda-activa" id="ecv-fumador-m">0</td>
                  <!-- 15-19 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 20-24 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 25-29 a 60-64 años: ACTIVAS -->
                  <td class="celda-activa" id="ecv-fumador-25-29-h">0</td>
                  <td class="celda-activa" id="ecv-fumador-25-29-m">0</td>
                  <td class="celda-activa" id="ecv-fumador-30-34-h">0</td>
                  <td class="celda-activa" id="ecv-fumador-30-34-m">0</td>
                  <td class="celda-activa" id="ecv-fumador-35-39-h">0</td>
                  <td class="celda-activa" id="ecv-fumador-35-39-m">0</td>
                  <td class="celda-activa" id="ecv-fumador-40-44-h">0</td>
                  <td class="celda-activa" id="ecv-fumador-40-44-m">0</td>
                  <td class="celda-activa" id="ecv-fumador-45-49-h">0</td>
                  <td class="celda-activa" id="ecv-fumador-45-49-m">0</td>
                  <td class="celda-activa" id="ecv-fumador-50-54-h">0</td>
                  <td class="celda-activa" id="ecv-fumador-50-54-m">0</td>
                  <td class="celda-activa" id="ecv-fumador-55-59-h">0</td>
                  <td class="celda-activa" id="ecv-fumador-55-59-m">0</td>
                  <td class="celda-activa" id="ecv-fumador-60-64-h">0</td>
                  <td class="celda-activa" id="ecv-fumador-60-64-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>

                <!-- Personas bajo control con antecedentes de Infarto agudo al miocardio (IAM) -->
                <tr>
                  <td
                    class="concepto-col fw-bold bg-dark text-white"
                    colspan="27"
                  >
                    Personas bajo control con antecedentes de Infarto agudo al
                    miocardio (IAM)
                  </td>
                </tr>
                <tr>
                  <td class="concepto-col">
                    En tratamiento con Antiagregantes plaquetarios
                  </td>
                  <td class="celda-activa" id="iam-antiag-total">0</td>
                  <td class="celda-activa" id="iam-antiag-h">0</td>
                  <td class="celda-activa" id="iam-antiag-m">0</td>
                  <!-- 15-19 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 20-24 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 25-29 a 60-64 años: ACTIVAS -->
                  <td class="celda-activa" id="iam-antiag-25-29-h">0</td>
                  <td class="celda-activa" id="iam-antiag-25-29-m">0</td>
                  <td class="celda-activa" id="iam-antiag-30-34-h">0</td>
                  <td class="celda-activa" id="iam-antiag-30-34-m">0</td>
                  <td class="celda-activa" id="iam-antiag-35-39-h">0</td>
                  <td class="celda-activa" id="iam-antiag-35-39-m">0</td>
                  <td class="celda-activa" id="iam-antiag-40-44-h">0</td>
                  <td class="celda-activa" id="iam-antiag-40-44-m">0</td>
                  <td class="celda-activa" id="iam-antiag-45-49-h">0</td>
                  <td class="celda-activa" id="iam-antiag-45-49-m">0</td>
                  <td class="celda-activa" id="iam-antiag-50-54-h">0</td>
                  <td class="celda-activa" id="iam-antiag-50-54-m">0</td>
                  <td class="celda-activa" id="iam-antiag-55-59-h">0</td>
                  <td class="celda-activa" id="iam-antiag-55-59-m">0</td>
                  <td class="celda-activa" id="iam-antiag-60-64-h">0</td>
                  <td class="celda-activa" id="iam-antiag-60-64-m">0</td>
                  <!-- 65-69 años: ACTIVAS -->
                  <td class="celda-activa" id="iam-antiag-65-69-h">0</td>
                  <td class="celda-activa" id="iam-antiag-65-69-m">0</td>
                  <!-- 70-74 años: ACTIVAS -->
                  <td class="celda-activa" id="iam-antiag-70-74-h">0</td>
                  <td class="celda-activa" id="iam-antiag-70-74-m">0</td>
                  <!-- 75-79 años: ACTIVAS -->
                  <td class="celda-activa" id="iam-antiag-75-79-h">0</td>
                  <td class="celda-activa" id="iam-antiag-75-79-m">0</td>
                  <!-- 80+ años: ACTIVAS -->
                  <td class="celda-activa" id="iam-antiag-80-mas-h">0</td>
                  <td class="celda-activa" id="iam-antiag-80-mas-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>
                <tr>
                  <td class="concepto-col">En tratamiento con Estatina</td>
                  <td class="celda-activa" id="iam-estatina-total">0</td>
                  <td class="celda-activa" id="iam-estatina-h">0</td>
                  <td class="celda-activa" id="iam-estatina-m">0</td>
                  <!-- 15-19 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 20-24 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 25-29 a 60-64 años: ACTIVAS -->
                  <td class="celda-activa" id="iam-estatina-25-29-h">0</td>
                  <td class="celda-activa" id="iam-estatina-25-29-m">0</td>
                  <td class="celda-activa" id="iam-estatina-30-34-h">0</td>
                  <td class="celda-activa" id="iam-estatina-30-34-m">0</td>
                  <td class="celda-activa" id="iam-estatina-35-39-h">0</td>
                  <td class="celda-activa" id="iam-estatina-35-39-m">0</td>
                  <td class="celda-activa" id="iam-estatina-40-44-h">0</td>
                  <td class="celda-activa" id="iam-estatina-40-44-m">0</td>
                  <td class="celda-activa" id="iam-estatina-45-49-h">0</td>
                  <td class="celda-activa" id="iam-estatina-45-49-m">0</td>
                  <td class="celda-activa" id="iam-estatina-50-54-h">0</td>
                  <td class="celda-activa" id="iam-estatina-50-54-m">0</td>
                  <td class="celda-activa" id="iam-estatina-55-59-h">0</td>
                  <td class="celda-activa" id="iam-estatina-55-59-m">0</td>
                  <td class="celda-activa" id="iam-estatina-60-64-h">0</td>
                  <td class="celda-activa" id="iam-estatina-60-64-m">0</td>
                  <!-- 65-69 años: ACTIVAS -->
                  <td class="celda-activa" id="iam-estatina-65-69-h">0</td>
                  <td class="celda-activa" id="iam-estatina-65-69-m">0</td>
                  <!-- 70-74 años: ACTIVAS -->
                  <td class="celda-activa" id="iam-estatina-70-74-h">0</td>
                  <td class="celda-activa" id="iam-estatina-70-74-m">0</td>
                  <!-- 75-79 años: ACTIVAS -->
                  <td class="celda-activa" id="iam-estatina-75-79-h">0</td>
                  <td class="celda-activa" id="iam-estatina-75-79-m">0</td>
                  <!-- 80+ años: ACTIVAS -->
                  <td class="celda-activa" id="iam-estatina-80-mas-h">0</td>
                  <td class="celda-activa" id="iam-estatina-80-mas-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>
                <tr>
                  <td class="concepto-col">Fumador actual</td>
                  <td class="celda-activa" id="iam-fumador-total">0</td>
                  <td class="celda-activa" id="iam-fumador-h">0</td>
                  <td class="celda-activa" id="iam-fumador-m">0</td>
                  <!-- 15-19 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 20-24 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 25-29 a 60-64 años: ACTIVAS -->
                  <td class="celda-activa" id="iam-fumador-25-29-h">0</td>
                  <td class="celda-activa" id="iam-fumador-25-29-m">0</td>
                  <td class="celda-activa" id="iam-fumador-30-34-h">0</td>
                  <td class="celda-activa" id="iam-fumador-30-34-m">0</td>
                  <td class="celda-activa" id="iam-fumador-35-39-h">0</td>
                  <td class="celda-activa" id="iam-fumador-35-39-m">0</td>
                  <td class="celda-activa" id="iam-fumador-40-44-h">0</td>
                  <td class="celda-activa" id="iam-fumador-40-44-m">0</td>
                  <td class="celda-activa" id="iam-fumador-45-49-h">0</td>
                  <td class="celda-activa" id="iam-fumador-45-49-m">0</td>
                  <td class="celda-activa" id="iam-fumador-50-54-h">0</td>
                  <td class="celda-activa" id="iam-fumador-50-54-m">0</td>
                  <td class="celda-activa" id="iam-fumador-55-59-h">0</td>
                  <td class="celda-activa" id="iam-fumador-55-59-m">0</td>
                  <td class="celda-activa" id="iam-fumador-60-64-h">0</td>
                  <td class="celda-activa" id="iam-fumador-60-64-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>

                <!-- Personas bajo control con Antecedentes de Ataque Cerebrovascular (ACV) -->
                <tr>
                  <td
                    class="concepto-col fw-bold bg-success text-white"
                    colspan="27"
                  >
                    Personas bajo control con Antecedentes de Ataque
                    Cerebrovascular (ACV)
                  </td>
                </tr>
                <tr>
                  <td class="concepto-col">
                    En tratamiento con Antiagregantes plaquetarios
                  </td>
                  <td class="celda-activa" id="acv-antiag-total">0</td>
                  <td class="celda-activa" id="acv-antiag-h">0</td>
                  <td class="celda-activa" id="acv-antiag-m">0</td>
                  <!-- 15-19 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 20-24 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 25-29 a 60-64 años: ACTIVAS -->
                  <td class="celda-activa" id="acv-antiag-25-29-h">0</td>
                  <td class="celda-activa" id="acv-antiag-25-29-m">0</td>
                  <td class="celda-activa" id="acv-antiag-30-34-h">0</td>
                  <td class="celda-activa" id="acv-antiag-30-34-m">0</td>
                  <td class="celda-activa" id="acv-antiag-35-39-h">0</td>
                  <td class="celda-activa" id="acv-antiag-35-39-m">0</td>
                  <td class="celda-activa" id="acv-antiag-40-44-h">0</td>
                  <td class="celda-activa" id="acv-antiag-40-44-m">0</td>
                  <td class="celda-activa" id="acv-antiag-45-49-h">0</td>
                  <td class="celda-activa" id="acv-antiag-45-49-m">0</td>
                  <td class="celda-activa" id="acv-antiag-50-54-h">0</td>
                  <td class="celda-activa" id="acv-antiag-50-54-m">0</td>
                  <td class="celda-activa" id="acv-antiag-55-59-h">0</td>
                  <td class="celda-activa" id="acv-antiag-55-59-m">0</td>
                  <td class="celda-activa" id="acv-antiag-60-64-h">0</td>
                  <td class="celda-activa" id="acv-antiag-60-64-m">0</td>
                  <!-- 65-69 años: ACTIVAS -->
                  <td class="celda-activa" id="acv-antiag-65-69-h">0</td>
                  <td class="celda-activa" id="acv-antiag-65-69-m">0</td>
                  <!-- 70-74 años: ACTIVAS -->
                  <td class="celda-activa" id="acv-antiag-70-74-h">0</td>
                  <td class="celda-activa" id="acv-antiag-70-74-m">0</td>
                  <!-- 75-79 años: ACTIVAS -->
                  <td class="celda-activa" id="acv-antiag-75-79-h">0</td>
                  <td class="celda-activa" id="acv-antiag-75-79-m">0</td>
                  <!-- 80+ años: ACTIVAS -->
                  <td class="celda-activa" id="acv-antiag-80-mas-h">0</td>
                  <td class="celda-activa" id="acv-antiag-80-mas-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>
                <tr>
                  <td class="concepto-col">En tratamiento con Estatina</td>
                  <td class="celda-activa" id="acv-estatina-total">0</td>
                  <td class="celda-activa" id="acv-estatina-h">0</td>
                  <td class="celda-activa" id="acv-estatina-m">0</td>
                  <!-- 15-19 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 20-24 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 25-29 a 60-64 años: ACTIVAS -->
                  <td class="celda-activa" id="acv-estatina-25-29-h">0</td>
                  <td class="celda-activa" id="acv-estatina-25-29-m">0</td>
                  <td class="celda-activa" id="acv-estatina-30-34-h">0</td>
                  <td class="celda-activa" id="acv-estatina-30-34-m">0</td>
                  <td class="celda-activa" id="acv-estatina-35-39-h">0</td>
                  <td class="celda-activa" id="acv-estatina-35-39-m">0</td>
                  <td class="celda-activa" id="acv-estatina-40-44-h">0</td>
                  <td class="celda-activa" id="acv-estatina-40-44-m">0</td>
                  <td class="celda-activa" id="acv-estatina-45-49-h">0</td>
                  <td class="celda-activa" id="acv-estatina-45-49-m">0</td>
                  <td class="celda-activa" id="acv-estatina-50-54-h">0</td>
                  <td class="celda-activa" id="acv-estatina-50-54-m">0</td>
                  <td class="celda-activa" id="acv-estatina-55-59-h">0</td>
                  <td class="celda-activa" id="acv-estatina-55-59-m">0</td>
                  <td class="celda-activa" id="acv-estatina-60-64-h">0</td>
                  <td class="celda-activa" id="acv-estatina-60-64-m">0</td>
                  <!-- 65-69 años: ACTIVAS -->
                  <td class="celda-activa" id="acv-estatina-65-69-h">0</td>
                  <td class="celda-activa" id="acv-estatina-65-69-m">0</td>
                  <!-- 70-74 años: ACTIVAS -->
                  <td class="celda-activa" id="acv-estatina-70-74-h">0</td>
                  <td class="celda-activa" id="acv-estatina-70-74-m">0</td>
                  <!-- 75-79 años: ACTIVAS -->
                  <td class="celda-activa" id="acv-estatina-75-79-h">0</td>
                  <td class="celda-activa" id="acv-estatina-75-79-m">0</td>
                  <!-- 80+ años: ACTIVAS -->
                  <td class="celda-activa" id="acv-estatina-80-mas-h">0</td>
                  <td class="celda-activa" id="acv-estatina-80-mas-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>
                <tr>
                  <td class="concepto-col">Fumador actual</td>
                  <td class="celda-activa" id="acv-fumador-total">0</td>
                  <td class="celda-activa" id="acv-fumador-h">0</td>
                  <td class="celda-activa" id="acv-fumador-m">0</td>
                  <!-- 15-19 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 20-24 años: BLOQUEADAS -->
                  <td class="celda-bloqueada">-</td>
                  <td class="celda-bloqueada">-</td>
                  <!-- 25-29 a 60-64 años: ACTIVAS -->
                  <td class="celda-activa" id="acv-fumador-25-29-h">0</td>
                  <td class="celda-activa" id="acv-fumador-25-29-m">0</td>
                  <td class="celda-activa" id="acv-fumador-30-34-h">0</td>
                  <td class="celda-activa" id="acv-fumador-30-34-m">0</td>
                  <td class="celda-activa" id="acv-fumador-35-39-h">0</td>
                  <td class="celda-activa" id="acv-fumador-35-39-m">0</td>
                  <td class="celda-activa" id="acv-fumador-40-44-h">0</td>
                  <td class="celda-activa" id="acv-fumador-40-44-m">0</td>
                  <td class="celda-activa" id="acv-fumador-45-49-h">0</td>
                  <td class="celda-activa" id="acv-fumador-45-49-m">0</td>
                  <td class="celda-activa" id="acv-fumador-50-54-h">0</td>
                  <td class="celda-activa" id="acv-fumador-50-54-m">0</td>
                  <td class="celda-activa" id="acv-fumador-55-59-h">0</td>
                  <td class="celda-activa" id="acv-fumador-55-59-m">0</td>
                  <td class="celda-activa" id="acv-fumador-60-64-h">0</td>
                  <td class="celda-activa" id="acv-fumador-60-64-m">0</td>
                  <!-- Pueblos Originarios -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                  <!-- Migrantes -->
                  <td class="celda-bloqueada">0</td>
                  <td class="celda-bloqueada">0</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div id="metas-status" class="small text-muted mt-2"></div>
        </div>
      </div>

      <!-- NUEVA SECCIÓN: EVALUACIÓN DE DIABETES EN PSCV (MANUAL REM-P 2025) -->
      <div class="card mb-4" id="diabetes-evaluacion-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
              EVALUACIÓN DE DIABETES EN PSCV (MANUAL REM-P 2025)
            </h5>
            <small class="text-muted"
              >Evaluación integral de personas con diabetes según normativa
              vigente</small
            >
          </div>
          <div class="row mt-3">
            <!-- Panel de resumen general -->
            <div class="col-md-3">
              <div class="card bg-light">
                <div class="card-body text-center">
                  <h6 class="card-title text-primary">Total Diabetes PSCV</h6>
                  <h3 class="text-primary mb-0" id="diabetes-total">0</h3>
                </div>
              </div>
            </div>
            <!-- Panel de métricas principales -->
            <div class="col-md-9">
              <div class="row">
                <div class="col-sm-6 col-md-3 mb-3">
                  <div class="card border-success">
                    <div class="card-body text-center p-2">
                      <small class="text-success">Meta HbA1c por edad</small>
                      <h5 class="text-success mb-0" id="diabetes-meta-hba1c">
                        0
                      </h5>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 col-md-3 mb-3">
                  <div class="card border-warning">
                    <div class="card-body text-center p-2">
                      <small class="text-warning">HbA1c ≥ 9%</small>
                      <h5 class="text-warning mb-0" id="diabetes-hba1c-alto">
                        0
                      </h5>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 col-md-3 mb-3">
                  <div class="card border-info">
                    <div class="card-body text-center p-2">
                      <small class="text-info">Atención Podológica</small>
                      <h5 class="text-info mb-0" id="diabetes-podologia">0</h5>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 col-md-3 mb-3">
                  <div class="card border-danger">
                    <div class="card-body text-center p-2">
                      <small class="text-danger">Hipoglicemias</small>
                      <h5 class="text-danger mb-0" id="diabetes-hipoglicemias">
                        0
                      </h5>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tabla detallada de métricas -->
          <div class="table-responsive mt-4">
            <table
              class="table table-sm table-striped table-bordered align-middle"
              id="tabla-diabetes-evaluacion"
              data-export-name="Diabetes - Evaluación REM-P 2025"
            >
              <thead class="table-dark">
                <tr>
                  <th style="min-width: 300px">MÉTRICA DE EVALUACIÓN</th>
                  <th style="min-width: 100px">TOTAL</th>
                  <th style="min-width: 120px">% DEL TOTAL</th>
                  <th style="min-width: 150px">DESCRIPCIÓN</th>
                </tr>
              </thead>
              <tbody id="diabetes-evaluacion-body">
                <!-- Será llenado dinámicamente por JavaScript -->
              </tbody>
            </table>
          </div>
          <div id="diabetes-evaluacion-status" class="small text-muted"></div>
        </div>
      </div>

      <!-- NUEVA SECCIÓN: EVALUACIÓN DE HIPERTENSIÓN EN PSCV (MANUAL REM-P 2025) -->
      <div class="card mb-4" id="hipertension-evaluacion-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
              EVALUACIÓN DE HIPERTENSIÓN EN PSCV (MANUAL REM-P 2025)
            </h5>
            <small class="text-muted"
              >Evaluación integral de personas con hipertensión según normativa
              vigente</small
            >
          </div>
          <div class="row mt-3">
            <!-- Panel de resumen general -->
            <div class="col-md-3">
              <div class="card bg-light">
                <div class="card-body text-center">
                  <h6 class="card-title text-danger">
                    Total Hipertensión PSCV
                  </h6>
                  <h3 class="text-danger mb-0" id="hipertension-total">0</h3>
                </div>
              </div>
            </div>
            <!-- Panel de métricas principales -->
            <div class="col-md-9">
              <div class="row">
                <div class="col-sm-6 col-md-3 mb-3">
                  <div class="card border-warning">
                    <div class="card-body text-center p-2">
                      <small class="text-warning">PA ≥ 160/100</small>
                      <h5 class="text-warning mb-0" id="hipertension-pa-alta">
                        0
                      </h5>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 col-md-3 mb-3">
                  <div class="card border-info">
                    <div class="card-body text-center p-2">
                      <small class="text-info">Protocolo HEARTS</small>
                      <h5 class="text-info mb-0" id="hipertension-hearts">0</h5>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 col-md-3 mb-3">
                  <div class="card border-success">
                    <div class="card-body text-center p-2">
                      <small class="text-success">RAC Vigente</small>
                      <h5 class="text-success mb-0" id="hipertension-rac">0</h5>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 col-md-3 mb-3">
                  <div class="card border-secondary">
                    <div class="card-body text-center p-2">
                      <small class="text-secondary">VFG Vigente</small>
                      <h5 class="text-secondary mb-0" id="hipertension-vfg">
                        0
                      </h5>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tabla detallada de métricas -->
          <div class="table-responsive mt-4">
            <table
              class="table table-sm table-striped table-bordered align-middle"
              id="tabla-hipertension-evaluacion"
              data-export-name="Hipertensión - Evaluación REM-P 2025"
            >
              <thead class="table-dark">
                <tr>
                  <th style="min-width: 300px">MÉTRICA DE EVALUACIÓN</th>
                  <th style="min-width: 100px">TOTAL</th>
                  <th style="min-width: 120px">% DEL TOTAL</th>
                  <th style="min-width: 150px">DESCRIPCIÓN</th>
                </tr>
              </thead>
              <tbody id="hipertension-evaluacion-body">
                <!-- Será llenado dinámicamente por JavaScript -->
              </tbody>
            </table>
          </div>
          <div
            id="hipertension-evaluacion-status"
            class="small text-muted"
          ></div>
        </div>
      </div>

      <!-- NUEVA SECCIÓN: TODAS LAS PERSONAS EN PSCV (MANUAL REM-P 2025) -->
      <div class="card mb-4" id="todas-personas-pscv-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
              TODAS LAS PERSONAS EN PSCV (MANUAL REM-P 2025)
            </h5>
            <small class="text-muted"
              >Población completa en programa salud cardiovascular</small
            >
          </div>
          <div class="row mt-3">
            <!-- Panel de resumen general -->
            <div class="col-md-3">
              <div class="card bg-light">
                <div class="card-body text-center">
                  <h6 class="card-title text-primary">Total Personas PSCV</h6>
                  <h3 class="text-primary mb-0" id="todas-pscv-total">0</h3>
                </div>
              </div>
            </div>
            <!-- Panel de métricas principales -->
            <div class="col-md-9">
              <div class="row">
                <div class="col-sm-6 col-md-3 mb-3">
                  <div class="card border-warning">
                    <div class="card-body text-center p-2">
                      <small class="text-warning">Sobrepeso/Obesidad</small>
                      <h5
                        class="text-warning mb-0"
                        id="todas-pscv-sobrepeso-obesidad"
                      >
                        0
                      </h5>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 col-md-3 mb-3">
                  <div class="card border-success">
                    <div class="card-body text-center p-2">
                      <small class="text-success">Actividad Física</small>
                      <h5 class="text-success mb-0" id="todas-pscv-actividad">
                        0
                      </h5>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 col-md-3 mb-3">
                  <div class="card border-danger">
                    <div class="card-body text-center p-2">
                      <small class="text-danger">Fumador Actual</small>
                      <h5 class="text-danger mb-0" id="todas-pscv-fumador">
                        0
                      </h5>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 col-md-3 mb-3">
                  <div class="card border-info">
                    <div class="card-body text-center p-2">
                      <small class="text-info">Con ERC</small>
                      <h5 class="text-info mb-0" id="todas-pscv-erc">0</h5>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tabla detallada de métricas -->
          <div class="table-responsive mt-4">
            <table
              class="table table-sm table-striped table-bordered align-middle"
              id="tabla-todas-personas-pscv"
              data-export-name="Todas Personas PSCV - REM-P 2025"
            >
              <thead class="table-dark">
                <tr>
                  <th style="min-width: 300px">MÉTRICA DE EVALUACIÓN</th>
                  <th style="min-width: 100px">TOTAL</th>
                  <th style="min-width: 120px">% DEL TOTAL</th>
                  <th style="min-width: 150px">DESCRIPCIÓN</th>
                </tr>
              </thead>
              <tbody id="todas-personas-pscv-body">
                <!-- Será llenado dinámicamente por JavaScript -->
              </tbody>
            </table>
          </div>
          <div id="todas-personas-pscv-status" class="small text-muted"></div>
        </div>
      </div>

      <!-- P5 SECCIÓN A: POBLACIÓN EN CONTROL POR CONDICIÓN DE FUNCIONALIDAD -->
      <div class="card mb-4" id="p5-funcionalidad-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
              P5 SECCIÓN A: POBLACIÓN EN CONTROL POR CONDICIÓN DE FUNCIONALIDAD
            </h5>
          </div>
          <div
            class="table-responsive table-sticky-wrap mt-3"
            style="overflow-x: auto"
          >
            <table
              class="table table-sm table-striped table-bordered align-middle table-sticky"
              id="tabla-p5-funcionalidad"
              data-export-name="P5 - Funcionalidad"
            >
              <thead id="p5-head">
                <tr>
                  <th>Funcionalidad</th>
                  <th>Total</th>
                  <th>Datos</th>
                </tr>
              </thead>
              <tbody id="p5-body"></tbody>
            </table>
          </div>
          <div id="p5-status" class="small text-muted"></div>
        </div>
      </div>

      <!-- P5 SECCIÓN B: POBLACIÓN BAJO CONTROL POR ESTADO NUTRICIONAL -->
      <div class="card mb-4" id="p5-estado-nutricional-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
              SECCIÓN B: POBLACIÓN BAJO CONTROL POR ESTADO NUTRICIONAL
            </h5>
          </div>
          <div
            class="table-responsive table-sticky-wrap mt-3"
            style="overflow-x: auto"
          >
            <table
              class="table table-sm table-striped table-bordered align-middle table-sticky"
              id="tabla-p5-estado-nutricional"
              data-export-name="P5 - Estado nutricional"
            >
              <thead id="p5b-head">
                <tr>
                  <th>Estado Nutricional</th>
                  <th>Total</th>
                  <th>Datos</th>
                </tr>
              </thead>
              <tbody id="p5b-body"></tbody>
            </table>
          </div>
          <div id="p5b-status" class="small text-muted"></div>
        </div>
      </div>

      <!-- SECCION C: PERSONAS MAYORES CON SOSPECHA DE MALTRATO -->
      <div class="card mb-4" id="p5-maltrato-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
              SECCION C: PERSONAS MAYORES CON SOSPECHA DE MALTRATO
            </h5>
          </div>
          <div
            class="table-responsive table-sticky-wrap mt-3"
            style="overflow-x: auto"
          >
            <table
              class="table table-sm table-striped table-bordered align-middle table-sticky"
              id="tabla-p5-maltrato"
              data-export-name="P5 - Sospecha de maltrato"
            >
              <thead id="p5c-head">
                <tr>
                  <th>Maltrato</th>
                  <th>Total</th>
                  <th>Datos</th>
                </tr>
              </thead>
              <tbody id="p5c-body"></tbody>
            </table>
          </div>
          <div id="p5c-status" class="small text-muted"></div>
        </div>
      </div>

      <!-- SECCION D: PERSONAS MAYORES EN ACTIVIDAD FÍSICA -->
      <div class="card mb-4" id="p5-actividad-fisica-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
              SECCION D: PERSONAS MAYORES EN ACTIVIDAD FÍSICA
            </h5>
          </div>
          <div
            class="table-responsive table-sticky-wrap mt-3"
            style="overflow-x: auto"
          >
            <table
              class="table table-sm table-striped table-bordered align-middle table-sticky"
              id="tabla-p5-actividad-fisica"
              data-export-name="P5 - Actividad física"
            >
              <thead id="p5d-head">
                <tr>
                  <th>Actividad Física</th>
                  <th>Total</th>
                  <th>Datos</th>
                </tr>
              </thead>
              <tbody id="p5d-body"></tbody>
            </table>
          </div>
          <div id="p5d-status" class="small text-muted"></div>
        </div>
      </div>

      <!-- SECCION E: PERSONAS MAYORES CON RIESGO DE CAÍDAS -->
      <div class="card mb-4" id="p5-caidas-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
              SECCION E: PERSONAS MAYORES CON RIESGO DE CAÍDAS
            </h5>
          </div>
          <div
            class="table-responsive table-sticky-wrap mt-3"
            style="overflow-x: auto"
          >
            <table
              class="table table-sm table-striped table-bordered align-middle table-sticky"
              id="tabla-p5-caidas"
              data-export-name="P5 - Riesgo de caídas"
            >
              <thead id="p5e-head">
                <tr>
                  <th>Riesgo de Caídas</th>
                  <th>Total</th>
                  <th>Datos</th>
                </tr>
              </thead>
              <tbody id="p5e-body"></tbody>
            </table>
          </div>
          <div id="p5e-status" class="small text-muted"></div>
        </div>
      </div>

      <!-- Sección C: Variables de seguimiento del PSCV al corte -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
              SECCIÓN C: VARIABLES DE SEGUIMIENTO DEL PSCV AL CORTE
            </h5>
          </div>
          <div
            class="table-responsive table-sticky-wrap mt-3"
            style="overflow-x: auto"
          >
            <table
              class="table table-sm table-striped table-bordered align-middle table-sticky"
              id="tabla-pscv-variables"
              data-export-name="Sección C - Variables"
            >
              <thead id="pscv-variables-head">
                <tr>
                  <th>Variable</th>
                  <th>Total</th>
                  <th>Datos</th>
                </tr>
              </thead>
              <tbody id="pscv-variables-body"></tbody>
            </table>
          </div>
          <div id="pscv-variables-status" class="small text-muted"></div>
        </div>
      </div>
    </div>

    <!-- SheetJS para exportar a Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <script>
      // Bandas etarias por defecto para PSCV (fallback si el backend no entrega)
      const BANDAS_PSCV_DEFAULT = [
        '15-19','20-24','25-29','30-34','35-39','40-44','45-49',
        '50-54','55-59','60-64','65-69','70-74','75-79','80+'
      ];

      // Bandas por defecto Adulto Mayor (P5) reutilizables en todas las secciones P5
      const P5_BANDAS_DEFAULT = [
        '65 a 69 años','70 a 74 años','75 a 79 años','80 a 84 años',
        '85 a 89 años','90 a 94 años','95 a 99 años','100 y más años'
      ];

      // Configurar eventos de filtros
      document.addEventListener('DOMContentLoaded', function() {
        // Inicializar panel de parámetros REM‑P (avanzado)
        initRemParamsUI();

        // Configurar event listeners para los botones de filtro de población
        const filtrosPoblacion = document.querySelectorAll('input[name="poblacion-filter"]');
        filtrosPoblacion.forEach(radio => {
          radio.addEventListener('change', function() {
            if (this.checked) {
              // Recargar todas las estadísticas con el nuevo filtro
              cargarPscvMetas();
              cargarDiabetesEvaluacion();
              cargarHipertensionEvaluacion();
              cargarTodasPersonasPscv();
            }
          });
        });

        // Reaplicar filtros al cambiar sector
        document.getElementById('sectores_select')?.addEventListener('change', () => {
          document.getElementById('btn-aplicar-filtros')?.click();
        });
        // Conectar botón de aplicar filtros de fecha
        const btnAplicar = document.getElementById('btn-aplicar-filtros');
        if(btnAplicar){
          btnAplicar.addEventListener('click', () => {
            cargarPscvMetas();
            cargarDiabetesEvaluacion();
            cargarHipertensionEvaluacion();
            cargarTodasPersonasPscv();
            cargarP5SeccionA();
            cargarP5SeccionBEstadoNutricional();
            cargarP5SeccionCMaltrato();
            cargarP5SeccionDActividadFisica();
            cargarP5SeccionERiesgoCaidas();
            cargarSeccionAMatriz();
            cargarSeccionCVariables();
          });
        }
        const btnExtraer = document.getElementById('btn-extraer-datos');
        if (btnExtraer){
          btnExtraer.addEventListener('click', () => {
            // Ejecuta la misma recarga completa de tablas
            cargarPscvMetas();
            cargarDiabetesEvaluacion();
            cargarHipertensionEvaluacion();
            cargarTodasPersonasPscv();
            cargarP5SeccionA();
            cargarP5SeccionBEstadoNutricional();
            cargarP5SeccionCMaltrato();
            cargarP5SeccionDActividadFisica();
            cargarP5SeccionERiesgoCaidas();
            cargarSeccionAMatriz();
            cargarSeccionCVariables();
          });
        }
        const btnLimpiar = document.getElementById('btn-limpiar');
        if (btnLimpiar){
          btnLimpiar.addEventListener('click', () => {
            const f1 = document.getElementById('fecha_desde');
            const f2 = document.getElementById('fecha_hasta');
            if (f1) f1.value = '';
            if (f2) f2.value = '';
            // Recarga con filtros vacíos
            cargarPscvMetas();
            cargarDiabetesEvaluacion();
            cargarHipertensionEvaluacion();
            cargarTodasPersonasPscv();
            cargarP5SeccionA();
            cargarP5SeccionBEstadoNutricional();
            cargarP5SeccionCMaltrato();
            cargarP5SeccionDActividadFisica();
            cargarP5SeccionERiesgoCaidas();
            cargarSeccionAMatriz();
            cargarSeccionCVariables();
          });
        }
        const btnExcel = document.getElementById('btn-exportar-excel');
        if (btnExcel){
          btnExcel.addEventListener('click', async () => {
            try{
              const wb = XLSX.utils.book_new();
              // Agregar hoja de metadatos con filtros aplicados y parámetros REM‑P
              addHojaFiltrosAplicados(wb);
              // Exportar TODAS las tablas presentes en la página, cada una como hoja separada
              exportarTodasLasTablasAExcel(wb);
              const hoy = new Date();
              const y = hoy.getFullYear(); const m = String(hoy.getMonth()+1).padStart(2,'0'); const d = String(hoy.getDate()).padStart(2,'0');
              const nombre = `estadisticas_pscv_${y}-${m}-${d}.xlsx`;
              XLSX.writeFile(wb, nombre);
            }catch(e){
              console.error('Exportación Excel falló', e);
              alert('No se pudo exportar a Excel');
            }
          });
        }
        // Cargar SECCIÓN B (Metas)
        // Cargar NUEVA SECCIÓN: EVALUACIÓN DE DIABETES
        cargarDiabetesEvaluacion();
        // Cargar NUEVA SECCIÓN: EVALUACIÓN DE HIPERTENSIÓN
        cargarHipertensionEvaluacion();
        // Cargar NUEVA SECCIÓN: TODAS LAS PERSONAS EN PSCV
        cargarTodasPersonasPscv();
        // P5 SECCIÓN A (Funcionalidad) - tabla estática inicial (valores 0)
        cargarP5SeccionA();
        // P5 SECCIÓN B (Estado Nutricional) - tabla estática inicial (valores 0)
        cargarP5SeccionBEstadoNutricional();
        // Sección C (Sospecha de maltrato) - tabla estática inicial (valores 0)
        cargarP5SeccionCMaltrato();
        // Sección D (Actividad física) - tabla estática inicial (valores 0)
        cargarP5SeccionDActividadFisica();
        // Sección E (Riesgo de caídas) - tabla estática inicial (valores 0)
        cargarP5SeccionERiesgoCaidas();
        cargarPscvMetas();

        // Agregar delay para asegurar que todos los elementos están cargados
        console.log('Configurando timeout para Sección A en 2 segundos...');
        setTimeout(() => {
          console.log('⏰ TIMEOUT EJECUTADO - Iniciando carga de Sección A después de delay...');
          // Cargar Sección A (matriz por bandas etarias)
          cargarSeccionAMatriz();
        }, 2000);

        // Cargar Sección C (variables)
        cargarSeccionCVariables();
      });


      function num(v){ return (v==null||isNaN(v))? 0 : Number(v); }

      // Función de prueba simple para debuggear
      async function testSeccionA(){
        console.log('=== PRUEBA SECCIÓN A ===');

        // Verificar elementos
        const tbody = document.getElementById('seccion-a-pscv-body');
        const thead = document.getElementById('seccion-a-pscv-head');
        console.log('tbody encontrado:', !!tbody);
        console.log('thead encontrado:', !!thead);

        // Probar endpoint
        try {
          const response = await fetch('/api/estadisticas/pscv_programa_rem_anual', {
            credentials: 'same-origin'
          });
          console.log('Respuesta endpoint:', response.status);

          if (response.ok) {
            const data = await response.json();
            console.log('Datos recibidos:', data);
            return data;
          }
        } catch (error) {
          console.error('Error al probar endpoint:', error);
        }
      }

      // Función super simplificada para probar la actualización
      async function actualizarSeccionASimple(){
        console.log('🔧 FUNCIÓN SIMPLE - Iniciando...');

        try {
          // Obtener datos
          const response = await fetch('/api/estadisticas/pscv_programa_rem_anual', {
            credentials: 'same-origin'
          });

          if (!response.ok) {
            console.error('❌ Response no OK:', response.status);
            return;
          }

          const data = await response.json();
          console.log('📊 Datos obtenidos:', data);

          if (!data.success || !data.filas) {
            console.error('❌ Datos inválidos');
            return;
          }

          // Buscar datos de PSCV
          const pscvData = data.filas.find(f => f.concepto === 'Número de personas en PSCV');
          if (!pscvData) {
            console.error('❌ No se encontraron datos de PSCV');
            return;
          }

          console.log('🎯 Datos PSCV:', pscvData);

          // Actualizar solo el total principal
          const pscvTotalEl = document.getElementById('pscv-total');
          if (pscvTotalEl) {
            const valorAnterior = pscvTotalEl.textContent;
            pscvTotalEl.textContent = pscvData.total_ambos || '0';
            console.log(`✅ PSCV total actualizado: ${valorAnterior} → ${pscvData.total_ambos}`);
          } else {
            console.error('❌ Elemento pscv-total no encontrado');
          }

          // Actualizar totales por sexo
          const pscvTotalH = document.getElementById('pscv-total-h');
          const pscvTotalM = document.getElementById('pscv-total-m');

          if (pscvTotalH) {
            pscvTotalH.textContent = pscvData.total_hombres || '0';
            console.log('✅ PSCV hombres actualizado:', pscvData.total_hombres);
          }

          if (pscvTotalM) {
            pscvTotalM.textContent = pscvData.total_mujeres || '0';
            console.log('✅ PSCV mujeres actualizado:', pscvData.total_mujeres);
          }

          console.log('🎉 Función simple completada');

        } catch (error) {
          console.error('❌ Error en función simple:', error);
        }
      }

      // Normaliza etiquetas para comparaciones tolerantes (ignora acentos, mayúsculas y signos)
      function keyizeLabel(s){
        try{
          return String(s||'')
            .toLowerCase()
            .normalize('NFD')
            .replace(/[\u0300-\u036f]/g, '') // quitar acentos
            .replace(/[^a-z0-9]+/g, '')        // dejar solo a-z0-9
            .trim();
        }catch(_){ return String(s||''); }
      }


      // ===================== SECCIÓN B: METAS REM-P CON CELDAS BLOQUEADAS =====================
      async function cargarPscvMetas(paramsFromChart){
        console.log('🎯 NUEVA TABLA REM-P - Iniciando carga...');

        const status = document.getElementById('metas-status');
        const tbody = document.getElementById('remp-metas-body');

        try {
          status.textContent = 'Cargando datos REM-P completos...';
          const url = '/remp_seccion_b_completa';
          console.log('📡 Cargando desde:', url);

          const response = await fetch(url, {
            credentials: 'same-origin'
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();
          console.log('✅ Datos REM-P completos recibidos:', data);

          if (!data.success) {
            throw new Error(data.error || 'Error desconocido');
          }

          const secciones = data.secciones || {};

          // ============ ACTUALIZAR BADGES DE TOTALES ============
          const badgePA140 = document.getElementById('total-pa-140');
          const badgePA150 = document.getElementById('total-pa-150');
          const badgeHbA1c7 = document.getElementById('total-hba1c-7');
          const badgeHbA1c8 = document.getElementById('total-hba1c-8');

          const hipertension = secciones.hipertension || {};
          const diabetes = secciones.diabetes || {};

          if (badgePA140) badgePA140.textContent = hipertension.pa_140_90?.totales?.total || 0;
          if (badgePA150) badgePA150.textContent = hipertension.pa_150_90?.totales?.total || 0;
          if (badgeHbA1c7) badgeHbA1c7.textContent = diabetes.hba1c_7?.totales?.total || 0;
          if (badgeHbA1c8) badgeHbA1c8.textContent = diabetes.hba1c_8?.totales?.total || 0;

          // ============ LLENAR TABLA REM-P COMPLETA ============
          console.log('🔄 Llenando tabla REM-P con datos completos...');

          // 1. HIPERTENSIÓN - PA < 140/90 mmHg
          const pa140Data = hipertension.pa_140_90 || {};
          const pa140Totales = pa140Data.totales || {};
          const pa140Bandas = pa140Data.bandas || {};

          document.getElementById('pa140-total').textContent = pa140Totales.total || 0;
          document.getElementById('pa140-h').textContent = pa140Totales.hombres || 0;
          document.getElementById('pa140-m').textContent = pa140Totales.mujeres || 0;

          // Mapear TODAS las bandas etarias incluyendo las nuevas (65-69, 70-74, 75-79, 80+)
          const todasLasBandas = ['15-19', '20-24', '25-29', '30-34', '35-39', '40-44', '45-49', '50-54', '55-59', '60-64', '65-69', '70-74', '75-79', '80+'];

          todasLasBandas.forEach(banda => {
            const datosBanda = pa140Bandas[banda] || {};
            const bandaNorm = banda.replace('+', '-mas'); // Convertir '80+' a '80-mas'

            const elementoH = document.getElementById(`pa140-${bandaNorm}-h`);
            const elementoM = document.getElementById(`pa140-${bandaNorm}-m`);

            if (elementoH) elementoH.textContent = datosBanda.hombres || 0;
            if (elementoM) elementoM.textContent = datosBanda.mujeres || 0;
          });

          console.log(`✅ PA<140/90 cargado: ${pa140Totales.total || 0} personas total`);

          // 2. HIPERTENSIÓN - PA < 150/90 mmHg (solo para ≥80 años)
          const pa150Data = hipertension.pa_150_90 || {};
          const pa150Totales = pa150Data.totales || {};

          document.getElementById('pa150-total').textContent = pa150Totales.total || 0;
          document.getElementById('pa150-h').textContent = pa150Totales.hombres || 0;
          document.getElementById('pa150-m').textContent = pa150Totales.mujeres || 0;

          // Solo llenar columna 80+ para PA 150/90
          const el150H80 = document.getElementById('pa150-80-mas-h');
          const el150M80 = document.getElementById('pa150-80-mas-m');
          if (el150H80) el150H80.textContent = pa150Totales.hombres || 0;
          if (el150M80) el150M80.textContent = pa150Totales.mujeres || 0;

          console.log(`✅ PA<150/90 cargado: ${pa150Totales.total || 0} personas total (≥80 años)`);

          // 3. DIABETES - HbA1c < 7% (< 80 años)
          const hba1c7Data = diabetes.hba1c_7 || {};
          const hba1c7Totales = hba1c7Data.totales || {};
          const hba1c7Bandas = hba1c7Data.bandas || {};

          document.getElementById('hba1c7-total').textContent = hba1c7Totales.total || 0;
          document.getElementById('hba1c7-h').textContent = hba1c7Totales.hombres || 0;
          document.getElementById('hba1c7-m').textContent = hba1c7Totales.mujeres || 0;

          // Llenar bandas para HbA1c < 7% (excluir 80+)
          todasLasBandas.filter(b => b !== '80+').forEach(banda => {
            const datosBanda = hba1c7Bandas[banda] || {};
            const bandaNorm = banda.replace('+', '-mas');

            const elementoH = document.getElementById(`hba1c7-${bandaNorm}-h`);
            const elementoM = document.getElementById(`hba1c7-${bandaNorm}-m`);

            if (elementoH) elementoH.textContent = datosBanda.hombres || 0;
            if (elementoM) elementoM.textContent = datosBanda.mujeres || 0;
          });

          console.log(`✅ HbA1c<7% cargado: ${hba1c7Totales.total || 0} personas total (<80 años)`);

          // 4. DIABETES - HbA1c < 8% (≥ 80 años)
          const hba1c8Data = diabetes.hba1c_8 || {};
          const hba1c8Totales = hba1c8Data.totales || {};

          document.getElementById('hba1c8-total').textContent = hba1c8Totales.total || 0;
          document.getElementById('hba1c8-h').textContent = hba1c8Totales.hombres || 0;
          document.getElementById('hba1c8-m').textContent = hba1c8Totales.mujeres || 0;

          console.log(`✅ HbA1c<8% cargado: ${hba1c8Totales.total || 0} personas total (≥80 años)`);

          // 5. RCV ALTO - LDL < 70 mg/dL
          const rcvAlto = secciones.rcv_alto || {};
          const ldl70Data = rcvAlto.ldl_70 || {};
          const ldl70Totales = ldl70Data.totales || {};
          const ldl70Bandas = ldl70Data.bandas || {};

          document.getElementById('ldl70-total').textContent = ldl70Totales.total || 0;
          document.getElementById('ldl70-h').textContent = ldl70Totales.hombres || 0;
          document.getElementById('ldl70-m').textContent = ldl70Totales.mujeres || 0;

          // Llenar bandas LDL < 70 (desde 25 años según normativa)
          todasLasBandas.forEach(banda => {
            const datosBanda = ldl70Bandas[banda] || {};
            const bandaNorm = banda.replace('+', '-mas');

            const elementoH = document.getElementById(`ldl70-${bandaNorm}-h`);
            const elementoM = document.getElementById(`ldl70-${bandaNorm}-m`);

            if (elementoH) elementoH.textContent = datosBanda.hombres || 0;
            if (elementoM) elementoM.textContent = datosBanda.mujeres || 0;
          });

          console.log(`✅ LDL<70 cargado: ${ldl70Totales.total || 0} personas total`);

          // 6. ANTECEDENTES CARDIOVASCULARES (ECV, IAM, ACV)
          const tiposAntecedentes = [
            { key: 'ecv', name: 'ECV' },
            { key: 'iam', name: 'IAM' },
            { key: 'acv', name: 'ACV' }
          ];
          const tiposTratamiento = ['antiag', 'estatina', 'fumador'];

          tiposAntecedentes.forEach(tipo => {
            const antecedentesData = secciones[tipo.key] || {};

            tiposTratamiento.forEach(tratamiento => {
              const tratamientoData = antecedentesData[tratamiento] || {};
              const totales = tratamientoData.totales || {};
              const bandas = tratamientoData.bandas || {};

              // Totales
              const elTotal = document.getElementById(`${tipo.key}-${tratamiento}-total`);
              const elH = document.getElementById(`${tipo.key}-${tratamiento}-h`);
              const elM = document.getElementById(`${tipo.key}-${tratamiento}-m`);

              if (elTotal) elTotal.textContent = totales.total || 0;
              if (elH) elH.textContent = totales.hombres || 0;
              if (elM) elM.textContent = totales.mujeres || 0;

              // Bandas etarias para antecedentes
              todasLasBandas.forEach(banda => {
                const datosBanda = bandas[banda] || {};
                const bandaNorm = banda.replace('+', '-mas');

                const elementoH = document.getElementById(`${tipo.key}-${tratamiento}-${bandaNorm}-h`);
                const elementoM = document.getElementById(`${tipo.key}-${tratamiento}-${bandaNorm}-m`);

                if (elementoH) elementoH.textContent = datosBanda.hombres || 0;
                if (elementoM) elementoM.textContent = datosBanda.mujeres || 0;
              });
            });

            console.log(`✅ ${tipo.name} cargado: antiagregantes, estatina, fumador`);
          });

          // ============ RESUMEN FINAL ============
          const totalPacientes = (hipertension.pa_140_90?.totales?.total || 0) +
                                (diabetes.hba1c_7?.totales?.total || 0) +
                                (rcvAlto.ldl_70?.totales?.total || 0);

          status.innerHTML = `<i class="bi bi-check-circle text-success"></i>
                              <strong>Tabla REM-P COMPLETA cargada</strong><br>
                              • PA&lt;140/90: ${hipertension.pa_140_90?.totales?.total || 0} personas<br>
                              • HbA1c&lt;7%: ${diabetes.hba1c_7?.totales?.total || 0} personas<br>
                              • LDL&lt;70: ${rcvAlto.ldl_70?.totales?.total || 0} personas<br>
                              • Período: ${data.periodo?.descripcion || 'N/D'}<br>
                              <small>Incluye todas las bandas etarias: 15-19 hasta 80+ años</small>`;

          console.log('🎉 ¡TABLA REM-P COMPLETA cargada exitosamente!');
          console.log(`📊 Total estimado de intervenciones: ${totalPacientes}`);

        } catch (error) {
          console.error('❌ Error cargando tabla REM-P:', error);
          status.innerHTML = `<i class="bi bi-x-circle text-danger"></i> Error: ${error.message}`;
        }
      }


      // ===================== NUEVA SECCIÓN: EVALUACIÓN DE DIABETES EN PSCV (MANUAL REM-P 2025) =====================
      async function cargarDiabetesEvaluacion() {
        const status = document.getElementById('diabetes-evaluacion-status');
        const tbody = document.getElementById('diabetes-evaluacion-body');

        console.log('🚀 Iniciando cargarDiabetesEvaluacion...');

        try {
          // Parámetros de filtro desde la página
          const params = new URLSearchParams();
          const sectores = document.getElementById('sectores')?.value || '';
          const sexo = document.getElementById('sexo')?.value || '';
          const fechaDesde = document.getElementById('fecha_desde')?.value || '';
          const fechaHasta = document.getElementById('fecha_hasta')?.value || '';

          // Obtener filtro de población seleccionado
          const poblacionFilter = document.querySelector('input[name="poblacion-filter"]:checked')?.value || 'ecicep';

          if (sectores) params.append('sectores', sectores);
          if (sexo) params.append('sexo', sexo);
          if (fechaDesde) params.append('fecha_desde', fechaDesde);
          if (fechaHasta) params.append('fecha_hasta', fechaHasta);
          params.append('poblacion', poblacionFilter);

          console.log('📡 Haciendo fetch a:', '/api/estadisticas/diabetes_pscv?' + params.toString());

          const response = await fetch('/api/estadisticas/diabetes_pscv?' + params.toString(), {
            credentials: 'same-origin'
          });
          console.log('Response status:', response.status);
          console.log('Response ok:', response.ok);
          console.log('Response URL:', response.url);

          // Verificar si es una redirección (no autenticado)
          if (response.status === 302 || response.url.includes('/login')) {
            console.warn('⚠️ Usuario no autenticado - redirigiendo a login');
            window.location.href = '/login';
            return;
          }

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();
          console.log('📊 Datos recibidos:', data);

          // Actualizar elementos del dashboard
          const totalElement = document.getElementById('diabetes-total');
          console.log('🎯 Elemento diabetes-total:', totalElement);

          if (totalElement) {
            totalElement.textContent = data.total_diabetes_pscv || 0;
            console.log('✅ Actualizado diabetes-total a:', data.total_diabetes_pscv);
          } else {
            console.error('❌ No se encontró elemento diabetes-total');
          }

          const metricas = data.metricas || {};
          const control = metricas.control_metabolico || {};
          const complicaciones = metricas.complicaciones || {};
          const evaluacion = metricas.evaluacion_basica || {};
          const tratamiento = metricas.tratamiento_insulina || {};

          document.getElementById('diabetes-meta-hba1c').textContent = control.logra_meta_hba1c_edad || 0;
          document.getElementById('diabetes-hba1c-alto').textContent = tratamiento.con_hba1c_mayor_9 || 0;
          document.getElementById('diabetes-podologia').textContent = evaluacion.con_atencion_podologica_vigente || 0;
          document.getElementById('diabetes-hipoglicemias').textContent = complicaciones.con_hipoglicemias_recurrentes || 0;

          // Definir las métricas para la tabla con descripciones
          const metricas_tabla = [
            {
              categoria: 'CONTROL METABÓLICO',
              items: [
                {
                  nombre: 'Con HbA1c vigente (último año)',
                  valor: control.con_hba1c_vigente || 0,
                  descripcion: 'Pacientes con examen HbA1c realizado en últimos 12 meses'
                },
                {
                  nombre: 'Logra meta HbA1c según edad',
                  valor: control.logra_meta_hba1c_edad || 0,
                  descripcion: '<80 años: HbA1c <7% | ≥80 años: HbA1c <8%'
                },
                {
                  nombre: 'Con HbA1c ≥ 9%',
                  valor: tratamiento.con_hba1c_mayor_9 || 0,
                  descripcion: 'Pacientes con control metabólico deficiente (alto riesgo)'
                }
              ]
            },
            {
              categoria: 'EVALUACIÓN BÁSICA',
              items: [
                {
                  nombre: 'Con atención podológica vigente',
                  valor: evaluacion.con_atencion_podologica_vigente || 0,
                  descripcion: 'Evaluación y cuidado podológico según pauta de estimación de riesgo'
                }
              ]
            },
            {
              categoria: 'PIE DIABÉTICO',
              items: [
                {
                  nombre: 'Riesgo bajo',
                  valor: (metricas.pie_diabetico || {}).riesgo_bajo || 0,
                  descripcion: 'Sin pérdida de sensibilidad ni deformidades'
                },
                {
                  nombre: 'Riesgo moderado',
                  valor: (metricas.pie_diabetico || {}).riesgo_moderado || 0,
                  descripcion: 'Pérdida de sensibilidad o deformidades'
                },
                {
                  nombre: 'Riesgo alto',
                  valor: (metricas.pie_diabetico || {}).riesgo_alto || 0,
                  descripcion: 'Pérdida de sensibilidad + deformidades'
                },
                {
                  nombre: 'Riesgo máximo',
                  valor: (metricas.pie_diabetico || {}).riesgo_maximo || 0,
                  descripción: 'Antecedente de úlcera o amputación'
                },
                {
                  nombre: 'Con úlcera o amputación',
                  valor: (metricas.pie_diabetico || {}).con_ulcera_o_amputacion || 0,
                  descripcion: 'Complicación severa que requiere tratamiento especializado'
                }
              ]
            },
            {
              categoria: 'COMPLICACIONES',
              items: [
                {
                  nombre: 'Con hipoglicemias recurrentes',
                  valor: complicaciones.con_hipoglicemias_recurrentes || 0,
                  descripcion: 'Episodios repetidos de hipoglicemia (ajuste terapéutico necesario)'
                },
                {
                  nombre: 'Fumador actual',
                  valor: complicaciones.fumador_actual || 0,
                  descripcion: 'Factor de riesgo cardiovascular modificable'
                }
              ]
            },
            {
              categoria: 'MEDICACIÓN',
              items: [
                {
                  nombre: 'ERC con IECA o ARA II',
                  valor: (metricas.medicacion || {}).erc_con_ieca_ara || 0,
                  descripcion: 'Enfermedad renal crónica en tratamiento con nefroprotección'
                }
              ]
            },
            {
              categoria: 'DIAGNÓSTICOS ASOCIADOS',
              items: [
                {
                  nombre: 'Con diagnóstico de hipertensión arterial',
                  valor: (metricas.diagnosticos_asociados || {}).con_diagnostico_hta || 0,
                  descripcion: 'Comorbilidad cardiovascular frecuente en diabetes'
                },
                {
                  nombre: 'Con diagnóstico de enfermedad renal crónica',
                  valor: (metricas.diagnosticos_asociados || {}).con_diagnostico_erc || 0,
                  descripcion: 'Complicación crónica de la diabetes'
                },
                {
                  nombre: 'Antecedente de ataque cerebrovascular',
                  valor: (metricas.diagnosticos_asociados || {}).antecedente_acv || 0,
                  descripcion: 'Complicación macrovascular mayor'
                },
                {
                  nombre: 'Antecedente de infarto agudo al miocardio',
                  valor: (metricas.diagnosticos_asociados || {}).antecedente_iam || 0,
                  descripcion: 'Complicación macrovascular mayor'
                },
                {
                  nombre: 'Retinopatía diabética',
                  valor: (metricas.diagnosticos_asociados || {}).retinopatia_diabetica || 0,
                  descripcion: 'Complicación microvascular que afecta la retina'
                }
              ]
            }
          ];

          // Limpiar tabla y generar filas
          tbody.innerHTML = '';

          for (const categoria of metricas_tabla) {
            // Fila de encabezado de categoría
            const headerRow = document.createElement('tr');
            headerRow.className = 'table-section-header';
            headerRow.innerHTML = `
              <td colspan="4"><strong>${categoria.categoria}</strong></td>
            `;
            tbody.appendChild(headerRow);

            // Filas de métricas
            for (const item of categoria.items) {
              const porcentaje = data.total_diabetes_pscv > 0 ?
                ((item.valor / data.total_diabetes_pscv) * 100).toFixed(1) : '0.0';

              const row = document.createElement('tr');
              row.innerHTML = `
                <td style="padding-left: 1.5rem;">${item.nombre}</td>
                <td class="text-center"><strong>${item.valor}</strong></td>
                <td class="text-center">${porcentaje}%</td>
                <td><small class="text-muted">${item.descripcion}</small></td>
              `;
              tbody.appendChild(row);
            }
          }

          status.textContent = `Estadísticas actualizadas - Total diabetes: ${data.total_diabetes_pscv}`;

        } catch (error) {
          console.error('Error cargando estadísticas de diabetes:', error);
          tbody.innerHTML = '<tr><td colspan="4" class="text-center text-danger">Error al cargar estadísticas de diabetes</td></tr>';
          status.textContent = 'Error al cargar datos de diabetes';

          // Limpiar contadores del dashboard
          document.getElementById('diabetes-total').textContent = '0';
          document.getElementById('diabetes-meta-hba1c').textContent = '0';
          document.getElementById('diabetes-hba1c-alto').textContent = '0';
          document.getElementById('diabetes-podologia').textContent = '0';
          document.getElementById('diabetes-hipoglicemias').textContent = '0';
        }
      }

      // ===================== NUEVA SECCIÓN: EVALUACIÓN DE HIPERTENSIÓN EN PSCV (MANUAL REM-P 2025) =====================
      async function cargarHipertensionEvaluacion() {
        console.log('=== DEBUG: cargarHipertensionEvaluacion iniciada ===');
        const status = document.getElementById('hipertension-evaluacion-status');
        const tbody = document.getElementById('hipertension-evaluacion-body');

        console.log('Status element found:', status);
        console.log('Tbody element found:', tbody);

        try {
          // Parámetros de filtro desde la página
          const params = new URLSearchParams();
          const sectores = document.getElementById('sectores')?.value || '';
          const sexo = document.getElementById('sexo')?.value || '';
          const fechaDesde = document.getElementById('fecha_desde')?.value || '';
          const fechaHasta = document.getElementById('fecha_hasta')?.value || '';

          // Obtener filtro de población seleccionado
          const poblacionFilter = document.querySelector('input[name="poblacion-filter"]:checked')?.value || 'ecicep';

          console.log('Parámetros de filtro:', { sectores, sexo, fechaDesde, fechaHasta, poblacionFilter });

          if (sectores) params.append('sectores', sectores);
          if (sexo) params.append('sexo', sexo);
          if (fechaDesde) params.append('fecha_desde', fechaDesde);
          if (fechaHasta) params.append('fecha_hasta', fechaHasta);
          params.append('poblacion', poblacionFilter);

          console.log('URL completa:', '/api/estadisticas/hipertension_pscv?' + params.toString());

          const response = await fetch('/api/estadisticas/hipertension_pscv?' + params.toString(), {
            credentials: 'same-origin'
          });
          console.log('Response status:', response.status);
          console.log('Response ok:', response.ok);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();
          console.log('Data received from API:', data);

          // Verificar elementos específicos que vamos a actualizar
          const hipertensionTotalElement = document.getElementById('hipertension-total');
          const hipertensionPaAltaElement = document.getElementById('hipertension-pa-alta');
          const hipertensionHeartsElement = document.getElementById('hipertension-hearts');

          console.log('Elementos dashboard hipertensión:');
          console.log('- hipertension-total:', hipertensionTotalElement);
          console.log('- hipertension-pa-alta:', hipertensionPaAltaElement);
          console.log('- hipertension-hearts:', hipertensionHeartsElement);

          // Actualizar elementos del dashboard
          if (hipertensionTotalElement) {
            hipertensionTotalElement.textContent = data.total_hipertension_pscv || 0;
            console.log('Actualizado hipertension-total a:', data.total_hipertension_pscv);
          }

          const metricas = data.metricas || {};
          const laboratorio = metricas.evaluacion_laboratorio || {};
          const presion = metricas.control_presion || {};
          const diagnosticos = metricas.diagnosticos_asociados || {};
          const hearts = metricas.protocolo_hearts || {};

          console.log('Metricas desglosadas:', { laboratorio, presion, diagnosticos, hearts });

          if (hipertensionPaAltaElement) {
            hipertensionPaAltaElement.textContent = presion.pa_mayor_160_100 || 0;
            console.log('Actualizado hipertension-pa-alta a:', presion.pa_mayor_160_100);
          }

          if (hipertensionHeartsElement) {
            hipertensionHeartsElement.textContent = hearts.en_protocolo_hearts || 0;
            console.log('Actualizado hipertension-hearts a:', hearts.en_protocolo_hearts);
          }
          document.getElementById('hipertension-rac').textContent = laboratorio.con_rac_vigente || 0;
          document.getElementById('hipertension-vfg').textContent = laboratorio.con_vfg_vigente || 0;

          // Definir las métricas para la tabla con descripciones
          const metricas_tabla = [
            {
              categoria: 'EVALUACIÓN DE LABORATORIO',
              items: [
                {
                  nombre: 'Con razón albúmina creatinina (RAC), vigente',
                  valor: laboratorio.con_rac_vigente || 0,
                  descripcion: 'Examen para detectar proteinuria y evaluar función renal'
                },
                {
                  nombre: 'Con velocidad de filtración glomerular estimada (VFGE) vigente',
                  valor: laboratorio.con_vfg_vigente || 0,
                  descripcion: 'Evaluación de la función renal mediante VFG estimada'
                },
                {
                  nombre: 'Con VFGE y RAC vigente',
                  valor: laboratorio.con_vfg_y_rac_vigente || 0,
                  descripcion: 'Evaluación completa de función renal (VFG + RAC)'
                }
              ]
            },
            {
              categoria: 'CONTROL DE PRESIÓN ARTERIAL',
              items: [
                {
                  nombre: 'Con presión arterial igual o mayor 160/100 MMHG',
                  valor: presion.pa_mayor_160_100 || 0,
                  descripcion: 'Hipertensión estadio 2 que requiere ajuste terapéutico inmediato'
                }
              ]
            },
            {
              categoria: 'DIAGNÓSTICOS ASOCIADOS',
              items: [
                {
                  nombre: 'Con diagnóstico de enfermedad renal crónica',
                  valor: diagnosticos.con_diagnostico_erc || 0,
                  descripcion: 'Complicación crónica de la hipertensión no controlada'
                }
              ]
            },
            {
              categoria: 'PROTOCOLO HEARTS',
              items: [
                {
                  nombre: 'En protocolo Hearts',
                  valor: hearts.en_protocolo_hearts || 0,
                  descripcion: 'Protocolo HEARTS para manejo integral de enfermedades cardiovasculares'
                }
              ]
            }
          ];

          // Limpiar tabla y generar filas
          tbody.innerHTML = '';

          for (const categoria of metricas_tabla) {
            // Fila de encabezado de categoría
            const headerRow = document.createElement('tr');
            headerRow.className = 'table-section-header';
            headerRow.innerHTML = `
              <td colspan="4"><strong>${categoria.categoria}</strong></td>
            `;
            tbody.appendChild(headerRow);

            // Filas de métricas
            for (const item of categoria.items) {
              const porcentaje = data.total_hipertension_pscv > 0 ?
                ((item.valor / data.total_hipertension_pscv) * 100).toFixed(1) : '0.0';

              const row = document.createElement('tr');
              row.innerHTML = `
                <td style="padding-left: 1.5rem;">${item.nombre}</td>
                <td class="text-center"><strong>${item.valor}</strong></td>
                <td class="text-center">${porcentaje}%</td>
                <td><small class="text-muted">${item.descripcion}</small></td>
              `;
              tbody.appendChild(row);
            }
          }

          status.textContent = `Estadísticas actualizadas - Total hipertensión: ${data.total_hipertension_pscv}`;
          if (data.nota) {
            status.textContent += ` - ${data.nota}`;
          }

        } catch (error) {
          console.error('Error cargando estadísticas de hipertensión:', error);
          tbody.innerHTML = '<tr><td colspan="4" class="text-center text-danger">Error al cargar estadísticas de hipertensión</td></tr>';
          status.textContent = 'Error al cargar datos de hipertensión';

          // Limpiar contadores del dashboard
          document.getElementById('hipertension-total').textContent = '0';
          document.getElementById('hipertension-pa-alta').textContent = '0';
          document.getElementById('hipertension-hearts').textContent = '0';
          document.getElementById('hipertension-rac').textContent = '0';
          document.getElementById('hipertension-vfg').textContent = '0';
        }
      }

      // ===================== NUEVA SECCIÓN: TODAS LAS PERSONAS EN PSCV (MANUAL REM-P 2025) =====================
      async function cargarTodasPersonasPscv() {
        const status = document.getElementById('todas-personas-pscv-status');
        const tbody = document.getElementById('todas-personas-pscv-body');

        try {
          // Parámetros de filtro desde la página
          const params = new URLSearchParams();
          const sectores = document.getElementById('sectores')?.value || '';
          const sexo = document.getElementById('sexo')?.value || '';
          const fechaDesde = document.getElementById('fecha_desde')?.value || '';
          const fechaHasta = document.getElementById('fecha_hasta')?.value || '';

          // Obtener filtro de población seleccionado
          const poblacionFilter = document.querySelector('input[name="poblacion-filter"]:checked')?.value || 'ecicep';

          if (sectores) params.append('sectores', sectores);
          if (sexo) params.append('sexo', sexo);
          if (fechaDesde) params.append('fecha_desde', fechaDesde);
          if (fechaHasta) params.append('fecha_hasta', fechaHasta);
          params.append('poblacion', poblacionFilter);

          const response = await fetch('/api/estadisticas/todas_personas_pscv?' + params.toString(), {
            credentials: 'same-origin'
          });
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();

          // Actualizar elementos del dashboard
          document.getElementById('todas-pscv-total').textContent = data.total_personas_pscv || 0;

          const metricas = data.metricas || {};
          const sobrepeso = metricas.sobrepeso_obesidad || {};
          const estilo = metricas.estilo_vida || {};
          const erc = metricas.enfermedad_renal_cronica || {};

          // Calcular totales para dashboard
          const totalSobrepesoObesidad = (sobrepeso.sobrepeso_menor_65 || 0) +
                                         (sobrepeso.sobrepeso_mayor_65 || 0) +
                                         (sobrepeso.obesidad_menor_65 || 0) +
                                         (sobrepeso.obesidad_mayor_65 || 0);

          document.getElementById('todas-pscv-sobrepeso-obesidad').textContent = totalSobrepesoObesidad;
          document.getElementById('todas-pscv-actividad').textContent = estilo.en_actividad_fisica || 0;
          document.getElementById('todas-pscv-fumador').textContent = estilo.fumador_actual || 0;
          document.getElementById('todas-pscv-erc').textContent = erc.total_erc || 0;

          // Definir las métricas para la tabla con descripciones
          const metricas_tabla = [
            {
              categoria: 'SOBREPESO Y OBESIDAD POR GRUPOS ETARIOS',
              items: [
                {
                  nombre: 'Sobrepeso: IMC entre 25 y 29.9 <65 años',
                  valor: sobrepeso.sobrepeso_menor_65 || 0,
                  descripcion: 'Personas menores de 65 años con IMC entre 25.0-29.9 kg/m²'
                },
                {
                  nombre: 'Sobrepeso: IMC entre 28 y 31.9 ≥65 años',
                  valor: sobrepeso.sobrepeso_mayor_65 || 0,
                  descripcion: 'Personas de 65 años o más con IMC entre 28.0-31.9 kg/m²'
                },
                {
                  nombre: 'Obesidad: IMC igual o Mayor a 30KG/M² <65 años',
                  valor: sobrepeso.obesidad_menor_65 || 0,
                  descripcion: 'Personas menores de 65 años con IMC ≥30.0 kg/m²'
                },
                {
                  nombre: 'Obesidad: IMC igual o Mayor a 32KG/M² ≥65 años',
                  valor: sobrepeso.obesidad_mayor_65 || 0,
                  descripcion: 'Personas de 65 años o más con IMC ≥32.0 kg/m²'
                }
              ]
            },
            {
              categoria: 'ESTILO DE VIDA',
              items: [
                {
                  nombre: 'Personas en actividad física salud cardiovascular',
                  valor: estilo.en_actividad_fisica || 0,
                  descripcion: 'Participantes activos en programa de actividad física cardiovascular'
                },
                {
                  nombre: 'Fumador actual',
                  valor: estilo.fumador_actual || 0,
                  descripcion: 'Personas que mantienen hábito tabáquico activo'
                }
              ]
            },
            {
              categoria: 'ENFERMEDAD RENAL CRÓNICA (ERC)',
              items: [
                {
                  nombre: 'Sin enfermedad renal (S/ERC)',
                  valor: erc.sin_erc || 0,
                  descripcion: 'Personas sin diagnóstico de enfermedad renal crónica'
                },
                {
                  nombre: 'Etapa G1',
                  valor: erc.erc_g1 || 0,
                  descripcion: 'ERC G1: VFG ≥90 ml/min/1.73m² con daño renal'
                },
                {
                  nombre: 'Etapa G2',
                  valor: erc.erc_g2 || 0,
                  descripcion: 'ERC G2: VFG 60-89 ml/min/1.73m² con daño renal'
                },
                {
                  nombre: 'Etapa G3a',
                  valor: erc.erc_g3a || 0,
                  descripcion: 'ERC G3a: VFG 45-59 ml/min/1.73m² (disminución leve-moderada)'
                },
                {
                  nombre: 'Etapa G3b',
                  valor: erc.erc_g3b || 0,
                  descripcion: 'ERC G3b: VFG 30-44 ml/min/1.73m² (disminución moderada-severa)'
                },
                {
                  nombre: 'Etapa G4',
                  valor: erc.erc_g4 || 0,
                  descripcion: 'ERC G4: VFG 15-29 ml/min/1.73m² (disminución severa)'
                },
                {
                  nombre: 'Etapa G5',
                  valor: erc.erc_g5 || 0,
                  descripcion: 'ERC G5: VFG <15 ml/min/1.73m² (falla renal)'
                },
                {
                  nombre: 'TOTAL ERC',
                  valor: erc.total_erc || 0,
                  descripcion: 'Total de personas con diagnóstico de enfermedad renal crónica'
                }
              ]
            }
          ];

          // Limpiar tabla y generar filas
          tbody.innerHTML = '';

          for (const categoria of metricas_tabla) {
            // Fila de encabezado de categoría
            const headerRow = document.createElement('tr');
            headerRow.className = 'table-section-header';
            headerRow.innerHTML = `
              <td colspan="4"><strong>${categoria.categoria}</strong></td>
            `;
            tbody.appendChild(headerRow);

            // Filas de métricas
            for (const item of categoria.items) {
              const porcentaje = data.total_personas_pscv > 0 ?
                ((item.valor / data.total_personas_pscv) * 100).toFixed(1) : '0.0';

              const row = document.createElement('tr');
              row.innerHTML = `
                <td style="padding-left: 1.5rem;">${item.nombre}</td>
                <td class="text-center"><strong>${item.valor}</strong></td>
                <td class="text-center">${porcentaje}%</td>
                <td><small class="text-muted">${item.descripcion}</small></td>
              `;
              tbody.appendChild(row);
            }
          }

          status.textContent = `Estadísticas actualizadas - Total personas PSCV: ${data.total_personas_pscv}`;
          if (data.nota) {
            status.textContent += ` - ${data.nota}`;
          }

        } catch (error) {
          console.error('Error cargando estadísticas de todas las personas PSCV:', error);
          tbody.innerHTML = '<tr><td colspan="4" class="text-center text-danger">Error al cargar estadísticas de todas las personas PSCV</td></tr>';
          status.textContent = 'Error al cargar datos de todas las personas PSCV';

          // Limpiar contadores del dashboard
          document.getElementById('todas-pscv-total').textContent = '0';
          document.getElementById('todas-pscv-sobrepeso-obesidad').textContent = '0';
          document.getElementById('todas-pscv-actividad').textContent = '0';
          document.getElementById('todas-pscv-fumador').textContent = '0';
          document.getElementById('todas-pscv-erc').textContent = '0';
        }
      }

      // ===================== SECCIÓN A: Matriz por bandas etarias =====================
      async function cargarSeccionAMatriz(paramsFromChart){
        console.log('🚀 SECCIÓN A - Iniciando carga...');

        try {
          const status = document.getElementById('seccion-a-status');

          if (status) status.textContent = 'Cargando datos de Sección A PSCV...';

          // Obtener datos del backend con la misma lógica exitosa de la prueba
          const response = await fetch('/api/estadisticas/pscv_programa_rem_anual', {
            credentials: 'same-origin'
          });

          console.log('📊 Response status:', response.status);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }

          const data = await response.json();
          console.log('📊 Datos recibidos del backend:', data);

          if (!data.success || !data.filas) {
            throw new Error('Datos inválidos del backend');
          }

          // Buscar y procesar datos de PSCV
          const pscvData = data.filas.find(f => f.concepto === 'Número de personas en PSCV');
          if (!pscvData) {
            throw new Error('No se encontraron datos de PSCV');
          }

          console.log('🎯 Datos PSCV encontrados:', pscvData);

          // Actualizar totales PSCV principales
          const pscvTotal = document.getElementById('pscv-total');
          const pscvTotalH = document.getElementById('pscv-total-h');
          const pscvTotalM = document.getElementById('pscv-total-m');

          if (pscvTotal) {
            pscvTotal.textContent = pscvData.total_ambos || '0';
            console.log('✅ pscv-total actualizado:', pscvData.total_ambos);
          }
          if (pscvTotalH) {
            pscvTotalH.textContent = pscvData.total_hombres || '0';
            console.log('✅ pscv-total-h actualizado:', pscvData.total_hombres);
          }
          if (pscvTotalM) {
            pscvTotalM.textContent = pscvData.total_mujeres || '0';
            console.log('✅ pscv-total-m actualizado:', pscvData.total_mujeres);
          }

          // Actualizar también las bandas etarias de PSCV
          const gruposEdad = ['15-19', '20-24', '25-29', '30-34', '35-39', '40-44',
                             '45-49', '50-54', '55-59', '60-64', '65-69', '70-74', '75-79', '80+'];

          gruposEdad.forEach(grupo => {
            const grupoSinMas = grupo.replace('+', ''); // "80+" -> "80"
            const hombresEl = document.getElementById(`pscv-${grupoSinMas}-h`);
            const mujeresEl = document.getElementById(`pscv-${grupoSinMas}-m`);

            if (hombresEl && pscvData[`${grupo}_h`] !== undefined) {
              hombresEl.textContent = pscvData[`${grupo}_h`] || '0';
              console.log(`✅ pscv-${grupoSinMas}-h actualizado:`, pscvData[`${grupo}_h`]);
            }

            if (mujeresEl && pscvData[`${grupo}_m`] !== undefined) {
              mujeresEl.textContent = pscvData[`${grupo}_m`] || '0';
              console.log(`✅ pscv-${grupoSinMas}-m actualizado:`, pscvData[`${grupo}_m`]);
            }
          });

          // Procesar otros conceptos del backend
          data.filas.forEach(fila => {
            if (fila.concepto.includes('riesgo cardiovascular')) {
              // Actualizar datos de clasificación de riesgo
              let prefijo = '';
              if (fila.concepto.includes('bajo')) prefijo = 'riesgo-bajo';
              else if (fila.concepto.includes('moderado')) prefijo = 'riesgo-mod';
              else if (fila.concepto.includes('alto')) prefijo = 'riesgo-alto';

              if (prefijo) {
                const totalEl = document.getElementById(`${prefijo}-total`);
                const totalHEl = document.getElementById(`${prefijo}-total-h`);
                const totalMEl = document.getElementById(`${prefijo}-total-m`);

                if (totalEl) totalEl.textContent = fila.total_ambos || '0';
                if (totalHEl) totalHEl.textContent = fila.total_hombres || '0';
                if (totalMEl) totalMEl.textContent = fila.total_mujeres || '0';

                console.log(`✅ ${prefijo} totales actualizados`);
              }
            }

            if (fila.concepto.includes('Tabaquismo')) {
              // Actualizar solo bandas ≥55 años para tabaquismo
              const bandasTabaq = ['55-59', '60-64', '65-69', '70-74', '75-79', '80+'];
              bandasTabaq.forEach(banda => {
                const bandaSinMas = banda.replace('+', '');
                const hombresEl = document.getElementById(`tabaq-${bandaSinMas}-h`);
                const mujeresEl = document.getElementById(`tabaq-${bandaSinMas}-m`);

                if (hombresEl && fila[`${banda}_h`] !== undefined) {
                  hombresEl.textContent = fila[`${banda}_h`] || '0';
                }
                if (mujeresEl && fila[`${banda}_m`] !== undefined) {
                  mujeresEl.textContent = fila[`${banda}_m`] || '0';
                }
              });
              console.log('✅ Tabaquismo bandas actualizadas');
            }
          });

          if (status) {
            status.textContent = '✅ Datos de Sección A cargados correctamente';
          }

          if (!thead) {
            console.error('No se encontró el thead de la Sección A PSCV');
            return;
          }

          if (status) {
            status.textContent = 'Cargando datos de Sección A PSCV...';
          let query = '';
          if(paramsFromChart instanceof URLSearchParams){
            query = paramsFromChart.toString();
          } else {
            const params = new URLSearchParams();
            const sEl = document.getElementById('sectores_select'); const s = sEl && sEl.value; if(s) params.set('sectores', s);
            const sxEl = document.getElementById('sexo_select'); const sx = sxEl && sxEl.value; if(sx) params.set('sexo', sx);
            const cEl = document.getElementById('categorias_select'); const c = cEl && cEl.value; if(c) params.set('categorias', c);
            const gEl = document.getElementById('grupo_etareo_select'); const g = gEl && gEl.value; if(g) params.set('grupos_etareos', g);
            const pEl = document.getElementById('patologia_filtro'); const p = pEl && pEl.value; if(p) params.set('patologias', p);
            const desdeEl = document.getElementById('fecha_desde'); const desde = desdeEl && desdeEl.value; if(desde) params.set('fecha_desde', desde);
            const hastaEl = document.getElementById('fecha_hasta'); const hasta = hastaEl && hastaEl.value; if(hasta) params.set('fecha_hasta', hasta);
            query = params.toString();
          }

          // Intentar fuente principal (con bandas + filas por banda)
          let bandas = [];
          let filas = [];
          let principalOk = false;
          let origenBandas = '';
          try{
            // Construir query ANUAL a partir de los filtros actuales
            const qAnual = new URLSearchParams(query);
            const desde = document.getElementById('fecha_desde')?.value || '';
            const hasta = document.getElementById('fecha_hasta')?.value || '';
            if(desde) qAnual.set('inicio', desde);
            if(hasta){
              try{
                const d = new Date(hasta); d.setDate(d.getDate()+1);
                const y=d.getFullYear(); const m=String(d.getMonth()+1).padStart(2,'0'); const dd=String(d.getDate()).padStart(2,'0');
                qAnual.set('fin', `${y}-${m}-${dd}`);
              }catch(_){ /* noop */ }
              qAnual.set('fecha_corte', hasta);
            }
            const r = await fetch('/api/estadisticas/pscv_programa_rem_anual' + (qAnual.toString()? ('?'+qAnual.toString()):''), { credentials: 'same-origin' });
            console.log('Respuesta del endpoint:', r.status);
            if(r.ok){
              const j = await r.json();
              console.log('Datos recibidos:', j);
              if(j && j.success){
                bandas = j.bandas || [];
                filas = j.filas || [];
                principalOk = true;
                console.log('Datos procesados - bandas:', bandas.length, 'filas:', filas.length);
                if(bandas && bandas.length>0) origenBandas = 'pscv_programa_rem_anual';
              }
            }
          }catch(_){ /* noop, probaremos fallback */ }

          // Si falla el endpoint anual, usar el anterior como respaldo
          if(!principalOk){
            try{
              const r = await fetch('/api/estadisticas/pscv_programa_bandas' + (query? ('?'+query):''), { credentials: 'same-origin' });
              if(r.ok){
                const j = await r.json();
                if(j && j.success){
                  bandas = j.bandas || [];
                  filas = j.filas || [];
                  principalOk = true;
                  if(bandas && bandas.length>0) origenBandas = 'pscv_programa_bandas';
                }
              }
            }catch(_){ /* noop, probaremos fallback */ }
          }

          // Fallback: derivar bandas desde pscv_matriz y totales desde pscv_resumen
          if(!principalOk){
            try{
              const [rm, rr] = await Promise.all([
                fetch('/api/estadisticas/pscv_matriz' + (query? ('?'+query):''), { credentials: 'same-origin' }),
                fetch('/api/estadisticas/pscv_resumen' + (query? ('?'+query):''), { credentials: 'same-origin' })
              ]);
              if(rm.ok){
                const jm = await rm.json();
                if(jm && jm.success){
                  bandas = (jm.matriz||[]).map(x => x.banda);
                  if(bandas && bandas.length>0) origenBandas = 'pscv_matriz';
                }
              }
              if(rr.ok){
                const jr = await rr.json();
                if(jr && jr.success){
                  const riesgo = jr.riesgo||[];
                  const fac = jr.factores||[];
                  // Construir "filas" con solo totales y sin por_banda (queda vacío, se muestran celdas vacías)
                  const pushFila = (nombre, fuenteArr) => {
                    const row = fuenteArr.find(x => x.item === nombre);
                    filas.push({
                      item: nombre,
                      totales: { ambos: num(row?.ambos||0), hombres: num(row?.hombres||0), mujeres: num(row?.mujeres||0) },
                      por_banda: {}
                    });
                  };
                  ['Bajo','Moderado','Alto'].forEach(n => pushFila(n, riesgo));
                  [
                    'Hipertensión Arterial','Diabetes Mellitus tipo 2','Dislipidemia',
                    'Tabaquismo ≥ 55 años',
                    'Antecedentes de Infarto Agudo al Miocardio (IAM)',
                    'Antecedentes de Ataque Cerebro Vascular (ACV)',
                    'Antecedentes de otras Enfermedades Cardiovasculares ECV (excepto IAM y ACV)',
                    'Enfermedad renal crónica (etapas 1 a 5)'
                  ].forEach(n => pushFila(n, fac));
                }
              }
            }catch(_){ /* si falla totalmente, seguiremos con arrays vacíos y mostraremos error abajo */ }
          }

          // Fallback extra: si aún no hay bandas, intentar leerlas desde la tabla PSCV ya renderizada en el DOM
          if(!bandas || bandas.length === 0){
            try{
              const filasPscv = Array.from(document.querySelectorAll('#pscv-body tr'));
              const labels = [];
              const seen = new Set();
              filasPscv.forEach(tr => {
                const c0 = tr.querySelector('td');
                if(c0){
                  const txt = (c0.textContent||'').trim();
                  if(txt && !seen.has(txt)){
                    seen.add(txt);
                    labels.push(txt);
                  }
                }
              });
              if(labels.length>0){ bandas = labels; origenBandas = 'tabla_pscv_dom'; }
            }catch(_){ /* noop */ }
          }

          // Fallback final: utilizar bandas por defecto para que el encabezado siempre sea visible
          if(!bandas || bandas.length === 0){
            bandas = BANDAS_PSCV_DEFAULT.slice();
            origenBandas = 'bandas_default';
          }

          // Encabezado de 3 niveles para alinear con planilla (RANGO ETARIO Y SEXO)
          const headerTop = document.createElement('tr');
          const bandGroupTop = bandas.length > 0 ? `<th class="sep-total" colspan="${bandas.length * 2}">RANGO ETARIO Y SEXO</th>` : '';
          headerTop.innerHTML = `
            <th rowspan="3" class="sticky-col sticky-col-shadow concept-col">CONCEPTO</th>
            <th colspan="3">TOTAL</th>
            ${bandGroupTop}
            <th class="sep-po" colspan="2">Pueblos Originarios</th>
            <th class="sep-mig" colspan="2">Migrantes</th>
          `;
          const headerMid = document.createElement('tr');
          const bandGroupMid = bandas.length > 0 ? bandas.map((b,i) => `<th colspan="2" class="${i===0 ? 'sep-total' : ''}">${b} años</th>`).join('') : '';
          headerMid.innerHTML = `
            <th>Ambos sexos</th><th>Hombres</th><th>Mujeres</th>
            ${bandGroupMid}
            <th class="sep-po">Hombres</th><th>Mujeres</th>
            <th class="sep-mig">Hombres</th><th>Mujeres</th>
          `;
          const headerBot = document.createElement('tr');
          const leftPlaceholders = Array(3).fill('<th style="visibility:hidden"></th>').join('');
          const bandGroupBot = bandas.length > 0 ? bandas.map((_,i) => `<th class="${i===0 ? 'sep-total' : ''}">Hombres</th><th>Mujeres</th>`).join('') : '';
          const rightPlaceholders = Array(4).fill('<th style="visibility:hidden"></th>').join('');
          headerBot.innerHTML = `
            ${leftPlaceholders}
            ${bandGroupBot}
            ${rightPlaceholders}
          `;
          thead.innerHTML = '';
          thead.appendChild(headerTop);
          thead.appendChild(headerMid);
          thead.appendChild(headerBot);

          // Convertir datos del endpoint a formato compatible
          const filasMap = new Map();
          filas.forEach(f => {
            filasMap.set(f.concepto, f);
          });

          console.log('Datos procesados en mapa:', filasMap);

          // En lugar de reemplazar toda la tabla, actualizar los valores en los IDs existentes
          // 1. Actualizar datos de PSCV
          const filaPscv = filasMap.get('Número de personas en PSCV') || {};

          // Actualizar totales PSCV
          const pscvTotal = document.getElementById('pscv-total');
          const pscvTotalH = document.getElementById('pscv-total-h');
          const pscvTotalM = document.getElementById('pscv-total-m');

          if (pscvTotal) pscvTotal.textContent = num(filaPscv.total_ambos || 0);
          if (pscvTotalH) pscvTotalH.textContent = num(filaPscv.total_hombres || 0);
          if (pscvTotalM) pscvTotalM.textContent = num(filaPscv.total_mujeres || 0);

          // Actualizar bandas etarias PSCV
          bandas.forEach(banda => {
            const bandaId = banda.replace('+', '-mas'); // Convertir "80+" a "80-mas"
            const hombresId = `pscv-${bandaId}-h`;
            const mujeresId = `pscv-${bandaId}-m`;

            const hombresEl = document.getElementById(hombresId);
            const mujeresEl = document.getElementById(mujeresId);

            if (hombresEl) hombresEl.textContent = num(filaPscv[`${banda}_h`] || 0);
            if (mujeresEl) mujeresEl.textContent = num(filaPscv[`${banda}_m`] || 0);
          });

          // 2. Actualizar datos de clasificación de riesgo
          ['Bajo', 'Moderado', 'Alto'].forEach(riesgo => {
            const filaRiesgo = filasMap.get(riesgo) || {};
            const riesgoId = riesgo.toLowerCase();

            // Actualizar totales
            const totalEl = document.getElementById(`riesgo-${riesgoId === 'bajo' ? 'bajo' : (riesgoId === 'moderado' ? 'mod' : 'alto')}-total`);
            const totalHEl = document.getElementById(`riesgo-${riesgoId === 'bajo' ? 'bajo' : (riesgoId === 'moderado' ? 'mod' : 'alto')}-total-h`);
            const totalMEl = document.getElementById(`riesgo-${riesgoId === 'bajo' ? 'bajo' : (riesgoId === 'moderado' ? 'mod' : 'alto')}-total-m`);

            if (totalEl) totalEl.textContent = num(filaRiesgo.total_ambos || 0);
            if (totalHEl) totalHEl.textContent = num(filaRiesgo.total_hombres || 0);
            if (totalMEl) totalMEl.textContent = num(filaRiesgo.total_mujeres || 0);

            // Actualizar bandas etarias para riesgo
            bandas.forEach(banda => {
              const bandaId = banda.replace('+', '-mas');
              const prefijo = riesgoId === 'bajo' ? 'bajo' : (riesgoId === 'moderado' ? 'mod' : 'alto');
              const hombresId = `riesgo-${prefijo}-${bandaId}-h`;
              const mujeresId = `riesgo-${prefijo}-${bandaId}-m`;

              const hombresEl = document.getElementById(hombresId);
              const mujeresEl = document.getElementById(mujeresId);

              if (hombresEl) hombresEl.textContent = num(filaRiesgo[`${banda}_h`] || 0);
              if (mujeresEl) mujeresEl.textContent = num(filaRiesgo[`${banda}_m`] || 0);
            });
          });

          // 3. Actualizar datos de Tabaquismo ≥ 55 años (si existe)
          const filaTabaquismo = filasMap.get('Tabaquismo ≥ 55 años') || {};

          // Tabaquismo solo tiene datos para bandas ≥55 años
          const bandasTabaquismo = ['55-59', '60-64', '65-69', '70-74', '75-79', '80+'];


          console.log('🎉 Sección A actualizada correctamente - FINALIZADA');

        } catch (error) {
          console.error('❌ Error al cargar Sección A:', error);
          if (status) {
            status.textContent = '❌ Error al cargar Sección A: ' + error.message;
          }
        }
      }

      // Ajusta la primera columna (CONCEPTO) al ancho del texto más largo sin exceder un máximo
      function ajustarAnchoConceptoStickyCols(){
        try{
          const celdas = document.querySelectorAll('th.sticky-col.concept-col, td.sticky-col.concept-col');
          if(!celdas || celdas.length===0) return;
          let max = 0;
          celdas.forEach(el => {
            // Usar scrollWidth para aproximar el ancho del contenido
            max = Math.max(max, el.scrollWidth);
          });
          // Agregar margen por padding interno y bordes
          const ancho = Math.min(Math.max(max + 24, 280), 520); // entre 280 y 520 px
          celdas.forEach(el => {
            el.style.width = ancho + 'px';
            el.style.minWidth = ancho + 'px';
            el.style.maxWidth = ancho + 'px';
          });
        }catch(_){ /* noop */ }
      }

      // Exporta una tabla HTML a un worksheet y lo agrega a un workbook
      function exportarTablaAExcel(selector, sheetName, wb){
        try{
          const table = document.querySelector(selector);
          if(!table) return;
          const ws = XLSX.utils.table_to_sheet(table, {raw:true});
          XLSX.utils.book_append_sheet(wb, ws, sheetName);
        }catch(_){ /* noop */ }
      }

      // ===================== P5 SECCIÓN B: Estado Nutricional (dinámica desde backend) =====================
      async function cargarP5SeccionBEstadoNutricional(){
        const thead = document.getElementById('p5b-head');
        const tbody = document.getElementById('p5b-body');
        const status = document.getElementById('p5b-status');
        try{
          if(status) status.textContent = 'Cargando…';
          if(!thead || !tbody) return;

          const params = new URLSearchParams();
          const sEl = document.getElementById('sectores_select'); const s = sEl && sEl.value; if(s) params.set('sectores', s);
          const sxEl = document.getElementById('sexo_select'); const sx = sxEl && sxEl.value; if(sx) params.set('sexo', sx);
          const cEl = document.getElementById('categorias_select'); const c = cEl && cEl.value; if(c) params.set('categorias', c);
          const desdeEl = document.getElementById('fecha_desde'); const desde = desdeEl && desdeEl.value; if(desde) params.set('fecha_desde', desde);
          const hastaEl = document.getElementById('fecha_hasta'); const hasta = hastaEl && hastaEl.value; if(hasta) params.set('fecha_hasta', hasta);
          // Mapear filtros de fecha a ventana anual del backend (inicio, fin excl, fecha_corte)
          if(desde) params.set('inicio', desde);
          if(hasta){
            try{
              const d = new Date(hasta); d.setDate(d.getDate()+1);
              const y = d.getFullYear(); const m = String(d.getMonth()+1).padStart(2,'0'); const dd = String(d.getDate()).padStart(2,'0');
              params.set('fin', `${y}-${m}-${dd}`);
            }catch(_){ /* noop */ }
            params.set('fecha_corte', hasta);
          }
          appendRemParams(params);

          let bandas = [];
          let filas = [];
          let ok = false;
          try{
            const r = await fetch('/api/estadisticas/p5_estado_nutricional_anual' + (params.toString()? ('?'+params.toString()):''), { credentials: 'same-origin' });
            if(r.ok){
              const j = await r.json();
              if(j && j.success){
                bandas = j.bandas || [];
                const raw = j.filas || [];
                // Normalizar como en EFAM: condicion->item, por_tramo->por_banda, extras totales a H/M (placeholder)
                filas = raw.map(f => {
                  const por_banda = {};
                  const src = f.por_tramo || {};
                  for(const [b, v] of Object.entries(src)){
                    por_banda[b] = { hombres: v?.hombres||0, mujeres: v?.mujeres||0 };
                  }
                  const po_h = f.pueblos_originarios || 0; const po_m = 0;
                  const mig_h = f.migrantes || 0; const mig_m = 0;
                  const el_h = f.personas_mayores_en_eleam || 0; const el_m = 0;
                  return {
                    item: f.condicion,
                    totales: f.totales || {ambos:0,hombres:0,mujeres:0},
                    por_banda,
                    po: {hombres: po_h, mujeres: po_m},
                    mig: {hombres: mig_h, mujeres: mig_m},
                    eleam: {hombres: el_h, mujeres: el_m}
                  };
                });
                ok = true;
              }
            }
          }catch(_){ ok = false; }

          if(!bandas || bandas.length===0){ bandas = P5_BANDAS_DEFAULT.slice(); }

          // Encabezado multi-nivel
          const h1 = document.createElement('tr');
          h1.innerHTML = `
            <th rowspan="3" class="sticky-col sticky-col-shadow concept-col">ESTADO NUTRICIONAL</th>
            <th colspan="3">TOTAL</th>
            <th class="sep-total" colspan="${bandas.length*2}">RANGO ETARIO Y SEXO</th>
            <th class="sep-po" colspan="2">Pueblos Originarios</th>
            <th class="sep-mig" colspan="2">Migrantes</th>
            <th colspan="2">Personas Mayores en ELEAM</th>`;
          const h2 = document.createElement('tr');
          h2.innerHTML = `
            <th>Ambos sexos</th><th>Hombres</th><th>Mujeres</th>
            ${bandas.map((b,i)=>`<th colspan=\"2\" class=\"${i===0?'sep-total':''}\">${b}</th>`).join('')}
            <th class="sep-po">Hombres</th><th>Mujeres</th>
            <th class="sep-mig">Hombres</th><th>Mujeres</th>
            <th>Hombres</th><th>Mujeres</th>`;
          const h3 = document.createElement('tr');
          h3.innerHTML = `
            ${Array(3).fill('<th style="visibility:hidden"></th>').join('')}
            ${bandas.map((_,i)=>`<th class="${i===0?'sep-total':''}">Hombres</th><th>Mujeres</th>`).join('')}
            ${Array(6).fill('<th style="visibility:hidden"></th>').join('')}`;
          thead.innerHTML=''; thead.appendChild(h1); thead.appendChild(h2); thead.appendChild(h3);

          // Orden esperado
          const orden = ['Bajo peso','Normal','Sobrepeso','Obeso','TOTAL'];
          const mapExact = new Map((filas||[]).map(f => [f.item, f]));
          const mapLoose = new Map((filas||[]).map(f => [keyizeLabel(f.item), f]));
          function getRow(name){ return mapExact.get(name) || mapLoose.get(keyizeLabel(name)) || null; }

          tbody.innerHTML='';
          for(const item of orden){
            const r = getRow(item) || { totales:{ambos:0,hombres:0,mujeres:0}, po:{hombres:0,mujeres:0}, mig:{hombres:0,mujeres:0}, eleam:{hombres:0,mujeres:0}, por_banda:{} };
            const isTotal = item === 'TOTAL';
            const tr = document.createElement('tr');
            const celdasBand = bandas.map((b,i)=>{
              const pb = r?.por_banda?.[b] || {hombres:0, mujeres:0};
              return `<td class="${i===0?'sep-total':''}">${num(pb.hombres||0)}</td><td>${num(pb.mujeres||0)}</td>`;
            }).join('');
            tr.innerHTML = `
              <td class="sticky-col sticky-col-shadow concept-col ${isTotal?'fw-semibold':''}">${item}</td>
              <td class="sep-total">${num(r.totales?.ambos||0)}</td><td>${num(r.totales?.hombres||0)}</td><td>${num(r.totales?.mujeres||0)}</td>
              ${celdasBand}
              <td class="sep-po">${num(r.po?.hombres||0)}</td><td>${num(r.po?.mujeres||0)}</td>
              <td class="sep-mig">${num(r.mig?.hombres||0)}</td><td>${num(r.mig?.mujeres||0)}</td>
              <td>${num(r.eleam?.hombres||0)}</td><td>${num(r.eleam?.mujeres||0)}</td>`;
            tbody.appendChild(tr);
          }

          if(status) status.textContent = ok ? '' : 'Sin datos (se muestran 0)';
          ajustarAnchoConceptoStickyCols();
        }catch(e){
          console.error('P5 estado nutricional error', e);
          if(status) status.textContent = 'No se pudo cargar P5 Sección B';
        }
      }

      // ===================== Sección C: Personas mayores con sospecha de maltrato (dinámica) =====================
      async function cargarP5SeccionCMaltrato(){
        const thead = document.getElementById('p5c-head');
        const tbody = document.getElementById('p5c-body');
        const status = document.getElementById('p5c-status');
        try{
          if(status) status.textContent = 'Cargando…';
          if(!thead || !tbody) return;

          const params = new URLSearchParams();
          const sEl = document.getElementById('sectores_select'); const s = sEl && sEl.value; if(s) params.set('sectores', s);
          const sxEl = document.getElementById('sexo_select'); const sx = sxEl && sxEl.value; if(sx) params.set('sexo', sx);
          const cEl = document.getElementById('categorias_select'); const c = cEl && cEl.value; if(c) params.set('categorias', c);
          const desdeEl = document.getElementById('fecha_desde'); const desde = desdeEl && desdeEl.value; if(desde) params.set('fecha_desde', desde);
          const hastaEl = document.getElementById('fecha_hasta'); const hasta = hastaEl && hastaEl.value; if(hasta) params.set('fecha_hasta', hasta);
          // Mapear a ventana anual
          if(desde) params.set('inicio', desde);
          if(hasta){
            try{
              const d = new Date(hasta); d.setDate(d.getDate()+1);
              const y = d.getFullYear(); const m = String(d.getMonth()+1).padStart(2,'0'); const dd = String(d.getDate()).padStart(2,'0');
              params.set('fin', `${y}-${m}-${dd}`);
            }catch(_){ /* noop */ }
            params.set('fecha_corte', hasta);
          }
          appendRemParams(params);

          let bandas = [];
          let filas = [];
          let ok = false;
          try{
            const r = await fetch('/api/estadisticas/p5_sospecha_maltrato_anual' + (params.toString()? ('?'+params.toString()):''), { credentials: 'same-origin' });
            if(r.ok){
              const j = await r.json();
              if(j && j.success){
                bandas = j.bandas||[];
                const raw = j.filas||[];
                // Normalizar estructura: por_tramo -> por_banda, extras totales como placeholders H/M
                filas = raw.map(f => {
                  const por_banda = {};
                  const src = f.por_tramo || {};
                  for(const [b, v] of Object.entries(src)){
                    por_banda[b] = { hombres: v?.hombres||0, mujeres: v?.mujeres||0 };
                  }
                  const po_h = f.pueblos_originarios || 0; const po_m = 0;
                  const mig_h = f.migrantes || 0; const mig_m = 0;
                  const el_h = f.personas_mayores_en_eleam || 0; const el_m = 0;
                  return {
                    item: f.item || 'Personas con sospecha de maltrato',
                    totales: f.totales || {ambos:0,hombres:0,mujeres:0},
                    por_banda,
                    po: {hombres: po_h, mujeres: po_m},
                    mig: {hombres: mig_h, mujeres: mig_m},
                    eleam: {hombres: el_h, mujeres: el_m}
                  };
                });
                ok = true;
              }
            }
          }catch(_){ ok = false; }

          if(!bandas || bandas.length===0){ bandas = P5_BANDAS_DEFAULT.slice(); }

          const h1 = document.createElement('tr');
          h1.innerHTML = `
            <th rowspan="3" class="sticky-col sticky-col-shadow concept-col">CONCEPTO</th>
            <th colspan="3">TOTAL</th>
            <th class="sep-total" colspan="${bandas.length*2}">RANGO ETARIO Y SEXO</th>
            <th class="sep-po" colspan="2">Pueblos Originarios</th>
            <th class="sep-mig" colspan="2">Migrantes</th>
            <th colspan="2">Personas Mayores en ELEAM</th>`;
          const h2 = document.createElement('tr');
          h2.innerHTML = `
            <th>Ambos sexos</th><th>Hombres</th><th>Mujeres</th>
            ${bandas.map((b,i)=>`<th colspan=\"2\" class=\"${i===0?'sep-total':''}\">${b}</th>`).join('')}
            <th class="sep-po">Hombres</th><th>Mujeres</th>
            <th class="sep-mig">Hombres</th><th>Mujeres</th>
            <th>Hombres</th><th>Mujeres</th>`;
          const h3 = document.createElement('tr');
          h3.innerHTML = `
            ${Array(3).fill('<th style="visibility:hidden"></th>').join('')}
            ${bandas.map((_,i)=>`<th class="${i===0?'sep-total':''}">Hombres</th><th>Mujeres</th>`).join('')}
            ${Array(6).fill('<th style="visibility:hidden"></th>').join('')}`;
          thead.innerHTML=''; thead.appendChild(h1); thead.appendChild(h2); thead.appendChild(h3);

          const r = (filas && filas[0]) || null;
          const tot = r?.totales || {ambos:0,hombres:0,mujeres:0};
          const po = r?.po || {hombres:0, mujeres:0};
          const mig = r?.mig || {hombres:0, mujeres:0};
          const eleam = r?.eleam || {hombres:0, mujeres:0};
          tbody.innerHTML='';
          const celdasBand = bandas.map((b,i)=>{
            const pb = r?.por_banda?.[b] || {hombres:0, mujeres:0};
            return `<td class="${i===0?'sep-total':''}">${num(pb.hombres||0)}</td><td>${num(pb.mujeres||0)}</td>`;
          }).join('');
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="sticky-col sticky-col-shadow concept-col">Personas con sospecha de maltrato</td>
            <td class="sep-total">${num(tot.ambos||0)}</td><td>${num(tot.hombres||0)}</td><td>${num(tot.mujeres||0)}</td>
            ${celdasBand}
            <td class="sep-po">${num(po.hombres||0)}</td><td>${num(po.mujeres||0)}</td>
            <td class="sep-mig">${num(mig.hombres||0)}</td><td>${num(mig.mujeres||0)}</td>
            <td>${num(eleam.hombres||0)}</td><td>${num(eleam.mujeres||0)}</td>`;
          tbody.appendChild(tr);

          if(status) status.textContent = ok ? '' : 'Sin datos (se muestran 0)';
          ajustarAnchoConceptoStickyCols();
        }catch(e){
          console.error('P5 C maltrato error', e);
          if(status) status.textContent = 'No se pudo cargar P5 Sección C';
        }
      }

      // ===================== Sección D: Personas mayores en actividad física (dinámica desde backend) =====================
      async function cargarP5SeccionDActividadFisica(){
        const thead = document.getElementById('p5d-head');
        const tbody = document.getElementById('p5d-body');
        const status = document.getElementById('p5d-status');
        try{
          if(status) status.textContent = 'Cargando…';
          if(!thead || !tbody) return;

          // Construir query con filtros + parámetros REM-P
          const params = new URLSearchParams();
          const sEl = document.getElementById('sectores_select'); const s = sEl && sEl.value; if(s) params.set('sectores', s);
          const sxEl = document.getElementById('sexo_select'); const sx = sxEl && sxEl.value; if(sx) params.set('sexo', sx);
          const cEl = document.getElementById('categorias_select'); const c = cEl && cEl.value; if(c) params.set('categorias', c);
          const desdeEl = document.getElementById('fecha_desde'); const desde = desdeEl && desdeEl.value; if(desde) params.set('fecha_desde', desde);
          const hastaEl = document.getElementById('fecha_hasta'); const hasta = hastaEl && hastaEl.value; if(hasta) params.set('fecha_hasta', hasta);
          // Mapear a ventana anual
          if(desde) params.set('inicio', desde);
          if(hasta){
            try{
              const d = new Date(hasta); d.setDate(d.getDate()+1);
              const y = d.getFullYear(); const m = String(d.getMonth()+1).padStart(2,'0'); const dd = String(d.getDate()).padStart(2,'0');
              params.set('fin', `${y}-${m}-${dd}`);
            }catch(_){ /* noop */ }
            params.set('fecha_corte', hasta);
          }
          appendRemParams(params);

          // Llamada al endpoint
          let bandas = [];
          let filas = [];
          let ok = false;
          try{
            const r = await fetch('/api/estadisticas/p5_actividad_fisica_anual' + (params.toString()? ('?'+params.toString()):''), { credentials: 'same-origin' });
            if(r.ok){
              const j = await r.json();
              if(j && j.success){
                bandas = j.bandas || [];
                const raw = j.filas || [];
                // Normalizar estructura: por_tramo -> por_banda, extras totales como placeholders H/M
                filas = raw.map(f => {
                  const por_banda = {};
                  const src = f.por_tramo || {};
                  for(const [b, v] of Object.entries(src)){
                    por_banda[b] = { hombres: v?.hombres||0, mujeres: v?.mujeres||0 };
                  }
                  const po_h = f.pueblos_originarios || 0; const po_m = 0;
                  const mig_h = f.migrantes || 0; const mig_m = 0;
                  const el_h = f.personas_mayores_en_eleam || 0; const el_m = 0;
                  return {
                    item: f.item || 'Personas en actividad física',
                    totales: f.totales || {ambos:0,hombres:0,mujeres:0},
                    por_banda,
                    po: {hombres: po_h, mujeres: po_m},
                    mig: {hombres: mig_h, mujeres: mig_m},
                    eleam: {hombres: el_h, mujeres: el_m}
                  };
                });
                ok = true;
              }
            }
          }catch(_){ ok = false; }

          if(!bandas || bandas.length===0){ bandas = P5_BANDAS_DEFAULT.slice(); }

          // Encabezado 3 niveles
          const h1 = document.createElement('tr');
          h1.innerHTML = `
            <th rowspan="3" class="sticky-col sticky-col-shadow concept-col">CONCEPTO</th>
            <th colspan="3">TOTAL</th>
            <th class="sep-total" colspan="${bandas.length*2}">RANGO ETARIO Y SEXO</th>
            <th class="sep-po" colspan="2">Pueblos Originarios</th>
            <th class="sep-mig" colspan="2">Migrantes</th>
            <th colspan="2">Personas Mayores en ELEAM</th>`;
          const h2 = document.createElement('tr');
          h2.innerHTML = `
            <th>Ambos sexos</th><th>Hombres</th><th>Mujeres</th>
            ${bandas.map((b,i)=>`<th colspan=\"2\" class=\"${i===0?'sep-total':''}\">${b}</th>`).join('')}
            <th class="sep-po">Hombres</th><th>Mujeres</th>
            <th class="sep-mig">Hombres</th><th>Mujeres</th>
            <th>Hombres</th><th>Mujeres</th>`;
          const h3 = document.createElement('tr');
          h3.innerHTML = `
            ${Array(3).fill('<th style="visibility:hidden"></th>').join('')}
            ${bandas.map((_,i)=>`<th class="${i===0?'sep-total':''}">Hombres</th><th>Mujeres</th>`).join('')}
            ${Array(6).fill('<th style="visibility:hidden"></th>').join('')}`;
          thead.innerHTML=''; thead.appendChild(h1); thead.appendChild(h2); thead.appendChild(h3);

          // Render fila única
          const r = (filas && filas[0]) || null;
          const tot = r?.totales || {ambos:0,hombres:0,mujeres:0};
          const po = r?.po || {hombres:0, mujeres:0};
          const mig = r?.mig || {hombres:0, mujeres:0};
          const eleam = r?.eleam || {hombres:0, mujeres:0};
          tbody.innerHTML='';
          const celdasBand = bandas.map((b,i)=>{
            const pb = r?.por_banda?.[b] || {hombres:0, mujeres:0};
            return `<td class="${i===0?'sep-total':''}">${num(pb.hombres||0)}</td><td>${num(pb.mujeres||0)}</td>`;
          }).join('');
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="sticky-col sticky-col-shadow concept-col">Personas en actividad física</td>
            <td class="sep-total">${num(tot.ambos||0)}</td><td>${num(tot.hombres||0)}</td><td>${num(tot.mujeres||0)}</td>
            ${celdasBand}
            <td class="sep-po">${num(po.hombres||0)}</td><td>${num(po.mujeres||0)}</td>
            <td class="sep-mig">${num(mig.hombres||0)}</td><td>${num(mig.mujeres||0)}</td>
            <td>${num(eleam.hombres||0)}</td><td>${num(eleam.mujeres||0)}</td>`;
          tbody.appendChild(tr);

          if(status) status.textContent = ok ? '' : 'Sin datos (se muestran 0)';
          ajustarAnchoConceptoStickyCols();
        }catch(e){
          console.error('P5 D actividad física error', e);
          if(status) status.textContent = 'No se pudo cargar P5 Sección D';
        }
      }

      // ===================== Sección E: Personas mayores con riesgo de caídas (dinámica desde backend) =====================
      async function cargarP5SeccionERiesgoCaidas(){
        const thead = document.getElementById('p5e-head');
        const tbody = document.getElementById('p5e-body');
        const status = document.getElementById('p5e-status');
        try{
          if(status) status.textContent = 'Cargando…';
          if(!thead || !tbody) return;

          // Construir query con filtros + parámetros REM-P
          const params = new URLSearchParams();
          const sEl = document.getElementById('sectores_select'); const s = sEl && sEl.value; if(s) params.set('sectores', s);
          const sxEl = document.getElementById('sexo_select'); const sx = sxEl && sxEl.value; if(sx) params.set('sexo', sx);
          const cEl = document.getElementById('categorias_select'); const c = cEl && cEl.value; if(c) params.set('categorias', c);
          const desdeEl = document.getElementById('fecha_desde'); const desde = desdeEl && desdeEl.value; if(desde) params.set('fecha_desde', desde);
          const hastaEl = document.getElementById('fecha_hasta'); const hasta = hastaEl && hastaEl.value; if(hasta) params.set('fecha_hasta', hasta);
          // Mapear a ventana anual [inicio, fin_excl) y fecha_corte
          if(desde) params.set('inicio', desde);
          if(hasta){
            try{
              const d = new Date(hasta); d.setDate(d.getDate()+1);
              const y = d.getFullYear(); const m = String(d.getMonth()+1).padStart(2,'0'); const dd = String(d.getDate()).padStart(2,'0');
              params.set('fin', `${y}-${m}-${dd}`);
            }catch(_){ /* noop */ }
            params.set('fecha_corte', hasta);
          }
          appendRemParams(params);

          // Llamar API
          let bandas = [];
          let filas = [];
          let ok = false;
          try{
        const r = await fetch('/api/estadisticas/p5_riesgo_caidas_anual' + (params.toString()? ('?'+params.toString()):''), { credentials: 'same-origin' });
            if(r.ok){
              const j = await r.json();
              if(j && j.success){ bandas = j.bandas || []; filas = j.filas || []; ok = true; }
            }
          }catch(_){ ok = false; }

          if(!bandas || bandas.length===0){ bandas = P5_BANDAS_DEFAULT.slice(); }

          // Encabezado 3 niveles
          const h1 = document.createElement('tr');
          h1.innerHTML = `
            <th rowspan="3" class="sticky-col sticky-col-shadow concept-col">INSTRUMENTO DE<br/>EVALUACIÓN</th>
            <th rowspan="3">TIPO DE RIESGO</th>
            <th colspan="3">TOTAL</th>
            <th class="sep-total" colspan="${bandas.length*2}">RANGO ETARIO Y SEXO</th>
            <th class="sep-po" colspan="2">Pueblos Originarios</th>
            <th class="sep-mig" colspan="2">Migrantes</th>
            <th colspan="2">Personas Mayores en ELEAM</th>`;
          const h2 = document.createElement('tr');
          h2.innerHTML = `
            <th>Ambos sexos</th><th>Hombres</th><th>Mujeres</th>
            ${bandas.map((b,i)=>`<th colspan=\"2\" class=\"${i===0?'sep-total':''}\">${b}</th>`).join('')}
            <th class="sep-po">Hombres</th><th>Mujeres</th>
            <th class="sep-mig">Hombres</th><th>Mujeres</th>
            <th>Hombres</th><th>Mujeres</th>`;
          const h3 = document.createElement('tr');
          h3.innerHTML = `
            ${Array(3).fill('<th style="visibility:hidden"></th>').join('')}
            ${bandas.map((_,i)=>`<th class="${i===0?'sep-total':''}">Hombres</th><th>Mujeres</th>`).join('')}
            ${Array(6).fill('<th style="visibility:hidden"></th>').join('')}`;
          thead.innerHTML=''; thead.appendChild(h1); thead.appendChild(h2); thead.appendChild(h3);

          // Render filas
          tbody.innerHTML='';
          // Agrupar por instrumento preservando orden de llegada
          const orden = [];
          const porInstr = new Map();
          for(const r of filas){
            const instr = r.instrumento;
            if(!porInstr.has(instr)){ porInstr.set(instr, []); orden.push(instr); }
            porInstr.get(instr).push(r);
          }
          for(const instr of orden){
            const items = porInstr.get(instr) || [];
            const span = items.length || 1;
            let i = 0;
            for(const r of items){
              const tr = document.createElement('tr');
              const tot = r?.totales || {ambos:0,hombres:0,mujeres:0};
              const po = r?.po || {hombres:0, mujeres:0};
              const mig = r?.mig || {hombres:0, mujeres:0};
              const eleam = r?.eleam || {hombres:0, mujeres:0};
              const celdasBand = bandas.map((b,j)=>{
                const pb = r?.por_banda?.[b] || {hombres:0,mujeres:0};
                return `<td class="${j===0?'sep-total':''}">${num(pb.hombres||0)}</td><td>${num(pb.mujeres||0)}</td>`;
              }).join('');
              if(i===0){
                tr.innerHTML = `
                  <td rowspan="${span}" class="sticky-col sticky-col-shadow concept-col">${instr}</td>
                  <td>${r.riesgo||''}</td>
                  <td class="sep-total">${num(tot.ambos||0)}</td><td>${num(tot.hombres||0)}</td><td>${num(tot.mujeres||0)}</td>
                  ${celdasBand}
                  <td class="sep-po">${num(po.hombres||0)}</td><td>${num(po.mujeres||0)}</td>
                  <td class="sep-mig">${num(mig.hombres||0)}</td><td>${num(mig.mujeres||0)}</td>
                  <td>${num(eleam.hombres||0)}</td><td>${num(eleam.mujeres||0)}</td>`;
              } else {
                tr.innerHTML = `
                  <td>${r.riesgo||''}</td>
                  <td class="sep-total">${num(tot.ambos||0)}</td><td>${num(tot.hombres||0)}</td><td>${num(tot.mujeres||0)}</td>
                  ${celdasBand}
                  <td class="sep-po">${num(po.hombres||0)}</td><td>${num(po.mujeres||0)}</td>
                  <td class="sep-mig">${num(mig.hombres||0)}</td><td>${num(mig.mujeres||0)}</td>
                  <td>${num(eleam.hombres||0)}</td><td>${num(eleam.mujeres||0)}</td>`;
              }
              tbody.appendChild(tr);
              i++;
            }
          }

          if(status) status.textContent = ok ? '' : 'Sin datos (se muestran 0)';
          ajustarAnchoConceptoStickyCols();
        }catch(e){
          console.error('P5 E caídas error', e);
          if(status) status.textContent = 'No se pudo cargar P5 Sección E';
        }
      }

      // ===================== P5 SECCIÓN A: Funcionalidad (dinámica desde backend) =====================
      async function cargarP5SeccionA(){
        const status = document.getElementById('p5-status');
        const thead = document.getElementById('p5-head');
        const tbody = document.getElementById('p5-body');
        try{
          if(status) status.textContent = 'Cargando…';
          if(!thead || !tbody) return;

          // Construir query con filtros + parámetros REM-P
          const params = new URLSearchParams();
          const sEl = document.getElementById('sectores_select'); const s = sEl && sEl.value; if(s) params.set('sectores', s);
          const sxEl = document.getElementById('sexo_select'); const sx = sxEl && sxEl.value; if(sx) params.set('sexo', sx);
          const cEl = document.getElementById('categorias_select'); const c = cEl && cEl.value; if(c) params.set('categorias', c);
          const desdeEl = document.getElementById('fecha_desde'); const desde = desdeEl && desdeEl.value; if(desde) params.set('fecha_desde', desde);
          const hastaEl = document.getElementById('fecha_hasta'); const hasta = hastaEl && hastaEl.value; if(hasta) params.set('fecha_hasta', hasta);
          // Mapear a parámetros de ventana anual
          if(desde) params.set('inicio', desde);
          if(hasta){
            try{
              const d = new Date(hasta); d.setDate(d.getDate()+1);
              const y = d.getFullYear(); const m = String(d.getMonth()+1).padStart(2,'0'); const dd = String(d.getDate()).padStart(2,'0');
              params.set('fin', `${y}-${m}-${dd}`);
            }catch(_){ /* noop */ }
            params.set('fecha_corte', hasta);
          }
          // REM-P params no son requeridos aquí, pero mantener compatibilidad no afecta
          appendRemParams(params);

          let bandas = [];
          let filas = [];
          let ok = false;
          try{
            const url = '/api/estadisticas/efam_pm_anual' + (params.toString()? ('?'+params.toString()):'');
            const r = await fetch(url, { credentials: 'same-origin' });
            if(r.ok){
              const j = await r.json();
              if(j && j.success){
                bandas = j.bandas || [];
                // Normalizar filas del backend EFAM al formato de render existente
                const raw = j.filas || [];
                filas = raw.map(f => {
                  // por_tramo -> por_banda
                  const por_banda = {};
                  const src = f.por_tramo || {};
                  for(const [b, v] of Object.entries(src)){
                    por_banda[b] = { hombres: v?.hombres||0, mujeres: v?.mujeres||0 };
                  }
                  // PO/MIG/ELEAM: backend trae totales; mapeamos a columnas H/M (TODO: desagregar por sexo cuando esté disponible)
                  const po_h = f.pueblos_originarios || 0; const po_m = 0;
                  const mig_h = f.migrantes || 0; const mig_m = 0;
                  const el_h = f.personas_mayores_en_eleam || 0; const el_m = 0;
                  return {
                    item: f.condicion,
                    totales: f.totales || {ambos:0,hombres:0,mujeres:0},
                    por_banda,
                    po: {hombres: po_h, mujeres: po_m},
                    mig: {hombres: mig_h, mujeres: mig_m},
                    eleam: {hombres: el_h, mujeres: el_m}
                  };
                });
                ok = true;
              }
            }
          }catch(_){ ok = false; }

          if(!bandas || bandas.length===0){
            // Fallback fijo si el backend no define
            bandas = ['65 a 69 años','70 a 74 años','75 a 79 años','80 a 84 años','85 a 89 años','90 a 94 años','95 a 99 años','100 y más años'];
          }

          // Encabezado en 3 niveles
          const h1 = document.createElement('tr');
          h1.innerHTML = `
            <th rowspan="3" class="sticky-col sticky-col-shadow concept-col">CONDICIÓN DE <br/>FUNCIONALIDAD</th>
            <th colspan="3">TOTAL</th>
            <th class="sep-total" colspan="${bandas.length*2}">RANGO ETARIO Y SEXO</th>
            <th class="sep-po" colspan="2">Pueblos Originarios</th>
            <th class="sep-mig" colspan="2">Migrantes</th>
            <th colspan="2">Personas Mayores en ELEAM</th>`;
          const h2 = document.createElement('tr');
          h2.innerHTML = `
            <th>Ambos sexos</th><th>Hombres</th><th>Mujeres</th>
            ${bandas.map((b,i)=>`<th colspan="2" class="${i===0?'sep-total':''}">${b}</th>`).join('')}
            <th class="sep-po">Hombres</th><th>Mujeres</th>
            <th class="sep-mig">Hombres</th><th>Mujeres</th>
            <th>Hombres</th><th>Mujeres</th>`;
          const h3 = document.createElement('tr');
          h3.innerHTML = `
            ${Array(3).fill('<th style="visibility:hidden"></th>').join('')}
            ${bandas.map((_,i)=>`<th class="${i===0?'sep-total':''}">Hombres</th><th>Mujeres</th>`).join('')}
            ${Array(6).fill('<th style="visibility:hidden"></th>').join('')}`;
          thead.innerHTML=''; thead.appendChild(h1); thead.appendChild(h2); thead.appendChild(h3);

          // Orden esperado
          const orden = [
            'Autovalente sin riesgo',
            'Autovalente con riesgo',
            'Riesgo de dependencia',
            'SUBTOTAL (EFAM)',
            'Dependiente leve',
            'Dependiente moderado',
            'Dependiente grave',
            'Dependiente total',
            'SUBTOTAL (INDICE BARTHEL)',
            'TOTAL PERSONAS MAYORES EN CONTROL'
          ];
          const mapExact = new Map((filas||[]).map(f => [f.item, f]));
          const mapLoose = new Map((filas||[]).map(f => [keyizeLabel(f.item), f]));
          function getRow(name){ return mapExact.get(name) || mapLoose.get(keyizeLabel(name)) || null; }

          tbody.innerHTML='';
          for(const item of orden){
            const r = getRow(item);
            const isSubtotal = item.startsWith('SUBTOTAL') || item.startsWith('TOTAL');
            const tot = r?.totales || {ambos:0,hombres:0,mujeres:0};
            const po = r?.po || {hombres:0, mujeres:0};
            const mig = r?.mig || {hombres:0, mujeres:0};
            const eleam = r?.eleam || {hombres:0, mujeres:0};
            const tr = document.createElement('tr');
            const celdasBandas = bandas.map((b,i)=>{
              const pb = r?.por_banda?.[b] || {hombres:0, mujeres:0};
              return `<td class="${i===0?'sep-total':''}">${num(pb.hombres||0)}</td><td>${num(pb.mujeres||0)}</td>`;
            }).join('');
            tr.innerHTML = `
              <td class="sticky-col sticky-col-shadow concept-col ${isSubtotal?'fw-semibold':''}">${item}</td>
              <td class="sep-total">${num(tot.ambos||0)}</td><td>${num(tot.hombres||0)}</td><td>${num(tot.mujeres||0)}</td>
              ${celdasBandas}
              <td class="sep-po">${num(po.hombres||0)}</td><td>${num(po.mujeres||0)}</td>
              <td class="sep-mig">${num(mig.hombres||0)}</td><td>${num(mig.mujeres||0)}</td>
              <td>${num(eleam.hombres||0)}</td><td>${num(eleam.mujeres||0)}</td>`;
            tbody.appendChild(tr);
          }
          if(status) status.textContent = ok ? '' : 'Sin datos (se muestran 0)';
          ajustarAnchoConceptoStickyCols();
        }catch(e){
          console.error('P5 funcionalidad error', e);
          if(status) status.textContent = 'No se pudo cargar P5';
        }
      }

      // Sanea el nombre de la hoja para Excel (máx 31 chars y sin caracteres prohibidos)
      function sanitizeSheetName(name){
        let n = String(name||'Hoja');
        // Reemplazar caracteres inválidos: : \\ / ? * [ ]
        n = n.replace(/[:\\/?*\[\]]/g, ' ');
        // Recortar espacios extremos y limitar a 31 caracteres
        n = n.trim().slice(0, 31) || 'Hoja';
        return n;
      }

      // Agrega una hoja inicial con el detalle de filtros aplicados y parámetros REM‑P
      function addHojaFiltrosAplicados(wb){
        try{
          const desde = document.getElementById('fecha_desde')?.value || '';
          const hasta = document.getElementById('fecha_hasta')?.value || '';
          const sectorSel = document.getElementById('sectores_select');
          const sectorTexto = sectorSel ? (sectorSel.options[sectorSel.selectedIndex]?.text || '') : '';
          const sexoSel = document.getElementById('sexo_select');
          const sexoTexto = sexoSel ? (sexoSel.options[sexoSel.selectedIndex]?.text || sexoSel.value || '') : '';
          const catSel = document.getElementById('categorias_select');
          const categoriasTexto = catSel ? (catSel.options[catSel.selectedIndex]?.text || catSel.value || '') : '';
          const geSel = document.getElementById('grupo_etareo_select');
          const grupoTexto = geSel ? (geSel.options[geSel.selectedIndex]?.text || geSel.value || '') : '';
          const patSel = document.getElementById('patologia_filtro');
          const patologiaTexto = patSel ? (patSel.options?.[patSel.selectedIndex]?.text || patSel.value || '') : '';

          // Parámetros REM‑P guardados en localStorage
          let rem = {};
          try{ rem = getStoredRemParams ? getStoredRemParams() : {}; }catch(_){ rem = {}; }

          const data = [
        ['Generado en', new Date().toLocaleDateString()],
            ['Fecha inicio', desde || '(sin filtro)'],
            ['Fecha término', hasta || '(sin filtro)'],
            ['Sector', sectorTexto || 'Todos'],
            ['Sexo', sexoTexto || 'Todos'],
            ['Categorías', categoriasTexto || 'Todas'],
            ['Grupo etario', grupoTexto || 'Todos'],
            ['Patologías', patologiaTexto || 'Todas'],
            ['—', '—'],
            ['Parámetros REM‑P', 'Valor'],
            ['Vigencia (días)', rem.vigencia_dias ?? ''],
            ['HbA1c meta 15-79 años (%)', rem.hba1c_meta_lt65 ?? ''],
            ['HbA1c meta ≥80 años (%)', rem.hba1c_meta_ge65 ?? ''],
            ['PA sistólica meta (mmHg)', rem.pa_sistolica_meta ?? ''],
            ['PA diastólica meta (mmHg)', rem.pa_diastolica_meta ?? ''],
            ['PA sistólica meta ALT (mmHg)', rem.pa_sistolica_meta_alt ?? ''],
            ['LDL meta RCV alto (mg/dL)', rem.ldl_meta_rcv_alto ?? ''],
            ['LDL meta general (mg/dL)', rem.ldl_meta_general ?? '']
          ];
          const ws = XLSX.utils.aoa_to_sheet(data);
          XLSX.utils.book_append_sheet(wb, ws, sanitizeSheetName('Filtros aplicados'));
        }catch(_){ /* noop */ }
      }

      // Exporta todas las tablas del documento a hojas separadas
      function exportarTodasLasTablasAExcel(wb){
        try{
          const tables = Array.from(document.querySelectorAll('table'));
          if(!tables.length) return;
          const used = new Set();
          let fallbackIndex = 1;
          for(const table of tables){
            // Determinar nombre de hoja: data-export-name > id > título cercano > fallback
            let base = table.getAttribute('data-export-name') || table.id || '';
            if(!base){
              // Intentar encontrar título en la tarjeta (card-title)
              const card = table.closest('.card');
              const titleEl = card ? card.querySelector('.card-title') : null;
              if(titleEl){ base = (titleEl.textContent||'').trim(); }
            }
            if(!base){ base = `Tabla_${fallbackIndex++}`; }
            let name = sanitizeSheetName(base);
            // Unicidad: si ya existe, agregar sufijos
            let suffix = 2;
            while(used.has(name)){
              const baseShort = sanitizeSheetName(base).slice(0, Math.max(0, 31 - (` (${suffix})`.length)));
              name = `${baseShort} (${suffix})`;
              suffix++;
            }
            used.add(name);

            const ws = XLSX.utils.table_to_sheet(table, {raw:true});
            XLSX.utils.book_append_sheet(wb, ws, name);
          }
        }catch(_){ /* noop */ }
      }

      // ===================== SECCIÓN C: Variables de Seguimiento =====================
      async function cargarSeccionCVariables(paramsFromChart){
        const status = document.getElementById('pscv-variables-status');
        const thead = document.getElementById('pscv-variables-head');
        const tbody = document.getElementById('pscv-variables-body');
        try{
          status.textContent = 'Cargando…';
          let params;
          if(paramsFromChart instanceof URLSearchParams){
            params = paramsFromChart;
          } else {
            params = new URLSearchParams();
            const sEl = document.getElementById('sectores_select'); const s = sEl && sEl.value; if(s) params.set('sectores', s);
            const sxEl = document.getElementById('sexo_select'); const sx = sxEl && sxEl.value; if(sx) params.set('sexo', sx);
            const cEl = document.getElementById('categorias_select'); const c = cEl && cEl.value; if(c) params.set('categorias', c);
            const gEl = document.getElementById('grupo_etareo_select'); const g = gEl && gEl.value; if(g) params.set('grupos_etareos', g);
            const pEl = document.getElementById('patologia_filtro'); const p = pEl && pEl.value; if(p) params.set('patologias', p);
            const desdeEl = document.getElementById('fecha_desde'); const desde = desdeEl && desdeEl.value; if(desde) params.set('fecha_desde', desde);
            const hastaEl = document.getElementById('fecha_hasta'); const hasta = hastaEl && hastaEl.value; if(hasta) params.set('fecha_hasta', hasta);
          }
          appendRemParams(params);

          // Intentar obtener variables (nuevo esquema: bandas + filas)
          let filas = [];
          let bandas = [];
          let ok = false;
          try{
            const r = await fetch('/api/estadisticas/pscv_variables' + (params.toString()? ('?'+params.toString()):''), { credentials: 'same-origin' });
            if(r.ok){
              const j = await r.json();
              if(j && j.success){
                filas = j.filas || [];
                bandas = j.bandas || [];
                ok = true;
              }
            }
          }catch(_){ ok = false; }

          // Si no vino en el endpoint, caer a las fuentes anteriores
          let origenBandas = '';
          if(!bandas || bandas.length===0){
            try{
              const qs = params.toString();
              const rb = await fetch('/api/estadisticas/pscv_resumen_bandas' + (qs? ('?'+qs):''), { credentials: 'same-origin' });
              if(rb.ok){ const jb = await rb.json(); if(jb && jb.success){ bandas = jb.bandas||[]; if(bandas.length>0) origenBandas='pscv_resumen_bandas'; } }
            }catch(_){ }
          }
          if(!bandas || bandas.length===0){
            try{
              const qs = params.toString();
              const rm = await fetch('/api/estadisticas/pscv_matriz' + (qs? ('?'+qs):''), { credentials: 'same-origin' });
              if(rm.ok){ const jm = await rm.json(); if(jm && jm.success){ bandas = (jm.matriz||[]).map(x=>x.banda); if(bandas.length>0) origenBandas='pscv_matriz'; } }
            }catch(_){ }
          }
          if(!bandas || bandas.length===0){ bandas = BANDAS_PSCV_DEFAULT.slice(); origenBandas='bandas_default'; }

          // Header de 3 niveles
          const h1 = document.createElement('tr');
          h1.innerHTML = `
            <th rowspan="3" class="sticky-col sticky-col-shadow concept-col">CONCEPTO</th>
            <th colspan="3">TOTAL</th>
            <th class="sep-total" colspan="${bandas.length*2}">RANGO ETARIO Y SEXO</th>
            <th class="sep-po" colspan="2">Pueblos Originarios</th>
            <th class="sep-mig" colspan="2">Migrantes</th>`;
          const h2 = document.createElement('tr');
          h2.innerHTML = `
            <th style="min-width: 360px;">&nbsp;</th>
            <th class="sep-total">Ambos sexos</th><th>Hombres</th><th>Mujeres</th>
            ${bandas.map((b,i)=>`<th colspan="2" class="${i===0?'sep-total':''}">${b} años</th>`).join('')}
            <th class="sep-po">Hombres</th><th>Mujeres</th>
            <th class="sep-mig">Hombres</th><th>Mujeres</th>`;
          const h3 = document.createElement('tr');
          h3.innerHTML = `
            <th style="visibility:hidden"></th>
            ${Array(3).fill('<th style="visibility:hidden"></th>').join('')}
            ${bandas.map((_,i)=>`<th class="${i===0?'sep-total':''}">Hombres</th><th>Mujeres</th>`).join('')}
            ${Array(4).fill('<th style="visibility:hidden"></th>').join('')}`;
          thead.innerHTML=''; thead.appendChild(h1); thead.appendChild(h2); thead.appendChild(h3);

          // Índice rápido y agrupación dinámica por grupo, en el orden provisto por la API
          const idx = new Map(filas.map(r => [`${r.grupo}||${r.item}`, r]));
          const ordenGrupos = [];
          const itemsPorGrupo = new Map();
          for(const r of filas){
            if(!itemsPorGrupo.has(r.grupo)){
              itemsPorGrupo.set(r.grupo, []);
              ordenGrupos.push(r.grupo);
            }
            itemsPorGrupo.get(r.grupo).push(r.item);
          }

          // Render filas (con 0 si falta en API), exactamente con los que pide la tabla (lo que entrega el backend)
          tbody.innerHTML = '';
          for(const grupoTitulo of ordenGrupos){
            const items = itemsPorGrupo.get(grupoTitulo) || [];
            const rowSpan = items.length || 1;
            let i = 0;
            for(const it of items){
              const key = `${grupoTitulo}||${it}`;
              const r = idx.get(key) || null;
              const tot = r?.totales || {ambos:0,hombres:0,mujeres:0};
              const tr = document.createElement('tr');
              const celdasBandas = bandas.map((b,j)=>{
                const pb = r?.por_banda?.[b] || {hombres:0,mujeres:0};
                return `<td class="${j===0?'sep-total':''}">${num(pb.hombres||0)}</td><td>${num(pb.mujeres||0)}</td>`;
              }).join('');
              if(i===0){
                tr.innerHTML = `
                  <td rowspan="${rowSpan}" class="sticky-col sticky-col-shadow concept-col">${grupoTitulo}</td>
                  <td>${it}</td>
                  <td class="sep-total">${num(tot.ambos||0)}</td>
                  <td>${num(tot.hombres||0)}</td>
                  <td>${num(tot.mujeres||0)}</td>
                  ${celdasBandas}
                  <td class="sep-po">${num(r?.po?.hombres||0)}</td><td>${num(r?.po?.mujeres||0)}</td>
                  <td class="sep-mig">${num(r?.mig?.hombres||0)}</td><td>${num(r?.mig?.mujeres||0)}</td>`;
              } else {
                tr.innerHTML = `
                  <td>${it}</td>
                  <td class="sep-total">${num(tot.ambos||0)}</td>
                  <td>${num(tot.hombres||0)}</td>
                  <td>${num(tot.mujeres||0)}</td>
                  ${celdasBandas}
                  <td class="sep-po">${num(r?.po?.hombres||0)}</td><td>${num(r?.po?.mujeres||0)}</td>
                  <td class="sep-mig">${num(r?.mig?.hombres||0)}</td><td>${num(r?.mig?.mujeres||0)}</td>`;
              }
              tbody.appendChild(tr);
              i++;
            }
          }
          status.textContent = ok ? (origenBandas?`Bandas: ${origenBandas}`:'') : 'Sin datos (se muestran 0)';
          ajustarAnchoConceptoStickyCols();
        }catch(e){
          console.error('PSCV variables error', e);
          status.textContent = 'No se pudo cargar la Sección C';
        }
      }

      // ===================== UI Parámetros REM-P (avanzado) =====================
      const REM_DEFAULTS = {
        vigencia_dias: 365,
        hba1c_meta_lt65: 7.0,
        hba1c_meta_ge65: 8.0,
        pa_sistolica_meta: 140,
        pa_diastolica_meta: 90,
        pa_sistolica_meta_alt: 150,
        ldl_meta_rcv_alto: 70,
        ldl_meta_general: 100
      };

      function getStoredRemParams(){
        try{
          const raw = localStorage.getItem('rem_params');
          if(!raw) return {...REM_DEFAULTS};
          const obj = JSON.parse(raw);
          return {...REM_DEFAULTS, ...obj};
        }catch(_){ return {...REM_DEFAULTS}; }
      }
      function saveStoredRemParams(obj){
        try{ localStorage.setItem('rem_params', JSON.stringify(obj||{})); }catch(_){ /* noop */ }
      }
      function appendRemParams(params){
        try{
          const p = getStoredRemParams();
          // Solo agregamos si existen valores (usar string para URLSearchParams)
          if(p.vigencia_dias!=null) params.set('vigencia_dias', String(p.vigencia_dias));
          if(p.hba1c_meta_lt65!=null) params.set('hba1c_meta_lt65', String(p.hba1c_meta_lt65));
          if(p.hba1c_meta_ge65!=null) params.set('hba1c_meta_ge65', String(p.hba1c_meta_ge65));
          if(p.pa_sistolica_meta!=null) params.set('pa_sistolica_meta', String(p.pa_sistolica_meta));
          if(p.pa_diastolica_meta!=null) params.set('pa_diastolica_meta', String(p.pa_diastolica_meta));
          if(p.pa_sistolica_meta_alt!=null) params.set('pa_sistolica_meta_alt', String(p.pa_sistolica_meta_alt));
          if(p.ldl_meta_rcv_alto!=null) params.set('ldl_meta_rcv_alto', String(p.ldl_meta_rcv_alto));
          if(p.ldl_meta_general!=null) params.set('ldl_meta_general', String(p.ldl_meta_general));
        }catch(_){ /* noop */ }
      }
      function initRemParamsUI(){
        try{
          // Insertar panel de parámetros en el host de esta página
          const host = document.getElementById('params-panel-host');
          if(!host) return;
          if(document.getElementById('remp-panel')) return;
          const html = `
            <hr class="my-3"/>
            <details id="remp-panel">
              <summary class="fw-semibold" style="cursor:pointer">Parámetros REM‑P (avanzado)</summary>
              <div class="row g-2 mt-2">
                <div class="col-6 col-md-3">
                  <label class="form-label small">Vigencia (días)</label>
                  <input id="rem_vigencia" type="number" class="form-control form-control-sm" min="1"/>
                </div>
                <div class="col-6 col-md-3">
                  <label class="form-label small">HbA1c meta 15-79 años (%)</label>
                  <input id="rem_hba1c_lt65" type="number" step="0.1" class="form-control form-control-sm"/>
                </div>
                <div class="col-6 col-md-3">
                  <label class="form-label small">HbA1c meta ≥80 años (%)</label>
                  <input id="rem_hba1c_ge65" type="number" step="0.1" class="form-control form-control-sm"/>
                </div>
                <div class="col-6 col-md-3">
                  <label class="form-label small">PA sistólica meta (mmHg)</label>
                  <input id="rem_pa_sys" type="number" class="form-control form-control-sm"/>
                </div>
                <div class="col-6 col-md-3">
                  <label class="form-label small">PA diastólica meta (mmHg)</label>
                  <input id="rem_pa_dia" type="number" class="form-control form-control-sm"/>
                </div>
                <div class="col-6 col-md-3">
                  <label class="form-label small">PA sistólica ≥80 años (mmHg)</label>
                  <input id="rem_pa_sys_alt" type="number" class="form-control form-control-sm"/>
                </div>
                <div class="col-6 col-md-3">
                  <label class="form-label small">LDL meta RCV alto (mg/dL)</label>
                  <input id="rem_ldl_rcv" type="number" class="form-control form-control-sm"/>
                </div>
                <div class="col-6 col-md-3">
                  <label class="form-label small">LDL meta general (mg/dL)</label>
                  <input id="rem_ldl_gen" type="number" class="form-control form-control-sm"/>
                </div>
                <div class="col-12 d-flex gap-2 mt-2">
                  <button id="rem_guardar" type="button" class="btn btn-sm btn-primary">Guardar y recargar tablas</button>
                  <button id="rem_reset" type="button" class="btn btn-sm btn-outline-secondary">Restaurar valores por defecto</button>
                </div>
              </div>
            </details>`;
          host.insertAdjacentHTML('beforeend', html);
          const p = getStoredRemParams();
          document.getElementById('rem_vigencia').value = p.vigencia_dias;
          document.getElementById('rem_hba1c_lt65').value = p.hba1c_meta_lt65;
          document.getElementById('rem_hba1c_ge65').value = p.hba1c_meta_ge65;
          document.getElementById('rem_pa_sys').value = p.pa_sistolica_meta;
          document.getElementById('rem_pa_dia').value = p.pa_diastolica_meta;
          document.getElementById('rem_pa_sys_alt').value = p.pa_sistolica_meta_alt;
          document.getElementById('rem_ldl_rcv').value = p.ldl_meta_rcv_alto;
          document.getElementById('rem_ldl_gen').value = p.ldl_meta_general;

          document.getElementById('rem_guardar').addEventListener('click', () => {
            const obj = {
              vigencia_dias: parseInt(document.getElementById('rem_vigencia').value||REM_DEFAULTS.vigencia_dias, 10),
              hba1c_meta_lt65: parseFloat(document.getElementById('rem_hba1c_lt65').value||REM_DEFAULTS.hba1c_meta_lt65),
              hba1c_meta_ge65: parseFloat(document.getElementById('rem_hba1c_ge65').value||REM_DEFAULTS.hba1c_meta_ge65),
              pa_sistolica_meta: parseInt(document.getElementById('rem_pa_sys').value||REM_DEFAULTS.pa_sistolica_meta, 10),
              pa_diastolica_meta: parseInt(document.getElementById('rem_pa_dia').value||REM_DEFAULTS.pa_diastolica_meta, 10),
              pa_sistolica_meta_alt: parseInt(document.getElementById('rem_pa_sys_alt').value||REM_DEFAULTS.pa_sistolica_meta_alt, 10),
              ldl_meta_rcv_alto: parseFloat(document.getElementById('rem_ldl_rcv').value||REM_DEFAULTS.ldl_meta_rcv_alto),
              ldl_meta_general: parseFloat(document.getElementById('rem_ldl_gen').value||REM_DEFAULTS.ldl_meta_general)
            };
            saveStoredRemParams(obj);
            // Recargar tablas dependientes de parámetros
            cargarPscvMetas();
            cargarP5SeccionA();
            cargarSeccionAMatriz();
            cargarSeccionCVariables();
          });
          document.getElementById('rem_reset').addEventListener('click', () => {
            saveStoredRemParams({});
            const d = {...REM_DEFAULTS};
            document.getElementById('rem_vigencia').value = d.vigencia_dias;
            document.getElementById('rem_hba1c_lt65').value = d.hba1c_meta_lt65;
            document.getElementById('rem_hba1c_ge65').value = d.hba1c_meta_ge65;
            document.getElementById('rem_pa_sys').value = d.pa_sistolica_meta;
            document.getElementById('rem_pa_dia').value = d.pa_diastolica_meta;
            document.getElementById('rem_pa_sys_alt').value = d.pa_sistolica_meta_alt;
            document.getElementById('rem_ldl_rcv').value = d.ldl_meta_rcv_alto;
            document.getElementById('rem_ldl_gen').value = d.ldl_meta_general;
            cargarPscvMetas();
            cargarP5SeccionA();
            cargarSeccionAMatriz();
            cargarSeccionCVariables();
          });
        }catch(_){ /* noop */ }
      }
    </script>
  </body>
</html>
